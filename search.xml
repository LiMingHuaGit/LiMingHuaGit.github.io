<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>FetchXML查询</title>
    <url>/2020/12/30/FetchXML%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<h2 id="实例代码"><a href="#实例代码" class="headerlink" title="实例代码"></a>实例代码</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取当前服务单的回访任务fetch方式</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="id"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;SurveyTaskModel&gt; <span class="title">GetSurveyTaskLine2</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrWhiteSpace(id))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"当前服务单id丢失"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> fetchXml = String.Format(<span class="string">@"&lt;fetch mapping='logical' version='1.0'&gt;</span></span><br><span class="line"><span class="string">                                                  &lt;entity name='new_srv_surveytask'&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_srv_surveytaskid' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_name' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_result' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_completecycle' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_satisfactiondegree' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_nosatisfiedreason' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_memo' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_rejectedreason' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_belonguser_idname' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;attribute name='new_surveytime' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;filter&gt;</span></span><br><span class="line"><span class="string">                                                      &lt;condition attribute='new_srv_surveytaskid' operator='eq' value='&#123;0&#125;' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;/filter&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;link-entity name='new_srv_workorder' from='new_srv_workorderid' to='new_srv_workorder_id' alias='sw' link-type='outer'&gt;</span></span><br><span class="line"><span class="string">                                                      &lt;attribute name='new_srv_worker_id' /&gt;</span></span><br><span class="line"><span class="string">                                                      &lt;attribute name='new_srv_worker_idname' /&gt;</span></span><br><span class="line"><span class="string">                                                    &lt;/link-entity&gt;</span></span><br><span class="line"><span class="string">                                                  &lt;/entity&gt;</span></span><br><span class="line"><span class="string">                                                &lt;/fetch&gt;"</span>, id);</span><br><span class="line">            <span class="keyword">var</span> result = OrganizationServiceAdmin.RetrieveMultiple(<span class="keyword">new</span> FetchExpression(fetchXml));</span><br><span class="line"></span><br><span class="line">            List&lt;SurveyTaskModel&gt; list = <span class="keyword">new</span> List&lt;SurveyTaskModel&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> result.Entities)</span><br><span class="line">            &#123;</span><br><span class="line">                list.Add(<span class="keyword">new</span> SurveyTaskModel</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//主键</span></span><br><span class="line">                    id = item.GetAttributeValue&lt;Guid&gt;(<span class="string">"new_srv_surveytaskid"</span>).ToString(),</span><br><span class="line">                    <span class="comment">//单号 new_name</span></span><br><span class="line">                    new_name = item.GetAttributeValue&lt;<span class="keyword">string</span>&gt;(<span class="string">"new_name"</span>),</span><br><span class="line">                    <span class="comment">//服务人员 new_srv_worker_idname</span></span><br><span class="line">                    new_srv_worker_idname = item.GetAttributeValue&lt;<span class="keyword">string</span>&gt;(<span class="string">"new_srv_worker_idname"</span>),</span><br><span class="line">                    <span class="comment">//解决情况 new_result</span></span><br><span class="line">                    new_result = item.FormattedValues[<span class="string">"new_result"</span>],</span><br><span class="line">                    <span class="comment">//完工周期 new_completecycle</span></span><br><span class="line">                    new_completecycle = item.GetAttributeValue&lt;Decimal&gt;(<span class="string">"new_completecycle"</span>).ToString(),</span><br><span class="line">                    <span class="comment">//服务是否满意 new_satisfactiondegree</span></span><br><span class="line">                    new_satisfactiondegree = item.FormattedValues[<span class="string">"new_satisfactiondegree"</span>],</span><br><span class="line">                    <span class="comment">//不满意原因 new_nosatisfiedreason</span></span><br><span class="line">                    new_nosatisfiedreason = item.FormattedValues[<span class="string">"new_nosatisfiedreason"</span>],</span><br><span class="line">                    <span class="comment">//回访结果备注 new_memo</span></span><br><span class="line">                    new_memo = item.GetAttributeValue&lt;<span class="keyword">string</span>&gt;(<span class="string">"new_memo"</span>),</span><br><span class="line">                    <span class="comment">//驳回原因 new_rejectedreason</span></span><br><span class="line">                    new_rejectedreason = item.GetAttributeValue&lt;<span class="keyword">string</span>&gt;(<span class="string">"new_rejectedreason"</span>),</span><br><span class="line">                    <span class="comment">//回访坐席 new_belonguser_idname</span></span><br><span class="line">                    new_belonguser_idname = item.GetAttributeValue&lt;<span class="keyword">string</span>&gt;(<span class="string">"new_belonguser_idname"</span>),</span><br><span class="line">                    <span class="comment">//实际回访时间 new_surveytime</span></span><br><span class="line">                    new_surveytime = item.GetAttributeValue&lt;DateTime&gt;(<span class="string">"new_surveytime"</span>).ToString(),</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="OrganizationServiceAdmin"><a href="#OrganizationServiceAdmin" class="headerlink" title="OrganizationServiceAdmin"></a>OrganizationServiceAdmin</h2><blockquote>
<p>构造函数里CreateOrganizationService<br>IPortalCommandContext：调用PortalCommand时需要传入的上下文<br>IUserIdentity：当前用户身份信息。不会包含框架级的认证类型，只含身份id.</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WorkOrderCommand</span> : <span class="title">PortalCommand</span></span><br><span class="line">   &#123;</span><br><span class="line">       IOrganizationService OrganizationServiceAdmin;</span><br><span class="line">       <span class="keyword">protected</span> <span class="keyword">readonly</span> OrganizationServiceContext orgContext;</span><br><span class="line">       <span class="comment">//private PersisitBroker broker;</span></span><br><span class="line">       XStudio.Data.PersisitBroker broker = <span class="keyword">new</span> XStudio.Data.PersisitBroker(<span class="string">"crm"</span>);</span><br><span class="line">       </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="title">WorkOrderCommand</span>(<span class="params">IUserIdentity identity</span>) : <span class="title">base</span>(<span class="params">identity</span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           <span class="keyword">this</span>.orgContext = <span class="keyword">new</span> OrganizationServiceContext(OrganizationService);</span><br><span class="line">           OrganizationServiceAdmin = CrmServiceFactory.CreateOrganizationService(Guid.Empty);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="title">WorkOrderCommand</span>(<span class="params">IPortalCommandContext portalCommandContext</span>) : <span class="title">base</span>(<span class="params">portalCommandContext</span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           <span class="keyword">this</span>.orgContext = <span class="keyword">new</span> OrganizationServiceContext(<span class="keyword">this</span>.OrganizationService);</span><br><span class="line">           OrganizationServiceAdmin = CrmServiceFactory.CreateOrganizationService(Guid.Empty);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"><span class="keyword">bool</span> disposing</span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           <span class="keyword">if</span> (disposing)</span><br><span class="line">               <span class="keyword">this</span>.orgContext.Dispose();</span><br><span class="line">           <span class="keyword">base</span>.Dispose(disposing);</span><br><span class="line">       &#125;</span><br><span class="line">       Crm.Common.Logger.Logger log = <span class="keyword">new</span> Crm.Common.Logger.Logger();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取picklist值"><a href="#获取picklist值" class="headerlink" title="获取picklist值"></a>获取picklist值</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">new_satisfactiondegree = item.FormattedValues[<span class="string">"new_satisfactiondegree"</span>],</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>IDEA快捷键</title>
    <url>/2020/10/29/IDEA%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
    <content><![CDATA[<p>Ctrl+Z：撤销</p>
<p>Ctrl+Shift+Z：重做</p>
<p>Ctrl+X：剪贴</p>
<p>Ctrl+C：复制</p>
<p>Ctrl+V：粘贴</p>
<p>Ctrl+Y：删除当前行</p>
<p>Ctrl+D:复制当前行</p>
<p>Ctrl+Shift+J：将选中的行合并成一行</p>
<p>Ctrl+N：查找类文件</p>
<p>Ctrl+Shift+N：查找文件</p>
<p>Ctrl+G：定位到文件某一行</p>
<p>Alt+向左箭头：返回上次光标位置</p>
<p>Alt+向右箭头：返回至后一次光标位置</p>
<p>Ctrl+Shift+Backspace：返回上次编辑位置</p>
<p>Ctrl+Shift+反斜杠：返回后一次编辑位置</p>
<p>Ctrl+B：定位至变量定义的位置</p>
<p>Ctrl+Alt+B：定位至选中类或者方法的具体实现</p>
<p>Ctrl+Shift+B:直接定位至光标所在变量的类型定义</p>
<p>Ctrl+U：直接定位至当前方法override或者implements的方法定义处</p>
<p>Ctrl+F12：显示当前文件的文件结构</p>
<p>Ctrl+Alt+F12：显示当前文件的路径，并可以方便的将相关父路径打开</p>
<p>Ctrl+H：显示当前类的继承层次</p>
<p>Ctrl+Shift+H：显示当前方法的继承层次</p>
<p>Ctrl+Alt+H：显示当前方法的调用层次</p>
<p>F2：定位至下一个错误处</p>
<p>Shift+F2：定位至前一个错误处</p>
<p>Ctrl+Alt+向上箭头：查找前一个变量共现的地方</p>
<p>Ctrl+Alt+向下箭头：查找下一个变量共现的地方</p>
<p>Ctrl+=：展开代码</p>
<p>Ctrl+-：收缩代码</p>
<p>Ctrl+Alt+=：递归展开代码</p>
<p>Ctrl+Alt+-：递归收缩代码</p>
<p>Ctrl+Shift+=：展开所有代码</p>
<p>Ctrl+Shift+-：收缩所有代码</p>
<p>Ctrl+Shitft+向下箭头：将光标所在的代码块向下整体移动</p>
<p>Ctrl+Shift+向上箭头：将光标所在的代码块向上整体移动</p>
<p>Ctrl+Alt+Shift+向左箭头：将元素向左移动</p>
<p>Ctrl+Alt+Shift+向右箭头：将元素向右移动</p>
<p>Alt+Shift+向下箭头：将行向下移动</p>
<p>Alt+Shift+向上箭头：将行向上移动</p>
<p>Ctrl+F：在当前文件中查找</p>
<p>Ctrl+R：替换字符串</p>
<p>Ctrl+Shift+F:在全局文件中查找字符串</p>
<p>Ctrl+Shift+R：在全局中替换字符串</p>
<p>Alt+F7：查找当前变量的使用，并列表显示</p>
<p>Ctrl+Alt+F7：查找当前变量的使用，并直接对话框提示</p>
<p>Ctrl+F7：在文件中查找符号的使用</p>
<p>Ctrl+Shift+F7：在文件中高亮显示变量的使用</p>
<p>Ctrl+O：重写基类方法</p>
<p>Ctrl+I：实现基类或接口中的方法</p>
<p>Alt+Insert：产生构造方法，get/set方法等</p>
<p>Ctrl+Alt+T：将选中的代码使用if，while，try/catch等包装</p>
<p>Ctrl+Shitf+Delete：去除相关的包装代码</p>
<p>Alt+/：自动完成</p>
<p>Alt+Enter：自动提示完成，抛出异常 提示import class</p>
<p>Ctrl+J：插入Live Template 快速插入一行或者多行代码</p>
<p>Ctrl+Alt+J：使用Live Template包装</p>
<p>Ctrl+/：使用//注释</p>
<p>Ctrl+Shift+/：使用/**/注释</p>
<p>Ctrl+Alt+L：格式化代码</p>
<p>Ctrl+Alt+I：自动缩进行</p>
<p>Ctrl+Alt+O：优化import</p>
<p>Ctrl+]：快速跳转至诸如{}围起来的代码块的结尾处</p>
<p>Ctrl+[：快速跳转至诸如{}围起来的代码块的开头处</p>
<p>Ctrl+Shift+Enter：将输入的if，for，函数等等补上{}或者；使代码语句完整</p>
<p>Shift+Enter：在当前行的下方开始新行</p>
<p>Ctrl+Alt+Enter：在当前行的上方插入新行</p>
<p>Ctrl+Delete：删除光标所在至单词结尾处的所有字符</p>
<p>Ctrl+Backspace：删除光标所在至单词开头处的所有字符</p>
<p>Ctrl+向左箭头：将光标移至前一个单词</p>
<p>Ctrl+向右箭头：将光标移至后一个单词</p>
<p>Ctrl+向上箭头：向上滚动一行</p>
<p>Ctrl+向下箭头：向下滚动一行</p>
<p>Ctrl+W：选中整个单词</p>
<p>Ctrl+Shift+U：切换大小写</p>
<p>Shift+F6：重命名</p>
<p>Ctrl+F6：更改函数签名</p>
<p>Ctrl+Shift+F6：更改类型</p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>编译器</tag>
        <tag>idea</tag>
      </tags>
  </entry>
  <entry>
    <title>Portal报表开发</title>
    <url>/2020/12/30/Portal%E6%8A%A5%E8%A1%A8%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h2 id="RekTec-XStudio-ReportViewer"><a href="#RekTec-XStudio-ReportViewer" class="headerlink" title="RekTec.XStudio.ReportViewer"></a>RekTec.XStudio.ReportViewer</h2><blockquote>
<p>portal端报表的dll</p>
</blockquote>
<h2 id="VS-Report项目中新增报表项目"><a href="#VS-Report项目中新增报表项目" class="headerlink" title="VS Report项目中新增报表项目"></a>VS Report项目中新增报表项目</h2><blockquote>
<p>报表中查询数据及绑定数据源仅用来设计并生成报表，真正需要的是生成后带有绑定数据标签的报表页面，因此报表中的字段名应与portal端赋值时的model字段名保持一致。<br>报表完成开发后需生成报表rdl文件。</p>
</blockquote>
<p><img src="2.jpg" alt=""></p>
<h2 id="Portal端新增WEB窗体项目（aspx）"><a href="#Portal端新增WEB窗体项目（aspx）" class="headerlink" title="Portal端新增WEB窗体项目（aspx）"></a>Portal端新增WEB窗体项目（aspx）</h2><blockquote>
<p>项目开发完成后生成dll并上传至bin目录，将作为后台的webapi</p>
</blockquote>
<h3 id="aspx"><a href="#aspx" class="headerlink" title="aspx"></a>aspx</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">Page</span> <span class="attr">Language</span>=<span class="string">"C#"</span> <span class="attr">AutoEventWireup</span>=<span class="string">"true"</span> <span class="attr">CodeBehind</span>=<span class="string">"ServiceWorkerDiary.aspx.cs"</span> <span class="attr">Inherits</span>=<span class="string">"RekTec.XStudio.ReportViewer.Reports.Viewer.WebForm1"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">Register</span> <span class="attr">Assembly</span>=<span class="string">"Microsoft.ReportViewer.WebForms, Version=14.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91"</span> <span class="attr">Namespace</span>=<span class="string">"Microsoft.Reporting.WebForms"</span> <span class="attr">TagPrefix</span>=<span class="string">"rsweb"</span> %&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">runat</span>=<span class="string">"server"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form1"</span> <span class="attr">runat</span>=<span class="string">"server"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asp:ScriptManager</span> <span class="attr">runat</span>=<span class="string">"server"</span>&gt;</span><span class="tag">&lt;/<span class="name">asp:ScriptManager</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rsweb:ReportViewer</span> <span class="attr">ID</span>=<span class="string">"ReportViewer1"</span> <span class="attr">runat</span>=<span class="string">"server"</span> <span class="attr">ProcessingMode</span>=<span class="string">"Local"</span> <span class="attr">Width</span>=<span class="string">"100%"</span> <span class="attr">SizeToReportContent</span>=<span class="string">"True"</span> <span class="attr">AsyncRendering</span>=<span class="string">"False"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LocalReport</span>&gt;</span><span class="tag">&lt;/<span class="name">LocalReport</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rsweb:ReportViewer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ReportViewer:展现报表的时使用的一个控件。</p>
</blockquote>
<h3 id="aspx-cs"><a href="#aspx-cs" class="headerlink" title="aspx.cs"></a>aspx.cs</h3><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Reporting.WebForms;</span><br><span class="line"><span class="keyword">using</span> RekTec.Crm.Common.Helper;</span><br><span class="line"><span class="keyword">using</span> RekTec.Crm.Common.Logger;</span><br><span class="line"><span class="keyword">using</span> RekTec.XStudio.ReportViewer.Reports.Model;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.WebControls;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RekTec.XStudio.ReportViewer.Reports.Viewer</span></span><br><span class="line">&#123;</span><br><span class="line">    public partial class WebForm1 : System.Web.UI.Page</span><br><span class="line">    &#123;</span><br><span class="line">        Logger log = <span class="keyword">new</span> Logger();</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Page_Load</span>(<span class="params"><span class="keyword">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!IsPostBack)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> new_worker_id = Request[<span class="string">"id"</span>];</span><br><span class="line">                <span class="keyword">this</span>.BindReportDataSource(new_worker_id);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BindReportDataSource</span>(<span class="params"><span class="keyword">string</span> new_worker_id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> list = <span class="keyword">new</span> List&lt;ServiceWorkerDiaryModel&gt;();</span><br><span class="line">            <span class="keyword">using</span> (XStudio.Data.PersisitBroker broker = <span class="keyword">new</span> XStudio.Data.PersisitBroker(<span class="string">"crm"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> sql = <span class="string">$@"SELECT</span></span><br><span class="line"><span class="string">	                            new_name, </span></span><br><span class="line"><span class="string">	                            new_station_idName, </span></span><br><span class="line"><span class="string">	                            new_worker_idName, </span></span><br><span class="line"><span class="string">	                            new_address, </span></span><br><span class="line"><span class="string">	                            new_content,</span></span><br><span class="line"><span class="string">	                            CONVERT(varchar(10), DATEADD(hh, 8, new_date),120) new_date,</span></span><br><span class="line"><span class="string">	                            TB01.name as new_type, </span></span><br><span class="line"><span class="string">	                            TB02.name as new_state, </span></span><br><span class="line"><span class="string">	                            new_workorder_idName, </span></span><br><span class="line"><span class="string">	                            new_traffic, </span></span><br><span class="line"><span class="string">	                            new_accommodation, </span></span><br><span class="line"><span class="string">	                            new_gongza, </span></span><br><span class="line"><span class="string">	                            new_freight, </span></span><br><span class="line"><span class="string">	                            new_service, </span></span><br><span class="line"><span class="string">	                            new_maintenance, </span></span><br><span class="line"><span class="string">	                            new_tolls, </span></span><br><span class="line"><span class="string">	                            new_vehicle,</span></span><br><span class="line"><span class="string">	                            new_instructions, </span></span><br><span class="line"><span class="string">	                            TB03.name as new_isroutereal, </span></span><br><span class="line"><span class="string">	                            TB04.name as new_isformreal, </span></span><br><span class="line"><span class="string">	                            CONVERT(varchar(20), DATEADD(hh, 8, createdon),120) createdon </span></span><br><span class="line"><span class="string">                            FROM</span></span><br><span class="line"><span class="string">	                            new_srv_dailylog</span></span><br><span class="line"><span class="string">	                            OUTER APPLY fn_GetPickListNameByLang ( 'new_srv_dailylog', 'new_type', new_type, '2052' ) AS TB01</span></span><br><span class="line"><span class="string">	                            OUTER APPLY fn_GetPickListNameByLang ( 'new_srv_dailylog', 'new_state', new_state, '2052' ) AS TB02</span></span><br><span class="line"><span class="string">	                            OUTER APPLY fn_GetPickListNameByLang ( 'new_srv_dailylog', 'new_isroutereal', new_isroutereal, '2052' ) AS TB03</span></span><br><span class="line"><span class="string">	                            OUTER APPLY fn_GetPickListNameByLang ( 'new_srv_dailylog', 'new_isformreal', new_isformreal, '2052' ) AS TB04</span></span><br><span class="line"><span class="string">                            WHERE</span></span><br><span class="line"><span class="string">	                            new_worker_id ='<span class="subst">&#123;new_worker_id&#125;</span>'</span></span><br><span class="line"><span class="string">                            and  StateCode = 0"</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> sql2 = <span class="string">@"SELECT</span></span><br><span class="line"><span class="string">	                            sum(new_traffic) as t_new_traffic,</span></span><br><span class="line"><span class="string">	                            sum(new_accommodation) as t_new_accommodation,</span></span><br><span class="line"><span class="string">	                            sum(new_gongza) as t_new_gongza, </span></span><br><span class="line"><span class="string">	                            sum(new_freight) as t_new_freight,</span></span><br><span class="line"><span class="string">	                            sum(new_service) as t_new_service, </span></span><br><span class="line"><span class="string">	                            sum(new_maintenance) as t_new_maintenance, </span></span><br><span class="line"><span class="string">	                            sum(new_tolls) as t_new_tolls, </span></span><br><span class="line"><span class="string">	                            sum(new_vehicle) as t_new_vehicle,</span></span><br><span class="line"><span class="string">	                            (sum(new_traffic)+sum(new_accommodation)+sum(new_gongza)+sum(new_freight)+sum(new_service)+sum(new_maintenance)+sum(new_tolls)+sum(new_vehicle)) as total</span></span><br><span class="line"><span class="string">                            FROM</span></span><br><span class="line"><span class="string">	                            new_srv_dailylog</span></span><br><span class="line"><span class="string">                            WHERE</span></span><br><span class="line"><span class="string">	                             new_worker_id = '"</span>+ new_worker_id+ <span class="string">"'GROUP BY new_worker_id"</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> dt = broker.Query(sql);</span><br><span class="line">                <span class="keyword">var</span> dt2 = broker.Query(sql2);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (dt != <span class="literal">null</span> &amp;&amp; dt.Rows.Count &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">foreach</span> (DataRow dr <span class="keyword">in</span> dt.Rows)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">var</span> model = <span class="keyword">new</span> ServiceWorkerDiaryModel();</span><br><span class="line">                        model.new_name = Cast.ConToString(dr[<span class="string">"new_name"</span>]);</span><br><span class="line">                        model.new_station_idName = Cast.ConToString(dr[<span class="string">"new_station_idName"</span>]);</span><br><span class="line">                        model.new_worker_idName = Cast.ConToString(dr[<span class="string">"new_worker_idName"</span>]);</span><br><span class="line">                        model.new_type = Cast.ConToString(dr[<span class="string">"new_type"</span>]);</span><br><span class="line">                        model.new_state = Cast.ConToString(dr[<span class="string">"new_state"</span>]);</span><br><span class="line">                        model.new_workorder_idName = Cast.ConToString(dr[<span class="string">"new_workorder_idName"</span>]);</span><br><span class="line">                        model.new_traffic = Cast.ConToDecimal(dr[<span class="string">"new_traffic"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.new_accommodation = Cast.ConToDecimal(dr[<span class="string">"new_accommodation"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.new_gongza = Cast.ConToDecimal(dr[<span class="string">"new_gongza"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.new_freight = Cast.ConToDecimal(dr[<span class="string">"new_freight"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.new_service = Cast.ConToDecimal(dr[<span class="string">"new_service"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.new_maintenance = Cast.ConToDecimal(dr[<span class="string">"new_maintenance"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.new_tolls = Cast.ConToDecimal(dr[<span class="string">"new_tolls"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.new_vehicle = Cast.ConToDecimal(dr[<span class="string">"new_vehicle"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.createdon = Cast.ConToString(dr[<span class="string">"createdon"</span>]);</span><br><span class="line">                        model.new_address = Cast.ConToString(dr[<span class="string">"new_address"</span>]);</span><br><span class="line">                        model.new_content = Cast.ConToString(dr[<span class="string">"new_content"</span>]);</span><br><span class="line">                        model.new_date = Cast.ConToString(dr[<span class="string">"new_date"</span>]);</span><br><span class="line">                        model.new_instructions = Cast.ConToString(dr[<span class="string">"new_instructions"</span>]);</span><br><span class="line">                        model.new_isroutereal = Cast.ConToString(dr[<span class="string">"new_isroutereal"</span>]);</span><br><span class="line">                        model.new_isformreal = Cast.ConToString(dr[<span class="string">"new_isformreal"</span>]);</span><br><span class="line">                        list.Add(model);</span><br><span class="line">                    &#125;</span><br><span class="line">                    DataRow dr2 = dt2.Rows[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">foreach</span> (ServiceWorkerDiaryModel model <span class="keyword">in</span> list)</span><br><span class="line">                    &#123;</span><br><span class="line">                        model.t_new_traffic = Cast.ConToDecimal(dr2[<span class="string">"t_new_traffic"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.t_new_accommodation = Cast.ConToDecimal(dr2[<span class="string">"t_new_accommodation"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.t_new_gongza = Cast.ConToDecimal(dr2[<span class="string">"t_new_gongza"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.t_new_freight = Cast.ConToDecimal(dr2[<span class="string">"t_new_freight"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.t_new_service = Cast.ConToDecimal(dr2[<span class="string">"t_new_service"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.t_new_maintenance = Cast.ConToDecimal(dr2[<span class="string">"t_new_maintenance"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.t_new_tolls = Cast.ConToDecimal(dr2[<span class="string">"t_new_tolls"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.t_new_vehicle = Cast.ConToDecimal(dr2[<span class="string">"t_new_vehicle"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line">                        model.total = Cast.ConToDecimal(dr2[<span class="string">"total"</span>]).ToString(<span class="string">"0.00"</span>);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">      </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//根据自己的实际情况去获取数据源</span></span><br><span class="line">            ReportViewer1.LocalReport.ReportPath = Server.MapPath(<span class="string">"../ServiceWorkerDiary.rdlc"</span>);<span class="comment">//直接引用rdlc文件</span></span><br><span class="line">            ReportViewer1.LocalReport.DataSources.Add(<span class="keyword">new</span> ReportDataSource(<span class="string">"DataSet1"</span>, list));</span><br><span class="line">            ReportViewer1.LocalReport.Refresh();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>rdlc 文件：.rdlc是VS2005中报表文件的后缀名，是Report Definition Language Client的缩写，直接翻译过来可以理解为报表定义语言客户端。<br>和rdlc同时存在的还有一个rdl，就是上面这个全程前3个单词的缩写。<br>从SQL Server 2005开始，微软提供了一个报表服务(Reporting Service)，而rdl是指那些针对报表服务部署在服务器端的报表，而rdlc是指在本地的一些报表。<br>也就是说我们要使用报表不一定要依赖于SQL Server的Reporting Service，而是可以自主生成一些数据源然后通过报表的方式展现出来。如果和rdl比较，rdlc可以看成是一个轻量级的报表。</p>
</blockquote>
<h2 id="上传报表文件和页面"><a href="#上传报表文件和页面" class="headerlink" title="上传报表文件和页面"></a>上传报表文件和页面</h2><blockquote>
<p>将之前生成的rdl改名为rdlc文件并上传至服务器上相关目录（aspx.cs 代码中绑定的目录）</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">ReportViewer1.LocalReport.ReportPath = Server.MapPath(<span class="string">"../ServiceWorkerDiary.rdlc"</span>);<span class="comment">//直接引用rdlc文件</span></span><br></pre></td></tr></table></figure>

<p><img src="1.jpg" alt=""><br><img src="3.jpg" alt=""></p>
<h2 id="访问服务器路径资源"><a href="#访问服务器路径资源" class="headerlink" title="访问服务器路径资源"></a>访问服务器路径资源</h2><blockquote>
<p><a href="http://10.8.32.143:8081/Reports/Viewer/ServiceWorkerDiary.aspx?id=C635F6B6-81EB-EA11-8ABD-005056AF9937" target="_blank" rel="noopener">http://10.8.32.143:8081/Reports/Viewer/ServiceWorkerDiary.aspx?id=C635F6B6-81EB-EA11-8ABD-005056AF9937</a></p>
</blockquote>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>Portal</tag>
        <tag>vsReport</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLServer查询跟踪</title>
    <url>/2020/10/29/SQLServer%E6%9F%A5%E8%AF%A2%E8%B7%9F%E8%B8%AA/</url>
    <content><![CDATA[<h1 id="SQL-Server-Profiler"><a href="#SQL-Server-Profiler" class="headerlink" title="SQL Server Profiler"></a>SQL Server Profiler</h1><blockquote>
<p>数据库性能工具</p>
</blockquote>
<h2 id="1-新建跟踪"><a href="#1-新建跟踪" class="headerlink" title="1.新建跟踪"></a>1.新建跟踪</h2><blockquote>
<p>文件-新建跟踪 </p>
</blockquote>
<h2 id="2-事件选择"><a href="#2-事件选择" class="headerlink" title="2.事件选择"></a>2.事件选择</h2><p><img src="1.jpg" alt=""></p>
<blockquote>
<p>Stored Procedures：TextData 根据sql中的文本值进行过滤 </p>
</blockquote>
<p><img src="2.jpg" alt=""></p>
<blockquote>
<p>列筛选器中键入TextData的类似于值 ：要跟踪的sql中特定的参数或关键字</p>
</blockquote>
<h2 id="3-运行"><a href="#3-运行" class="headerlink" title="3.运行"></a>3.运行</h2><p><img src="3.jpg" alt=""><br><img src="4.jpg" alt=""><br><img src="5.jpg" alt=""><br><img src="6.jpg" alt=""></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>sql跟踪</tag>
        <tag>SQL Server</tag>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>PowerBI_DAX函数</title>
    <url>/2020/11/04/PowerBI_DAX%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h1 id="DAX函数"><a href="#DAX函数" class="headerlink" title="DAX函数"></a>DAX函数</h1><blockquote>
<p>数据分析表达式 (DAX) 是在 Analysis Services、Power BI 以及 Excel 中的 Power Pivot 使用的公式表达式语言。 DAX 公式包括函数、运算符和值，用于对表格数据模型中相关表和列中的数据执行高级计算和查询<br><a href="https://docs.microsoft.com/zh-cn/dax/dax-overview" target="_blank" rel="noopener">微软文档</a></p>
</blockquote>
<h2 id="CALCULATE"><a href="#CALCULATE" class="headerlink" title="CALCULATE"></a>CALCULATE</h2><blockquote>
<p>DAX中最重要的函数</p>
</blockquote>
<h3 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CALCULATE(聚合函数,筛选条件,筛选条件...)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所有筛选条件的交集形成最终的筛选数据集合,根据筛选出的数据集合执行第一个参数的聚合运算并返回运算结果</p>
</blockquote>
<h3 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h3><blockquote>
<p>导入下面这个产品明细表： </p>
</blockquote>
<p><img src="1.jpg" alt=""></p>
<blockquote>
<p>新建一个度量值求每种产品的数量：<br>产品数量 = COUNTROWS(‘产品明细’)<br>因为每种产品的只有1行，所以求产品明细表的行数就相当于求各种产品的数量，把产品名称和该度量值拖拽入矩阵表，</p>
</blockquote>
<p><img src="2.jpg" alt=""></p>
<blockquote>
<p>这里外部上下文就是表格每行的行标签。</p>
</blockquote>
<h4 id="用例01-筛选条件为空，不影响外部上下文"><a href="#用例01-筛选条件为空，不影响外部上下文" class="headerlink" title="用例01 | 筛选条件为空，不影响外部上下文"></a>用例01 | 筛选条件为空，不影响外部上下文</h4><blockquote>
<p>现在开始用CALCULATE函数创建一个度量值：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">产品数量1 &#x3D; CALCULATE([产品数量])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>只是用了第一个参数，筛选条件为空，因为没有内部筛选所以完全依赖外部上下文，出来的结果也和原度量值一致。</p>
</blockquote>
<p><img src="3.jpg" alt=""></p>
<blockquote>
<p>另外，介绍CALCULATE语法的时候说，第一个参数为聚合运算表达式，为什么这里没有用聚合函数而只用了一个度量值呢？<br>这是因为度量值[产品数量]本身就是一个聚合函数运算，实际上度量值[产品数量1]等同于这个：<br>产品数量1 = CALCULATE(COUNTROWS(‘产品明细’))<br>DAX函数可以直接引用已经创建好的度量值，可以使DAX函数看起来更简洁、更具可读性，这也是建议从最简单的度量值开始建的原因。</p>
</blockquote>
<h4 id="用例02-添加限制条件，缩小上下文"><a href="#用例02-添加限制条件，缩小上下文" class="headerlink" title="用例02 | 添加限制条件，缩小上下文"></a>用例02 | 添加限制条件，缩小上下文</h4><blockquote>
<p>建一个度量值[产品数量2]，</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">产品数量2 &#x3D; CALCULATE([产品数量],&#39;产品明细&#39;[品牌]&#x3D;&quot;苹果&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="4.jpg" alt=""></p>
<blockquote>
<p>发现只有苹果的产品计数显示出来，而其他品牌的数据没有了，这是因为CALCULATE的第二个参数的限制，只筛选品牌为“苹果”的，限制了外部的上下文，非苹果的产品都不再运算。</p>
</blockquote>
<h4 id="用例03-结合ALL函数，扩大上下文"><a href="#用例03-结合ALL函数，扩大上下文" class="headerlink" title="用例03 | 结合ALL函数，扩大上下文"></a>用例03 | 结合ALL函数，扩大上下文</h4><blockquote>
<p>新建度量值[产品数量3]，</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">产品数量3 &#x3D; CALCULATE([产品数量],ALL(&#39;产品明细&#39;))</span><br></pre></td></tr></table></figure>

<p><img src="5.jpg" alt=""></p>
<blockquote>
<p>这次的数据居然是所有产品的数量，这是因为筛选条件使用了ALL函数，ALL(‘产品明细’)的意思是清除产品明细表里的所有筛选，外部筛选器不起作用了，每行统计的都是该表中的所有产品。<br>每行的数据都是9，你可能觉得这个ALL函数没什么用，运算的数据没有什么意义，实际上当然不是这样，这个数据使用的地方非常多，比如我们想计算每个产品数量占总产品数量的比重，直接写个度量值：<br>产品占比=[产品数量]/[产品数量3]</p>
</blockquote>
<p><img src="6.jpg" alt=""></p>
<blockquote>
<p>产品占比就计算出来了，这就是统计总数的一个功能。</p>
</blockquote>
<h4 id="用例04-重置上下文"><a href="#用例04-重置上下文" class="headerlink" title="用例04 | 重置上下文"></a>用例04 | 重置上下文</h4><blockquote>
<p>新建度量值[产品数量4]，</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">产品数量4 &#x3D; CALCULATE([产品数量], all(&#39;产品明细&#39;[产品名称]),&#39;产品明细&#39;[类别]&#x3D;&quot;手机&quot;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>先用ALL函数清除外部上下文，然后又新增了一个筛选条件，类别为”手机”的产品数量，那么结果会是什么样的呢，</p>
</blockquote>
<p><img src="7.jpg" alt=""></p>
<blockquote>
<p>每一行产品的数量都是3，正好符合建立这个度量值的逻辑，被ALL清除行标签的外部筛选后，从全部产品中统计品类为”手机”的产品的数量，所以每行都返回3.</p>
</blockquote>
<h2 id="SUM"><a href="#SUM" class="headerlink" title="SUM"></a>SUM</h2><blockquote>
<p>对某个列中的所有数值求和</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SUM(&lt;column&gt;)</span><br></pre></td></tr></table></figure>

<h2 id="SUMX"><a href="#SUMX" class="headerlink" title="SUMX"></a>SUMX</h2><blockquote>
<p>返回为表中的每一行计算的表达式的和</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SUMX(&lt;table&gt;, &lt;expression&gt;)</span><br><span class="line">eg:商机金额预估_基础 &#x3D; CALCULATE(SUMX(&#39;Opportunityproduct&#39;,&#39;Opportunityproduct&#39;[需求数量]*&#39;Opportunityproduct&#39;[预计成交单价(万元)]))*10000</span><br></pre></td></tr></table></figure>


<blockquote>
<p>SUMX 函数将表或返回表的表达式作为其第一个参数。 第二个参数是包含要计算总和的数字的列，或计算结果为列的表达式。<br>仅对列中的数字进行计数。 空白、逻辑值和文本会被忽略。</p>
</blockquote>
<h2 id="SUM-amp-SUMX"><a href="#SUM-amp-SUMX" class="headerlink" title="SUM &amp; SUMX"></a>SUM &amp; SUMX</h2><blockquote>
<p>SUM是列级别聚合函数（不逐行计算），SUMX是行级别聚合函数（逐行计算）</p>
</blockquote>
<h2 id="USERELATIONSHIP"><a href="#USERELATIONSHIP" class="headerlink" title="USERELATIONSHIP"></a>USERELATIONSHIP</h2><blockquote>
<p>如下图，虚线关系为当前不可用关系，但以使用USERELATIONSHIP函数为度量值指定相关关系</p>
</blockquote>
<p><img src="8.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">最终客户销售金额 &#x3D; CALCULATE([销售金额],USERELATIONSHIP(Account[客户识别码],OrderShipment[最终客户识别码]))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>powerBI</tag>
        <tag>DAX函数</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL执行顺序</title>
    <url>/2020/10/29/SQL%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/</url>
    <content><![CDATA[<p>1、from子句组装来自不同数据源的数据（包括join on）；</p>
<p>2、where子句基于指定的条件对记录行进行筛选；</p>
<p>3、group by子句将数据划分为多个分组；</p>
<p>4、使用聚集函数进行计算；</p>
<p>5、使用having子句筛选分组；</p>
<p>6、计算所有的表达式；</p>
<p>7、select 集合输出；</p>
<p>8、使用order by对结果集进行排序。</p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>SQL语法</tag>
      </tags>
  </entry>
  <entry>
    <title>About Me</title>
    <url>/2020/04/17/aboutMe/</url>
    <content><![CDATA[<blockquote>
<p>A Coder, live in XuZhou, China .  </p>
</blockquote>
<ul>
<li>姓名：李明华</li>
<li>现居：江苏徐州</li>
<li>GitHub：<a href="https://github.com/LiMingHuaGit" target="_blank" rel="noopener">LiMingHuaGit</a></li>
<li>QQ：<a href="qq.com/">2290320152</a></li>
<li>微信：<a href="wechat.com/">someonelover0</a></li>
</ul>
<img src="/2020/04/17/aboutMe/self.jpg" class="">
]]></content>
  </entry>
  <entry>
    <title>SQL调优</title>
    <url>/2020/10/21/SQL%E8%B0%83%E4%BC%98/</url>
    <content><![CDATA[<h1 id="SET-STATISTICS-XX-ON"><a href="#SET-STATISTICS-XX-ON" class="headerlink" title="SET STATISTICS XX ON"></a>SET STATISTICS XX ON</h1><blockquote>
<p>收集语句运行的统计信息</p>
</blockquote>
<h1 id="SET-STATISTICS-TIME-ON"><a href="#SET-STATISTICS-TIME-ON" class="headerlink" title="SET STATISTICS TIME ON"></a>SET STATISTICS TIME ON</h1><blockquote>
<p>输出语句做的物理读和逻辑读的数目</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">DBCC DROPCLEANBUFFERS</span><br><span class="line"><span class="comment">--清除buffer pool里的所有缓存数据</span></span><br><span class="line">DBCC FREEPROCCACHE</span><br><span class="line">GO</span><br><span class="line"><span class="comment">--清除buffer pool里的所有缓存的执行计划</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">STATISTICS</span> <span class="built_in">TIME</span> <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	a.Name,</span><br><span class="line">	b.new_level </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">Account</span> a</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> new_accountclassification b <span class="keyword">ON</span> a.AccountId = b.new_account_id </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	a.AccountId = <span class="string">'7FEC00BA-A4BA-EA11-A13F-000C29B5B96B'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">STATISTICS</span> <span class="built_in">TIME</span> <span class="keyword">OFF</span></span><br></pre></td></tr></table></figure>

<p>执行上面代码获取以下信息：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">DBCC DROPCLEANBUFFERS</span><br><span class="line"><span class="comment">--清除buffer pool里的所有缓存数据</span></span><br><span class="line">DBCC FREEPROCCACHE</span><br><span class="line">&gt; SQL Server 分析和编译时间: </span><br><span class="line">   CPU 时间 = 0 毫秒，占用时间 = 0 毫秒。</span><br><span class="line">&gt; DBCC 执行完毕。如果 DBCC 输出了错误信息，请与系统管理员联系。</span><br><span class="line">&gt; </span><br><span class="line"> SQL Server 执行时间:</span><br><span class="line">   CPU 时间 = 328 毫秒，占用时间 = 332 毫秒。</span><br><span class="line">&gt; DBCC 执行完毕。如果 DBCC 输出了错误信息，请与系统管理员联系。</span><br><span class="line">&gt; </span><br><span class="line"> SQL Server 执行时间:</span><br><span class="line">   CPU 时间 = 15 毫秒，占用时间 = 10 毫秒。</span><br><span class="line">&gt; OK</span><br><span class="line">&gt; 时间: 0.35s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--清除buffer pool里的所有缓存的执行计划</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">STATISTICS</span> <span class="built_in">TIME</span> <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	a.Name,</span><br><span class="line">	b.new_level </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">Account</span> a</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> new_accountclassification b <span class="keyword">ON</span> a.AccountId = b.new_account_id </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	a.AccountId = <span class="string">'7FEC00BA-A4BA-EA11-A13F-000C29B5B96B'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">STATISTICS</span> <span class="built_in">TIME</span> <span class="keyword">OFF</span></span><br><span class="line">&gt; <span class="keyword">SQL</span> <span class="keyword">Server</span> 分析和编译时间: </span><br><span class="line">   CPU 时间 = <span class="number">203</span> 毫秒，占用时间 = <span class="number">278</span> 毫秒。</span><br><span class="line">&gt; </span><br><span class="line"> <span class="keyword">SQL</span> <span class="keyword">Server</span> 执行时间:</span><br><span class="line">   CPU 时间 = <span class="number">0</span> 毫秒，占用时间 = <span class="number">0</span> 毫秒。</span><br><span class="line">&gt; </span><br><span class="line"> <span class="keyword">SQL</span> <span class="keyword">Server</span> 执行时间:</span><br><span class="line">   CPU 时间 = <span class="number">0</span> 毫秒，占用时间 = <span class="number">5</span> 毫秒。</span><br><span class="line">&gt; OK</span><br><span class="line">&gt; 时间: <span class="number">0.295</span>s</span><br></pre></td></tr></table></figure>

<h2 id="CPU时间"><a href="#CPU时间" class="headerlink" title="CPU时间"></a>CPU时间</h2><blockquote>
<p>这个值的含义指的是在这一步，SQLSERVER所花的纯CPU时间是多少。也就是说，语句花了多少CPU资源。</p>
</blockquote>
<h2 id="占用时间"><a href="#占用时间" class="headerlink" title="占用时间"></a>占用时间</h2><blockquote>
<p>此值指这一步一共用了多少时间。也就是说，这是语句运行的时间长短，有些动作会发生I/O操作，产生了I/O等待，或者是遇到阻塞、产生了阻塞等待。总之时间用掉了，但是没有用CPU资源。所以占用时间比CPU时间长是很正常的 ，但是CPU时间是语句在所有CPU上的时间总和。如果语句使用了多颗CPU，而其他等待几乎没有，那么CPU时间大于占用时间也是正常的。</p>
</blockquote>
<h2 id="分析和编译时间"><a href="#分析和编译时间" class="headerlink" title="分析和编译时间"></a>分析和编译时间</h2><blockquote>
<p>这一步，就是语句的编译时间。由于语句运行之前清空了所有执行计划，SQLSERVER必须要对他编译。这里的编译时间就不为0了。由于编译主要是CPU的运算，所以一般CPU时间和占用时间是差不多的。如果这里相差比较大，就有必要看看SQLSERVER在系统资源上有没有瓶颈了。这里他们是一个15毫秒，一个是104毫秒。</p>
</blockquote>
<h2 id="SQLSERVER执行时间"><a href="#SQLSERVER执行时间" class="headerlink" title="SQLSERVER执行时间"></a>SQLSERVER执行时间</h2><blockquote>
<p>语句真正运行的时间。由于语句是第一次运行，SQLSERVER需要把数据从磁盘读到内存里，这里语句的运行发生了5毫秒的I/O等待。</p>
</blockquote>
<h2 id="关键字go"><a href="#关键字go" class="headerlink" title="关键字go"></a>关键字go</h2><blockquote>
<p>go 向 SQL Server 实用工具发出一批 Transact-SQL 语句结束的信号。<br>例如当某一语句要求必须是查询批次中的第一个语句，则可以在前面加上go来终结上一个批处理，使其成为下一个批处理的开头。<br>CREATE DEFAULT, CREATE FUNCTION, CREATE PROCEDURE, CREATE RULE, CREATE SCHEMA, CREATE TRIGGER, CREATE VIEW </p>
</blockquote>
<h1 id="SET-STATISTICS-IO-ON"><a href="#SET-STATISTICS-IO-ON" class="headerlink" title="SET STATISTICS IO ON"></a>SET STATISTICS IO ON</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">STATISTICS</span> IO <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	a.Name,</span><br><span class="line">	b.new_level </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">Account</span> a</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> new_accountclassification b <span class="keyword">ON</span> a.AccountId = b.new_account_id </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	a.AccountId = <span class="string">'7FEC00BA-A4BA-EA11-A13F-000C29B5B96B'</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">STATISTICS</span> IO <span class="keyword">OFF</span>;</span><br></pre></td></tr></table></figure>
<p>执行上面代码获取以下信息：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&gt; 表 'new_accountclassificationBase'。扫描计数 1，逻辑读取 6 次，物理读取 0 次，预读 0 次，lob 逻辑读取 0 次，lob 物理读取 0 次，lob 预读 0 次。</span><br><span class="line">&gt; 表 'AccountBase'。扫描计数 0，逻辑读取 4 次，物理读取 0 次，预读 0 次，lob 逻辑读取 0 次，lob 物理读取 0 次，lob 预读 0 次。</span><br></pre></td></tr></table></figure>
<h2 id="表"><a href="#表" class="headerlink" title="表"></a>表</h2><blockquote>
<p>表的名称。</p>
</blockquote>
<h2 id="扫描计数"><a href="#扫描计数" class="headerlink" title="扫描计数"></a>扫描计数</h2><blockquote>
<p>执行的扫描次数。按照执行计划，表格被扫描了几次。一般来讲大表扫描的次数越多越不好。唯一的例外是如果执行计划选择了并发运行，由多个thread线程同时做一个表的读取，每个thread读其中的一部分，但是这里会显示所有thread的数目。也就是有几个thread在并发做，就会有几个扫描。这时数目大一点没问题的。</p>
</blockquote>
<h2 id="逻辑读取"><a href="#逻辑读取" class="headerlink" title="逻辑读取"></a>逻辑读取</h2><blockquote>
<p>从数据缓存读取的页数。页数越多，说明查询要访问的数据量就越大，内存消耗量越大，查询也就越昂贵。可以检查是否应该调整索引，减少扫描的次数，缩小扫描范围。<br>顺便说一下这个逻辑读取的统计原理：为什麽显示出来的结果的单位不是Page，也不是K或KB。SQLSERVER里在做读和写的时候，会运行到某一段特定的代码。每调用一次这个代码，Reads/Write就会加1。所以这个值比较大那语句一定做了比较多的I/O，但是不能通过这个值计算出I/O的绝对数量，这个值反映的是逻辑读写量不是物理读写量。</p>
</blockquote>
<h2 id="物理读取"><a href="#物理读取" class="headerlink" title="物理读取"></a>物理读取</h2><blockquote>
<p>从磁盘读取的页数</p>
</blockquote>
<h2 id="预读"><a href="#预读" class="headerlink" title="预读"></a>预读</h2><blockquote>
<p>为进行查询而预读入缓存的页数</p>
</blockquote>
<h2 id="物理读取-预读"><a href="#物理读取-预读" class="headerlink" title="物理读取+预读"></a>物理读取+预读</h2><blockquote>
<p>就是SQLSERVER为了完成这句查询而从磁盘上读取的页数。如果不为0，说明数据没有缓存在内存里。运行速度一定会受到影响</p>
</blockquote>
<h2 id="LOB逻辑读取"><a href="#LOB逻辑读取" class="headerlink" title="LOB逻辑读取"></a>LOB逻辑读取</h2><blockquote>
<p>从数据缓存读取的text、ntext、image、大值类型（varchar(max)、nvarchar(max)、varbinary(max)）页的数目</p>
</blockquote>
<h2 id="LOB物理读取"><a href="#LOB物理读取" class="headerlink" title="LOB物理读取"></a>LOB物理读取</h2><blockquote>
<p>从磁盘读取的text、ntext、image、大值类型页的数目</p>
</blockquote>
<h2 id="LOB预读"><a href="#LOB预读" class="headerlink" title="LOB预读"></a>LOB预读</h2><blockquote>
<p>为进行查询而放入缓存的text、ntext、image、大值类型页的数目</p>
</blockquote>
<h1 id="SET-STATISTICS-PROFILE-ON"><a href="#SET-STATISTICS-PROFILE-ON" class="headerlink" title="SET STATISTICS PROFILE ON"></a>SET STATISTICS PROFILE ON</h1><blockquote>
<p>返回语句的执行计划，以及语句运行在每一步的实际返回行数统计</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">STATISTICS</span> PROFILE <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	a.Name,</span><br><span class="line">	b.new_level </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">Account</span> a</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> new_accountclassification b <span class="keyword">ON</span> a.AccountId = b.new_account_id </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	a.AccountId = <span class="string">'7FEC00BA-A4BA-EA11-A13F-000C29B5B96B'</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">STATISTICS</span> PROFILE <span class="keyword">OFF</span></span><br></pre></td></tr></table></figure>
<p>会返回另外的一个结果如下图：<br><img src="1.jpg" alt=""><br>注意：这里是从最下面开始向上看的，也就是说从最下面开始一直执行直到得到结果集所以（行1）里的rows字段显示的值就是这个查询返回的结果集。而且有多少行表明SQLSERVER执行了多少个步骤,这里有6行，表明SQLSRVER执行了6个步骤！！</p>
<h2 id="Rows"><a href="#Rows" class="headerlink" title="Rows"></a>Rows</h2><blockquote>
<p>执行计划的每一步返回的实际行数</p>
</blockquote>
<h2 id="Executes"><a href="#Executes" class="headerlink" title="Executes"></a>Executes</h2><blockquote>
<p>执行计划的每一步被运行了多少次</p>
</blockquote>
<h2 id="StmtText"><a href="#StmtText" class="headerlink" title="StmtText"></a>StmtText</h2><blockquote>
<p>执行计划的具体内容。执行计划以一棵树的形式显示。每一行都是运行的一步，都会有结果集返回，也都会有自己的cost</p>
</blockquote>
<h2 id="EstimateRows"><a href="#EstimateRows" class="headerlink" title="EstimateRows"></a>EstimateRows</h2><blockquote>
<p>SQLSERVER根据表格上的统计信息，预估的每一步的返回行数。在分析执行计划时，我们会经常将Rows和EstimateRows这两列做对比，先确认SQLSERVER预估得是否正确，以判断统计信息是否有更新</p>
</blockquote>
<h2 id="EstimateIO"><a href="#EstimateIO" class="headerlink" title="EstimateIO"></a>EstimateIO</h2><blockquote>
<p>SQLSERVER根据EstimateRows和统计信息里记录的字段长度，预估的每一步会产生的I/O cost</p>
</blockquote>
<h2 id="EstimateCPU"><a href="#EstimateCPU" class="headerlink" title="EstimateCPU"></a>EstimateCPU</h2><blockquote>
<p>SQLSERVR根据EstimateRows和统计信息里记录的字段长度，以及要做的事情的复杂度，预估每一步会产生的CPU cost</p>
</blockquote>
<h2 id="TotalSubtreeCost"><a href="#TotalSubtreeCost" class="headerlink" title="TotalSubtreeCost"></a>TotalSubtreeCost</h2><blockquote>
<p>SQLSERVER根据EstimateIO和EstimateCPU通过某种计算公式，计算出每一步执行计划子树的cost(包括这一步自己的cost和他的所有下层步骤的cost总和)</p>
</blockquote>
<h2 id="Warnings"><a href="#Warnings" class="headerlink" title="Warnings"></a>Warnings</h2><blockquote>
<p>SQLSERVER在运行每一步时遇到的警告，例如，某一步没有统计信息支持cost预估等。</p>
</blockquote>
<h2 id="Parallel"><a href="#Parallel" class="headerlink" title="Parallel"></a>Parallel</h2><blockquote>
<p>执行计划的这一步是不是使用了并行的执行计划</p>
</blockquote>
<h2 id="具体步骤分析"><a href="#具体步骤分析" class="headerlink" title="具体步骤分析"></a>具体步骤分析</h2><p>执行计划的具体内容如下图：<br><img src="2.jpg" alt=""></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>SQL Server</tag>
        <tag>数据库</tag>
        <tag>优化</tag>
        <tag>SQL调优</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue判断对象为空</title>
    <url>/2020/12/04/Vue%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E4%B8%BA%E7%A9%BA/</url>
    <content><![CDATA[<h2 id="vue中可用"><a href="#vue中可用" class="headerlink" title="vue中可用"></a>vue中可用</h2><h3 id="JSON-stringify"><a href="#JSON-stringify" class="headerlink" title="JSON.stringify"></a>JSON.stringify</h3><blockquote>
<p>JSON.stringify(evtValue)==’{}’</p>
</blockquote>
<h3 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h3><blockquote>
<p>Object.keys(xxx).length==0</p>
</blockquote>
<h2 id="js判断对象是否为空对象的几种方法"><a href="#js判断对象是否为空对象的几种方法" class="headerlink" title="js判断对象是否为空对象的几种方法"></a>js判断对象是否为空对象的几种方法</h2><h3 id="将json对象转化为json字符串"><a href="#将json对象转化为json字符串" class="headerlink" title="将json对象转化为json字符串"></a>将json对象转化为json字符串</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> b = (<span class="built_in">JSON</span>.stringify(data) == <span class="string">"&#123;&#125;"</span>);</span><br><span class="line">alert(b);<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h3 id="for-in-循环判断"><a href="#for-in-循环判断" class="headerlink" title="for in 循环判断"></a>for in 循环判断</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">alert(b());<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h3 id="jquery的isEmptyObject方法"><a href="#jquery的isEmptyObject方法" class="headerlink" title="jquery的isEmptyObject方法"></a>jquery的isEmptyObject方法</h3><blockquote>
<p>此方法是jquery将for in方法进行封装，使用时需要依赖jquery</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> b = $.isEmptyObject(data);</span><br><span class="line">alert(b);<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h3 id="Object-getOwnPropertyNames-方法"><a href="#Object-getOwnPropertyNames-方法" class="headerlink" title="Object.getOwnPropertyNames()方法"></a>Object.getOwnPropertyNames()方法</h3><blockquote>
<p>此方法是使用Object对象的getOwnPropertyNames方法，获取到对象中的属性名，存到一个数组中，返回数组对象，我们可以通过判断数组的length来判断此对象是否为空.注意：此方法不兼容ie8，其余浏览器没有测试</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> arr = <span class="built_in">Object</span>.getOwnPropertyNames(data);</span><br><span class="line">alert(arr.length == <span class="number">0</span>);<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h3 id="使用ES6的Object-keys-方法"><a href="#使用ES6的Object-keys-方法" class="headerlink" title="使用ES6的Object.keys()方法"></a>使用ES6的Object.keys()方法</h3><blockquote>
<p>与上个方法类似，是ES6的新方法, 返回值也是对象中属性名组成的数组</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> arr = <span class="built_in">Object</span>.keys(data);</span><br><span class="line">alert(arr.length == <span class="number">0</span>);<span class="comment">//true</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>vue</tag>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL连接符、表达式及函数</title>
    <url>/2020/10/29/SQL%E8%BF%9E%E6%8E%A5%E7%AC%A6%E3%80%81%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8F%8A%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h1 id="连接符"><a href="#连接符" class="headerlink" title="连接符"></a>连接符</h1><h2 id="连接符-1"><a href="#连接符-1" class="headerlink" title="+ 连接符"></a>+ 连接符</h2><blockquote>
<p>连接表中数据类型相同或近似的列，若数据类型完全不同，则需通过CAST表达式进行类型转换，若其中一列为NULL则结果为NULL</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	TOP <span class="number">3</span></span><br><span class="line">	new_country_idName + <span class="string">'--'</span> +new_city_idName <span class="keyword">AS</span> Adress,</span><br><span class="line">	<span class="keyword">Name</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">Account</span></span><br></pre></td></tr></table></figure>
<p><img src="1.jpg" alt=""></p>
<h1 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h1><h2 id="CAST表达式"><a href="#CAST表达式" class="headerlink" title="CAST表达式"></a>CAST表达式</h2><blockquote>
<p>转换数据类型，若数据为空则转换结果为NULL</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	TOP <span class="number">3</span></span><br><span class="line">	new_country_idName + <span class="string">'--'</span> +new_city_idName <span class="keyword">AS</span> Adress,</span><br><span class="line">	<span class="keyword">Name</span> + new_age <span class="keyword">AS</span> Mesg</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">Account</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&gt; [<span class="number">42000</span>] [Microsoft][ODBC Driver <span class="number">17</span> <span class="keyword">for</span> <span class="keyword">SQL</span> <span class="keyword">Server</span>][<span class="keyword">SQL</span> <span class="keyword">Server</span>]从数据类型 <span class="keyword">nvarchar</span> 转换为 <span class="built_in">numeric</span> 时出错。 (<span class="number">8114</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	TOP <span class="number">3</span></span><br><span class="line">	new_country_idName + <span class="string">'--'</span> +new_city_idName <span class="keyword">AS</span> Adress,</span><br><span class="line">	<span class="keyword">Name</span> + <span class="keyword">CAST</span>(new_age <span class="keyword">AS</span> <span class="built_in">VARCHAR</span>(<span class="number">256</span>)) <span class="keyword">AS</span> Mesg</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">Account</span></span><br></pre></td></tr></table></figure>
<p><img src="2.jpg" alt=""></p>
<h2 id="CASE表达式"><a href="#CASE表达式" class="headerlink" title="CASE表达式"></a>CASE表达式</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	TOP <span class="number">3</span></span><br><span class="line">	new_country_idName + <span class="string">'--'</span> +new_city_idName <span class="keyword">AS</span> Adress,</span><br><span class="line">	<span class="keyword">Name</span>,</span><br><span class="line">	<span class="keyword">CASE</span> </span><br><span class="line">	<span class="keyword">WHEN</span> <span class="keyword">Name</span> = <span class="string">'李老板'</span> <span class="keyword">THEN</span> <span class="string">'李老板好'</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="keyword">Name</span> = <span class="string">'高永平'</span> <span class="keyword">THEN</span> <span class="string">'高老板好'</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">'您好'</span></span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">AS</span> Say</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">Account</span></span><br></pre></td></tr></table></figure>
<p><img src="3.jpg" alt=""></p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><blockquote>
<p>对列中某个数据进行处理并返回值</p>
</blockquote>
<h2 id="字符串操作函数"><a href="#字符串操作函数" class="headerlink" title="字符串操作函数"></a>字符串操作函数</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">---字符中操作函数</span></span><br><span class="line">UPPER(S) 将字符串统一为大写字母</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">UPPER</span>(<span class="string">'asasA'</span>)   <span class="comment">--ASASA</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">LOWER</span>(S) 将字符串统一为小写字母</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOWER</span>(<span class="string">'asasA'</span>)   <span class="comment">---asasa</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">LEN</span>(S)   返回字符串的长度</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEN</span>(<span class="string">'中国1号'</span>) <span class="comment">--4</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">CHARINDEX</span>(S1,S2) 返回S1在字符串S2中的位置  </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHARINDEX</span>(<span class="string">'aa1号'</span>,<span class="string">'1111aa1号中国1号'</span>) <span class="comment">--5</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SUBSTRING</span>(S,I,N) 在S字符串中的第I个字符起取N个字符</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTRING</span>(<span class="string">'TECHNOLO'</span>,<span class="number">3</span>,<span class="number">3</span>) <span class="comment">--CHN</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONVERT</span>(<span class="built_in">INT</span>,<span class="string">'111'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">LEFT</span>(S,N) 从字符串S左边取N个字符</span><br><span class="line"><span class="keyword">RIGHT</span>(S,N) 从字符串S右边取N个字符</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">'00000000'</span>+<span class="string">'11'</span>,<span class="number">8</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">'00000000'</span>+<span class="string">'2222'</span>,<span class="number">8</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">'11'</span>+<span class="string">'00000000'</span>+<span class="string">'11'</span>,<span class="number">8</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">'2222'</span>+<span class="string">'00000000'</span>+<span class="string">'2222'</span>,<span class="number">8</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">SPACE</span>(N) 生成N个空格</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">'合计'</span>+<span class="keyword">SPACE</span>(<span class="number">2</span>)+<span class="string">'123'</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">RTRIM</span>(S) <span class="comment">--消除字符串左边开始或者右边开始的空格</span></span><br><span class="line"><span class="keyword">LTRIM</span>(S) <span class="comment">--消除字符串左边开始或者右边开始的空格</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(<span class="string">'      SAMPLE   '</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LTRIM</span>(<span class="string">'      SAMPLE   '</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LTRIM</span>(<span class="keyword">RTRIM</span>(<span class="string">'     SAMPLE   '</span>));</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">REPLACE</span>(<span class="keyword">STRING</span>,ATOREPLACE,NEWSTRING) <span class="comment">--替换函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">REPLACE</span>(<span class="string">'HHAAAH'</span>,<span class="string">'A'</span>,<span class="string">'S'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">abs(numeric_expr) <span class="comment">--求绝对值</span></span><br><span class="line">ceiling(numeric_expr) <span class="comment">--取大于等于指定值的最小整数</span></span><br><span class="line">exp(float_expr) <span class="comment">--取指数</span></span><br><span class="line">floor(numeric_expr) <span class="comment">--小于等于指定值得最大整数</span></span><br><span class="line">power(numeric_expr,power) <span class="comment">--返回power次方</span></span><br><span class="line">rand([int_expr]) <span class="comment">--随机数产生器</span></span><br><span class="line">round(numeric_expr,int_expr) <span class="comment">--安int_expr规定的精度四舍五入</span></span><br><span class="line">sign(int_expr) <span class="comment">--根据正数,0,负数,,返回+1,0,-1</span></span><br><span class="line">sqrt(float_expr) <span class="comment">--平方根</span></span><br><span class="line">exp(float x) <span class="comment">--求e的x次幂</span></span><br><span class="line">tan(float x) <span class="comment">--计算x（弧度表示）的正切值。</span></span><br><span class="line">atan(float x) <span class="comment">--求x（弧度表示）的反正切值</span></span><br><span class="line">cos(float x) <span class="comment">--求x（弧度表示）的余弦值</span></span><br><span class="line">acos(float x) <span class="comment">--求x（弧度表示）的反余弦值</span></span><br><span class="line">sin(float x) <span class="comment">--计算x（弧度表示）的正弦值。</span></span><br><span class="line">asin(float x) <span class="comment">--求x（弧度表示）的反正弦值</span></span><br><span class="line">fabs(float x) <span class="comment">--求浮点数x的绝对值</span></span><br><span class="line">fmod(float x, float y) <span class="comment">--计算x/y的余数</span></span><br><span class="line">pow(float x, float y) <span class="comment">--计算x的y次幂。</span></span><br><span class="line">sqrt(float x) <span class="comment">--计算x的平方根。</span></span><br></pre></td></tr></table></figure>

<h2 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">getdate() <span class="comment">--返回日期</span></span><br><span class="line">datename(datepart,date_expr) <span class="comment">--返回名称</span></span><br><span class="line">datepart(datepart,date_expr) <span class="comment">--取日期一部份</span></span><br><span class="line">datediff(datepart,date_expr1.dateexpr2) <span class="comment">--日期差</span></span><br><span class="line">dateadd(datepart,number,date_expr) <span class="comment">--返回日期加上 number</span></span><br><span class="line">day(date_expr), month(date_expr),year(date_expr) <span class="comment">--提取date_expr中的日月年</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>SQL语法</tag>
      </tags>
  </entry>
  <entry>
    <title>dll注册上传问题</title>
    <url>/2020/12/14/dll%E6%B3%A8%E5%86%8C%E4%B8%8A%E4%BC%A0%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="类文件冲突"><a href="#类文件冲突" class="headerlink" title="类文件冲突"></a>类文件冲突</h2><blockquote>
<p>原因是项目组同事新建了类文件没有上传，导致dll无法注册<br>像plugin，操作，流程都会这样，原来有的类文件要有不然是注册不了的<br><img src="1.png" alt=""></p>
</blockquote>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>踩坑</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/04/17/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>jdk1.8_lambda</title>
    <url>/2020/06/24/jdk1-8-lambda/</url>
    <content><![CDATA[<blockquote>
<p>参考Haskell-函数式编程</p>
</blockquote>
<h1 id="核心功能性函数接口（有且只有一个抽象方法的接口）"><a href="#核心功能性函数接口（有且只有一个抽象方法的接口）" class="headerlink" title="核心功能性函数接口（有且只有一个抽象方法的接口）"></a>核心功能性函数接口（有且只有一个抽象方法的接口）</h1><ul>
<li>Consumer<T> :消费型接口    void acept(T t);<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//消费型接口Consumer，输入一个参数，对其进行打印输出</span></span><br><span class="line"> Consumer&lt;String&gt; consumer = (x) -&gt; System.out.println(x);</span><br><span class="line"> <span class="comment">//打印字符串</span></span><br><span class="line"> consumer.accept(<span class="string">"Hello world!"</span>);</span><br></pre></td></tr></table></figure></li>
<li>Supplier<T> :供给型接口    T get();<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//供给型接口Supplier，返回指定字符串</span></span><br><span class="line">Supplier&lt;String&gt; supplier = () -&gt; <span class="string">"Hello world!"</span>;</span><br><span class="line"><span class="comment">//获取字符串</span></span><br><span class="line">supplier.get();</span><br></pre></td></tr></table></figure></li>
<li>Function&lt;T,R&gt; :函数型接口 R apply(T t);<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Function&lt;String, Integer&gt; function = (x) -&gt; x.length();</span><br><span class="line"><span class="comment">//获取字符串长度</span></span><br><span class="line">function.apply(<span class="string">"Hello world!"</span>);</span><br></pre></td></tr></table></figure></li>
<li>Predicate<T> :断言型接口 boolean test(T t);<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//断言型接口Predicate，输入数字，判断是否大于0</span></span><br><span class="line">Predicate&lt;Integer&gt; predicate = (x) -&gt; x &gt; <span class="number">0</span>;</span><br><span class="line"><span class="comment">//获取判断结果</span></span><br><span class="line">predicate.test(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><h2 id="1-Iterable-forEach-Consumer-lt-super-T-gt-action"><a href="#1-Iterable-forEach-Consumer-lt-super-T-gt-action" class="headerlink" title="1.Iterable.forEach(Consumer&lt;? super T&gt; action)"></a>1.Iterable.forEach(Consumer&lt;? super T&gt; action)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; soutList = Arrays.asList(<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>);</span><br><span class="line">soutList.forEach(out-&gt; System.out.println(out));</span><br><span class="line">soutList.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">Page p = <span class="keyword">new</span> Page(<span class="string">"content"</span>);</span><br><span class="line">Page p = Page.<span class="keyword">new</span>(<span class="string">"content"</span>);</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Stream&lt;Page&gt; <span class="title">createPagesFrom</span><span class="params">(Stream&lt;String&gt;; contents)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> contents.map(Page::<span class="keyword">new</span>).</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="1.jpg" alt="Iterable接口"><br> <img src="2.jpg" alt="forEach方法"></p>
<h3 id="1-Iterable接口允许一个对象成为forEach的目标"><a href="#1-Iterable接口允许一个对象成为forEach的目标" class="headerlink" title="1). Iterable接口允许一个对象成为forEach的目标"></a>1). Iterable接口允许一个对象成为forEach的目标</h3><h3 id="2-这里的forEach被声明为一个默认方法，并接收了一个消费者类型的函数接口，先查找匹配对应的操作，若不为空则执行操作"><a href="#2-这里的forEach被声明为一个默认方法，并接收了一个消费者类型的函数接口，先查找匹配对应的操作，若不为空则执行操作" class="headerlink" title="2). 这里的forEach被声明为一个默认方法，并接收了一个消费者类型的函数接口，先查找匹配对应的操作，若不为空则执行操作"></a>2). 这里的forEach被声明为一个默认方法，并接收了一个消费者类型的函数接口，先查找匹配对应的操作，若不为空则执行操作</h3><h3 id="3-接口中的默认方法可以不被实现类实现"><a href="#3-接口中的默认方法可以不被实现类实现" class="headerlink" title="3). 接口中的默认方法可以不被实现类实现"></a>3). 接口中的默认方法可以不被实现类实现</h3><h3 id="4-如上代码中，输出集合soutList调用了foreach方法，箭头左边是参数，右边是抽象方法的实现内容或已有方法的引用"><a href="#4-如上代码中，输出集合soutList调用了foreach方法，箭头左边是参数，右边是抽象方法的实现内容或已有方法的引用" class="headerlink" title="4). 如上代码中，输出集合soutList调用了foreach方法，箭头左边是参数，右边是抽象方法的实现内容或已有方法的引用"></a>4). 如上代码中，输出集合soutList调用了foreach方法，箭头左边是参数，右边是抽象方法的实现内容或已有方法的引用</h3><h3 id="5-当参数列表中的参数和方法签名匹配时，可以通过-直接引用方法，包括构造方法"><a href="#5-当参数列表中的参数和方法签名匹配时，可以通过-直接引用方法，包括构造方法" class="headerlink" title="5). 当参数列表中的参数和方法签名匹配时，可以通过 :: 直接引用方法，包括构造方法"></a>5). 当参数列表中的参数和方法签名匹配时，可以通过 :: 直接引用方法，包括构造方法</h3><h2 id="2-Collection-stream-、Stream、Stream-filter-Predicate-、Collector、Collectors、Collectors-toList"><a href="#2-Collection-stream-、Stream、Stream-filter-Predicate-、Collector、Collectors、Collectors-toList" class="headerlink" title="2.Collection.stream()、Stream、Stream#filter(Predicate)、Collector、Collectors、Collectors#toList()"></a>2.Collection.stream()、Stream、Stream#filter(Predicate)、Collector、Collectors、Collectors#toList()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Complete this for Exercise_2_Test#getAllPersonsEligibleToVote</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">* 根据给定年龄返回给定选民集合中合法年龄的选民集合</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> potentialVoters - voters to filter</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> legalAgeOfVoting - age where it's legal to vote</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> a list of eligible voters</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Person&gt; <span class="title">eligibleVoters</span><span class="params">(List&lt;Person&gt; potentialVoters, <span class="keyword">int</span> legalAgeOfVoting)</span> </span>&#123;</span><br><span class="line">      Stream&lt;Person&gt; personStream = potentialVoters.stream().filter(</span><br><span class="line">              person -&gt; person.getAge()&gt;=legalAgeOfVoting</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> personStream.collect(Collectors.toList());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-Collection-stream-返回一个Stream序列"><a href="#1-Collection-stream-返回一个Stream序列" class="headerlink" title="1). Collection#stream() 返回一个Stream序列"></a>1). Collection#stream() 返回一个Stream序列</h3><h3 id="2-Stream-流"><a href="#2-Stream-流" class="headerlink" title="2). Stream 流"></a>2). Stream 流</h3><pre><code>- A sequence of elements supporting sequential and parallel aggregate operations
- 支撑顺序和并行聚合操作元素的序列
- lazy： computation on the source data is only performed when the terminal operation is initiated, and source elements are consumed only as needed.
- 惰式执行：即仅在终端操作启动时才执行对源数据的计算，并且仅在需要时使用源元素。
- 在对流进行“操作”（类似查询和过滤）时，这些行为应该是无干扰（不修改流的数据源）且无状态（其结果不依赖于流管道执行过程中可能改变的任何状态）的
- 消费性质，只使用一次，不可以被重用</code></pre><h3 id="3-Stream-filter-Predicate-对流进行过滤-中间操作"><a href="#3-Stream-filter-Predicate-对流进行过滤-中间操作" class="headerlink" title="3). Stream#filter(Predicate)  对流进行过滤 中间操作"></a>3). Stream#filter(Predicate)  对流进行过滤 中间操作</h3><h3 id="4-Predicate-断言功能性函数接口，返回Boolean值-见上文"><a href="#4-Predicate-断言功能性函数接口，返回Boolean值-见上文" class="headerlink" title="4). Predicate 断言功能性函数接口，返回Boolean值 见上文"></a>4). Predicate 断言功能性函数接口，返回Boolean值 见上文</h3><h3 id="5-Stream-collect"><a href="#5-Stream-collect" class="headerlink" title="5). Stream.collect()"></a>5). Stream.collect()</h3><pre><code>- 返回一个结果容器 
- &lt;R, A&gt; R collect(Collector&lt;? super T, A, R&gt; collector)
- &lt;R&gt; 结果的类型
- &lt;A&gt; Collector的积累类型</code></pre><h3 id="6-Collector-执行结果转换-Collectors-实现Collector的各种还原操作"><a href="#6-Collector-执行结果转换-Collectors-实现Collector的各种还原操作" class="headerlink" title="6). Collector 执行结果转换 Collectors 实现Collector的各种还原操作"></a>6). Collector 执行结果转换 Collectors 实现Collector的各种还原操作</h3><pre><code>- public interface Collector&lt;T, A, R&gt;
- &lt;T&gt;  输入元素的类型
- &lt;A&gt;  还原运算的可变累积型（通常隐藏作为一个实现细节）
- &lt;R&gt;  还原运算的结果类</code></pre><h3 id="7-Collectors-toList-返回一个Collector-，其累积的输入元素融入到一个新的List中"><a href="#7-Collectors-toList-返回一个Collector-，其累积的输入元素融入到一个新的List中" class="headerlink" title="7). Collectors#toList() 返回一个Collector ，其累积的输入元素融入到一个新的List中"></a>7). Collectors#toList() 返回一个Collector ，其累积的输入元素融入到一个新的List中</h3><pre><code>- public static &lt;T&gt; Collector&lt;T, ?, List&lt;T&gt;&gt; toList()
- &lt;T&gt;  输入元素的类型</code></pre><h2 id="3-Stream-map-Function"><a href="#3-Stream-map-Function" class="headerlink" title="3.Stream#map(Function)"></a>3.Stream#map(Function)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Apply a mapping of Books to titles (Strings)</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * 将书籍的标题映射到一个新的List&lt;String&gt;</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> books - books to transform</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> list of book titles</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">titlesOf</span><span class="params">(List&lt;Book&gt; books)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> books.stream().map(Book::getTitle).collect(Collectors.toList());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-Stream-map-Function"><a href="#1-Stream-map-Function" class="headerlink" title="1). Stream#map(Function)"></a>1). Stream#map(Function)</h3><pre><code>- 返回指定类型的流 中间操作
- Function 函数型功能接口 见上文
- java.util.stream.Stream&lt;T&gt; &lt;R&gt; Stream&lt;R&gt; map(Function&lt;? super T, ? extends R&gt; mapper)
- &lt;? super T&gt;/&lt;? extends T&gt; &lt;? super T&gt;表示包括T在内的任何T的父类，&lt;? extends T&gt;表示包括T在内的任何T的子类</code></pre>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>jkd1.8</tag>
        <tag>lambda</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk1.8_Optional</title>
    <url>/2020/08/29/jdk1-8-Optional/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><blockquote>
<p>主要用于解决空指针异常（NullPointerException）<br>类似包含有可选值的包装类，Optional 类既可以含有对象也可以为空</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A container object which may or may not contain a non-null value.</span></span><br><span class="line"><span class="comment"> * If a value is present, &#123;<span class="doctag">@code</span> isPresent()&#125; will return &#123;<span class="doctag">@code</span> true&#125; and</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> get()&#125; will return the value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Additional methods that depend on the presence or absence of a contained</span></span><br><span class="line"><span class="comment"> * value are provided, such as &#123;<span class="doctag">@link</span> #orElse(java.lang.Object) orElse()&#125;</span></span><br><span class="line"><span class="comment"> * (return a default value if value not present) and</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #ifPresent(java.util.function.Consumer) ifPresent()&#125; (execute a block</span></span><br><span class="line"><span class="comment"> * of code if the value is present).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This is a &lt;a href="../lang/doc-files/ValueBased.html"&gt;value-based&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * class; use of identity-sensitive operations (including reference equality</span></span><br><span class="line"><span class="comment"> * (&#123;<span class="doctag">@code</span> ==&#125;), identity hash code, or synchronization) on instances of</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Optional&#125; may have unpredictable results and should be avoided.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Optional</span>&lt;<span class="title">T</span>&gt; </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>
<h1 id="of-amp-ofNullable"><a href="#of-amp-ofNullable" class="headerlink" title="of()&amp;ofNullable()"></a>of()&amp;ofNullable()</h1><blockquote>
<p>构造带有值的Optional类<br>of()方法中的参数不允许为null，传入null会导致NullPointerException异常<br>若调用ofNullable()方法并传入空值则实际上相当于直接调用empty()方法实例化一个空的Optional</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; optional = Optional.of(<span class="string">"value"</span>);</span><br><span class="line">Optional&lt;String&gt; optionalNull = Optional.ofNullable(<span class="keyword">null</span>);</span><br><span class="line">Optional&lt;String&gt; emptyOpt = Optional.empty();</span><br><span class="line">System.out.println(optional.get());<span class="comment">//value</span></span><br><span class="line">System.out.println(emptyOpt.get());<span class="comment">//NoSuchElementException</span></span><br><span class="line">System.out.println(optionalNull.get());<span class="comment">//NoSuchElementException</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns an &#123;<span class="doctag">@code</span> Optional&#125; describing the specified value, if non-null,</span></span><br><span class="line"><span class="comment"> * otherwise returns an empty &#123;<span class="doctag">@code</span> Optional&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; the class of the value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the possibly-null value to describe</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an &#123;<span class="doctag">@code</span> Optional&#125; with a present value if the specified value</span></span><br><span class="line"><span class="comment"> * is non-null, otherwise an empty &#123;<span class="doctag">@code</span> Optional&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Optional&lt;T&gt; <span class="title">ofNullable</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value == <span class="keyword">null</span> ? empty() : of(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="isPresent-amp-ifPresent"><a href="#isPresent-amp-ifPresent" class="headerlink" title="isPresent()&amp;ifPresent()"></a>isPresent()&amp;ifPresent()</h1><blockquote>
<p>isPresent() 判断是否为空<br>ifPresent() 判断是否为空,不为空则执行方法内的lambda表达式(实现消费型接口)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return &#123;<span class="doctag">@code</span> true&#125; if there is a value present, otherwise &#123;<span class="doctag">@code</span> false&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if there is a value present, otherwise &#123;<span class="doctag">@code</span> false&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPresent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If a value is present, invoke the specified consumer with the value,</span></span><br><span class="line"><span class="comment"> * otherwise do nothing.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> consumer block to be executed if a value is present</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if value is present and &#123;<span class="doctag">@code</span> consumer&#125; is</span></span><br><span class="line"><span class="comment"> * null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ifPresent</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; consumer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="keyword">null</span>)</span><br><span class="line">        consumer.accept(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; optional = Optional.of(<span class="string">"value"</span>);</span><br><span class="line">Optional&lt;String&gt; optionalNull = Optional.ofNullable(<span class="keyword">null</span>);</span><br><span class="line">optional.ifPresent((s) -&gt; System.out.println(s));<span class="comment">//value</span></span><br><span class="line">optionalNull.ifPresent(System.out::println);<span class="comment">//不执行</span></span><br></pre></td></tr></table></figure>
<h1 id="orElse-amp-orElseGet-amp-orElseThrow"><a href="#orElse-amp-orElseGet-amp-orElseThrow" class="headerlink" title="orElse()&amp;orElseGet()&amp;orElseThrow()"></a>orElse()&amp;orElseGet()&amp;orElseThrow()</h1><blockquote>
<p>orElse() 若Optional对象为空值则返回方法传入的值<br>orElseGet() 若Optional对象为空值则执行方法内的lambda表达式(供给型功能函数)<br>orElseThrow() 若Optional对象为空值则抛出指定的异常(供给型功能函数)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the value if present, otherwise return &#123;<span class="doctag">@code</span> other&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> other the value to be returned if there is no value present, may</span></span><br><span class="line"><span class="comment"> * be null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the value, if present, otherwise &#123;<span class="doctag">@code</span> other&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">orElse</span><span class="params">(T other)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="keyword">null</span> ? value : other;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the value if present, otherwise invoke &#123;<span class="doctag">@code</span> other&#125; and return</span></span><br><span class="line"><span class="comment"> * the result of that invocation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> other a &#123;<span class="doctag">@code</span> Supplier&#125; whose result is returned if no value</span></span><br><span class="line"><span class="comment"> * is present</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the value if present otherwise the result of &#123;<span class="doctag">@code</span> other.get()&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if value is not present and &#123;<span class="doctag">@code</span> other&#125; is</span></span><br><span class="line"><span class="comment"> * null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">orElseGet</span><span class="params">(Supplier&lt;? extends T&gt; other)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="keyword">null</span> ? value : other.get();</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the contained value, if present, otherwise throw an exception</span></span><br><span class="line"><span class="comment"> * to be created by the provided supplier.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span> A method reference to the exception constructor with an empty</span></span><br><span class="line"><span class="comment"> * argument list can be used as the supplier. For example,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> IllegalStateException::new&#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;X&gt; Type of the exception to be thrown</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exceptionSupplier The supplier which will return the exception to</span></span><br><span class="line"><span class="comment"> * be thrown</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the present value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> X if there is no value present</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if no value is present and</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> exceptionSupplier&#125; is null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;X extends Throwable&gt; <span class="function">T <span class="title">orElseThrow</span><span class="params">(Supplier&lt;? extends X&gt; exceptionSupplier)</span> <span class="keyword">throws</span> X </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> exceptionSupplier.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; optionalNull = Optional.ofNullable(<span class="keyword">null</span>);</span><br><span class="line">System.out.println(optionalNull.orElse(<span class="string">"值为null"</span>));<span class="comment">//值为null</span></span><br><span class="line">System.out.println(optionalNull.orElseGet(()-&gt;<span class="string">"值为null"</span>));</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	optionalNull.orElseThrow(Exception::<span class="keyword">new</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="map-amp-flatMap"><a href="#map-amp-flatMap" class="headerlink" title="map()&amp;flatMap()"></a>map()&amp;flatMap()</h1><blockquote>
<p>map()方法，若传入的方法存在值，则返回方法对应类型的Optional对象，否则返回一个空的Optional<br>同样，但入参需要是Optional对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If a value is present, apply the provided mapping function to it,</span></span><br><span class="line"><span class="comment"> * and if the result is non-null, return an &#123;<span class="doctag">@code</span> Optional&#125; describing the</span></span><br><span class="line"><span class="comment"> * result.  Otherwise return an empty &#123;<span class="doctag">@code</span> Optional&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span> This method supports post-processing on optional values, without</span></span><br><span class="line"><span class="comment"> * the need to explicitly check for a return status.  For example, the</span></span><br><span class="line"><span class="comment"> * following code traverses a stream of file names, selects one that has</span></span><br><span class="line"><span class="comment"> * not yet been processed, and then opens that file, returning an</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Optional&lt;FileInputStream&gt;&#125;:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;&#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> *     Optional&lt;FileInputStream&gt; fis =</span></span><br><span class="line"><span class="comment"> *         names.stream().filter(name -&gt; !isProcessedYet(name))</span></span><br><span class="line"><span class="comment"> *                       .findFirst()</span></span><br><span class="line"><span class="comment"> *                       .map(name -&gt; new FileInputStream(name));</span></span><br><span class="line"><span class="comment"> * &#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Here, &#123;<span class="doctag">@code</span> findFirst&#125; returns an &#123;<span class="doctag">@code</span> Optional&lt;String&gt;&#125;, and then</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> map&#125; returns an &#123;<span class="doctag">@code</span> Optional&lt;FileInputStream&gt;&#125; for the desired</span></span><br><span class="line"><span class="comment"> * file if one exists.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;U&gt; The type of the result of the mapping function</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mapper a mapping function to apply to the value, if present</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an &#123;<span class="doctag">@code</span> Optional&#125; describing the result of applying a mapping</span></span><br><span class="line"><span class="comment"> * function to the value of this &#123;<span class="doctag">@code</span> Optional&#125;, if a value is present,</span></span><br><span class="line"><span class="comment"> * otherwise an empty &#123;<span class="doctag">@code</span> Optional&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if the mapping function is null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>&lt;U&gt; Optional&lt;U&gt; <span class="title">map</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends U&gt; mapper)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(mapper);</span><br><span class="line">    <span class="keyword">if</span> (!isPresent())</span><br><span class="line">        <span class="keyword">return</span> empty();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(mapper.apply(value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If a value is present, apply the provided &#123;<span class="doctag">@code</span> Optional&#125;-bearing</span></span><br><span class="line"><span class="comment"> * mapping function to it, return that result, otherwise return an empty</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Optional&#125;.  This method is similar to &#123;<span class="doctag">@link</span> #map(Function)&#125;,</span></span><br><span class="line"><span class="comment"> * but the provided mapper is one whose result is already an &#123;<span class="doctag">@code</span> Optional&#125;,</span></span><br><span class="line"><span class="comment"> * and if invoked, &#123;<span class="doctag">@code</span> flatMap&#125; does not wrap it with an additional</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Optional&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;U&gt; The type parameter to the &#123;<span class="doctag">@code</span> Optional&#125; returned by</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mapper a mapping function to apply to the value, if present</span></span><br><span class="line"><span class="comment"> *           the mapping function</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the result of applying an &#123;<span class="doctag">@code</span> Optional&#125;-bearing mapping</span></span><br><span class="line"><span class="comment"> * function to the value of this &#123;<span class="doctag">@code</span> Optional&#125;, if a value is present,</span></span><br><span class="line"><span class="comment"> * otherwise an empty &#123;<span class="doctag">@code</span> Optional&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if the mapping function is null or returns</span></span><br><span class="line"><span class="comment"> * a null result</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>&lt;U&gt; Optional&lt;U&gt; <span class="title">flatMap</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, Optional&lt;U&gt;&gt; mapper)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(mapper);</span><br><span class="line">    <span class="keyword">if</span> (!isPresent())</span><br><span class="line">        <span class="keyword">return</span> empty();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.requireNonNull(mapper.apply(value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlightTicketInfo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String orderNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOrderNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderNumber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OptionalTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FlightTicketInfo flightTicketInfo = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        Optional&lt;Optional&lt;String&gt;&gt; s1 = Optional.ofNullable(flightTicketInfo).</span><br><span class="line">			map(OptionalTest::getOrderNumber);</span><br><span class="line"></span><br><span class="line">        Optional&lt;String&gt; s2 = Optional.ofNullable(flightTicketInfo).</span><br><span class="line">			map(FlightTicketInfo::getOrderNumber);</span><br><span class="line"></span><br><span class="line">        Optional&lt;String&gt; s3 = Optional.ofNullable(flightTicketInfo).</span><br><span class="line">			flatMap(OptionalTest::getOrderNumber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Optional&lt;String&gt; <span class="title">getOrderNumber</span><span class="params">(FlightTicketInfo flightTicketInfo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(flightTicketInfo).map(f -&gt; f.getOrderNumber());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>jkd1.8</tag>
        <tag>Optional</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk1.8_Base64</title>
    <url>/2020/06/07/jdk1-8-Base64/</url>
    <content><![CDATA[<h1 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h1><h2 id="static-class-Base64-Encoder"><a href="#static-class-Base64-Encoder" class="headerlink" title="static class Base64.Encoder"></a>static class Base64.Encoder</h2><blockquote>
<p>该类实现一个编码器，使用 Base64 编码来编码字节数据。</p>
</blockquote>
<h2 id="static-class-Base64-Decoder"><a href="#static-class-Base64-Decoder" class="headerlink" title="static class Base64.Decoder"></a>static class Base64.Decoder</h2><blockquote>
<p>该类实现一个解码器，使用 Base64 编码来解码字节数据。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 使用基本编码</span></span><br><span class="line">            String base64encodedString = Base64.getEncoder().encodeToString(<span class="string">"runoob?java8"</span>.getBytes(<span class="string">"utf-8"</span>));</span><br><span class="line">            System.out.println(<span class="string">"Base64 编码字符串 (基本) :"</span> + base64encodedString);</span><br><span class="line">			<span class="comment">//Base64 编码字符串 (基本) :cnVub29iP2phdmE4</span></span><br><span class="line">			</span><br><span class="line">            <span class="comment">// 解码</span></span><br><span class="line">            <span class="keyword">byte</span>[] base64decodedBytes = Base64.getDecoder().decode(base64encodedString);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"原始字符串: "</span> + <span class="keyword">new</span> String(base64decodedBytes, <span class="string">"utf-8"</span>));</span><br><span class="line">			<span class="comment">//原始字符串: runoob?java8</span></span><br><span class="line">			</span><br><span class="line">            base64encodedString = Base64.getUrlEncoder().encodeToString(<span class="string">"runoob?java8"</span>.getBytes(<span class="string">"utf-8"</span>));</span><br><span class="line">            System.out.println(<span class="string">"Base64 编码字符串 (URL) :"</span> + base64encodedString);</span><br><span class="line">			<span class="comment">//Base64 编码字符串 (URL) :cnVub29iP2phdmE4</span></span><br><span class="line"></span><br><span class="line">            StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">                stringBuilder.append(UUID.randomUUID().toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">byte</span>[] mimeBytes = stringBuilder.toString().getBytes(<span class="string">"utf-8"</span>);</span><br><span class="line">            String mimeEncodedString = Base64.getMimeEncoder().encodeToString(mimeBytes);</span><br><span class="line">            System.out.println(<span class="string">"Base64 编码字符串 (MIME) :"</span> + mimeEncodedString);</span><br><span class="line">			<span class="comment">//Base64 编码字符串 (MIME) :</span></span><br><span class="line">			<span class="comment">//ZTA4NjkwNzktYTcxZi00NWQwLWE0MmMtOTVlN2Y5NDZhNjNmNzRkMDIzZGEtZjI3Zi00NDhkLTlk</span></span><br><span class="line">			<span class="comment">//YzMtYzNlYmJkNjFjMzA2NDNhZjhhOWMtYTVlZC00YzIwLTgxMTItMjhkZTRiYjMxZjc2NzBjMzMy</span></span><br><span class="line">			<span class="comment">//MjctZTQyZC00MzYzLWE1ZDItMjM3MjM5ZTM0ZTQyYTYxMzFlMDUtOWJlZC00MGQ4LThjNTgtYWYy</span></span><br><span class="line">			<span class="comment">//ZWNmODgwNjBkYjEzOGM3OTYtOGRjYi00ODA4LWE5MmEtOWEyZDllOWI1ODVlNDBjNTMwYjctYjJj</span></span><br><span class="line">			<span class="comment">//NC00MDM4LWE5NjEtMzcwZjgyZDY0ZDU1MWY0OTNjMTEtYzc2NC00MmIxLTg4OTQtOTI5M2ZjMjA2</span></span><br><span class="line">			<span class="comment">//OWUyOTgzZDM4YmMtMjZkZC00OTg2LWJhYWUtNjdjMTkxMjkzMDllMTI4MGQwMjQtM2JmZi00MTA1</span></span><br><span class="line">			<span class="comment">//LTllZTItMTkxMjVkMTAzYWZk</span></span><br><span class="line">			</span><br><span class="line">        &#125;<span class="keyword">catch</span>(UnsupportedEncodingException e)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Error :"</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>jkd1.8</tag>
        <tag>Base64</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk1.8_时间类</title>
    <url>/2020/05/26/jdk1-8-%E6%97%B6%E9%97%B4%E7%B1%BB/</url>
    <content><![CDATA[<h1 id="java-time"><a href="#java-time" class="headerlink" title="java.time"></a>java.time</h1><h2 id="LocalDate-年月日"><a href="#LocalDate-年月日" class="headerlink" title="LocalDate(年月日)"></a>LocalDate(年月日)</h2><blockquote>
<p>本地日期和时间</p>
</blockquote>
<h3 id="1-最值"><a href="#1-最值" class="headerlink" title="1. 最值"></a>1. 最值</h3><blockquote>
<p>最大支持 +999999999-12-31 最小支持-999999999-01-01</p>
</blockquote>
<h3 id="2-比较方法"><a href="#2-比较方法" class="headerlink" title="2. 比较方法"></a>2. 比较方法</h3><p><img src="1.jpg" alt=""></p>
<blockquote>
<p>equals </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDate today = LocalDate.now();</span><br><span class="line">LocalDate tomorrow = today.plus(<span class="number">1</span>, ChronoUnit.DAYS);</span><br><span class="line">LocalDate yesterday = tomorrow.minusDays(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span>(today.equals(tomorrow.minusDays(<span class="number">1</span>))) &#123;</span><br><span class="line">    System.out.println(<span class="string">"true"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">"false"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-now-方法"><a href="#3-now-方法" class="headerlink" title="3. now()方法"></a>3. now()方法</h3><blockquote>
<p>获取当前时间，无参时为当前系统默认时区，参数为时区id </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Obtains the current date from the system clock in the specified time-zone.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This will query the &#123;<span class="doctag">@link</span> Clock#system(ZoneId) system clock&#125; to obtain the current date.</span></span><br><span class="line"><span class="comment"> * Specifying the time-zone avoids dependence on the default time-zone.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Using this method will prevent the ability to use an alternate clock for testing</span></span><br><span class="line"><span class="comment"> * because the clock is hard-coded.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> zone  the zone ID to use, not null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the current date using the system clock, not null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LocalDate <span class="title">now</span><span class="params">(ZoneId zone)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> now(Clock.system(zone));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Obtains the current date from the system clock in the default time-zone.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This will query the &#123;<span class="doctag">@link</span> Clock#systemDefaultZone() system clock&#125; in the default</span></span><br><span class="line"><span class="comment"> * time-zone to obtain the current date.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Using this method will prevent the ability to use an alternate clock for testing</span></span><br><span class="line"><span class="comment"> * because the clock is hard-coded.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the current date using the system clock and default time-zone, not null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LocalDate <span class="title">now</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> now(Clock.systemDefaultZone()); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-plus-方法"><a href="#4-plus-方法" class="headerlink" title="4. plus()方法"></a>4. plus()方法</h3><blockquote>
<p>public LocalDate plus(long amountToAdd, TemporalUnit unit)  amountToAdd 要增加的总数 ；unit 时间单位 详见 ChronoUnit(TemporalUnit的实现类)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDate today = LocalDate.now();</span><br><span class="line">LocalDate tomorrow = today.plus(<span class="number">1</span>, ChronoUnit.DAYS);</span><br><span class="line"></span><br><span class="line"><span class="comment">//plusYears(long yearsToAdd)\plusMonths(long monthsToAdd)\plusWeeks(long weeksToAdd)\plusDays(long daysToAdd)</span></span><br></pre></td></tr></table></figure>
<h3 id="5-minus-方法"><a href="#5-minus-方法" class="headerlink" title="5. minus()方法"></a>5. minus()方法</h3><blockquote>
<p>public LocalDate minus(long amountToSubtract, TemporalUnit unit)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDate today = LocalDate.now();</span><br><span class="line">LocalDate tomorrow = today.minus(<span class="number">1</span>, ChronoUnit.DAYS);</span><br><span class="line"></span><br><span class="line"><span class="comment">//minusYears(long yearsToSubtract)\minusMonths(long monthsToSubtract)\minusWeeks(long weeksToSubtract)\minusDays(long daysToSubtract)</span></span><br></pre></td></tr></table></figure>
<h3 id="6-of-方法、getDayOfWeek-方法"><a href="#6-of-方法、getDayOfWeek-方法" class="headerlink" title="6. of()方法、getDayOfWeek()方法"></a>6. of()方法、getDayOfWeek()方法</h3><blockquote>
<p>LocalDate of(int year, Month month, int dayOfMonth)/LocalDate of(int year, int month, int dayOfMonth)<br>LocalDate.getDayOfWeek() 判断传入日期是一周中的第几天  return DayOfWeek对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDate independenceDay = LocalDate.of(<span class="number">2014</span>, Month.JULY, <span class="number">4</span>);</span><br><span class="line">DayOfWeek dayOfWeek = independenceDay.getDayOfWeek();</span><br><span class="line">System.out.println(dayOfWeek);<span class="comment">//FRIDAY</span></span><br><span class="line">System.out.println(dayOfWeek.getValue());<span class="comment">//5</span></span><br></pre></td></tr></table></figure>
<h3 id="7-DateTimeFormatter"><a href="#7-DateTimeFormatter" class="headerlink" title="7. DateTimeFormatter"></a>7. DateTimeFormatter</h3><blockquote>
<p>格式化时间，线程安全，类内创建一次可复用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//实例化 不指定时区</span></span><br><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm"</span>);</span><br><span class="line"><span class="comment">//实例化 指定时区</span></span><br><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">"E, yyyy-MMMM-dd HH:mm"</span>, Locale.US);</span><br><span class="line"></span><br><span class="line">ZonedDateTime zdt = ZonedDateTime.now();</span><br><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd'T'HH:mm ZZZZ"</span>);</span><br><span class="line">System.out.println(formatter.format(zdt));<span class="comment">//2020-09-28T11:55 GMT+08:00</span></span><br><span class="line"></span><br><span class="line">DateTimeFormatter zhFormatter = DateTimeFormatter.ofPattern(<span class="string">"yyyy MMM dd EE HH:mm"</span>, Locale.CHINA);</span><br><span class="line">System.out.println(zhFormatter.format(zdt));<span class="comment">//2020 九月 28 星期一 11:55</span></span><br><span class="line"></span><br><span class="line">DateTimeFormatter usFormatter = DateTimeFormatter.ofPattern(<span class="string">"E, MMMM/dd/yyyy HH:mm"</span>, Locale.US);</span><br><span class="line">System.out.println(usFormatter.format(zdt));<span class="comment">//Mon, September/28/2020 11:55</span></span><br><span class="line"></span><br><span class="line">System.out.println(DateTimeFormatter.ISO_DATE_TIME.format(zdt));<span class="comment">//2020-09-28T11:55:39.209+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>保留字母定义</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">* All letters <span class="string">'A'</span> to <span class="string">'Z'</span> and <span class="string">'a'</span> to <span class="string">'z'</span> are reserved as pattern letters. The</span><br><span class="line">* following pattern letters are defined:</span><br><span class="line">* &lt;pre&gt;</span><br><span class="line">*  Symbol  Meaning                     Presentation      Examples</span><br><span class="line">*  ------  -------                     ------------      -------</span><br><span class="line">*   G       era                         text              AD; Anno Domini; A</span><br><span class="line">*   u       year                        year              <span class="number">2004</span>; <span class="number">04</span></span><br><span class="line">*   y       year-of-era                 year              <span class="number">2004</span>; <span class="number">04</span></span><br><span class="line">*   D       day-of-year                 number            <span class="number">189</span></span><br><span class="line">*   M/L     month-of-year               number/text       <span class="number">7</span>; <span class="number">07</span>; Jul; July; J</span><br><span class="line">*   d       day-of-month                number            <span class="number">10</span></span><br><span class="line">*</span><br><span class="line">*   Q/q     quarter-of-year             number/text       <span class="number">3</span>; <span class="number">03</span>; Q3; <span class="number">3</span>rd quarter</span><br><span class="line">*   Y       week-based-year             year              <span class="number">1996</span>; <span class="number">96</span></span><br><span class="line">*   w       week-of-week-based-year     number            <span class="number">27</span></span><br><span class="line">*   W       week-of-month               number            <span class="number">4</span></span><br><span class="line">*   E       day-of-week                 text              Tue; Tuesday; T</span><br><span class="line">*   e/c     localized day-of-week       number/text       <span class="number">2</span>; <span class="number">02</span>; Tue; Tuesday; T</span><br><span class="line">*   F       week-of-month               number            <span class="number">3</span></span><br><span class="line">*</span><br><span class="line">*   a       am-pm-of-day                text              PM</span><br><span class="line">*   h       clock-hour-of-am-pm (<span class="number">1</span>-<span class="number">12</span>)  number            <span class="number">12</span></span><br><span class="line">*   K       hour-of-am-pm (<span class="number">0</span>-<span class="number">11</span>)        number            <span class="number">0</span></span><br><span class="line">*   k       clock-hour-of-am-pm (<span class="number">1</span>-<span class="number">24</span>)  number            <span class="number">0</span></span><br><span class="line">*</span><br><span class="line">*   H       hour-of-day (<span class="number">0</span>-<span class="number">23</span>)          number            <span class="number">0</span></span><br><span class="line">*   m       minute-of-hour              number            <span class="number">30</span></span><br><span class="line">*   s       second-of-minute            number            <span class="number">55</span></span><br><span class="line">*   S       fraction-of-second          fraction          <span class="number">978</span></span><br><span class="line">*   A       milli-of-day                number            <span class="number">1234</span></span><br><span class="line">*   n       nano-of-second              number            <span class="number">987654321</span></span><br><span class="line">*   N       nano-of-day                 number            <span class="number">1234000000</span></span><br><span class="line">*</span><br><span class="line">*   V       time-zone ID                zone-id           America/Los_Angeles; Z; -<span class="number">08</span>:<span class="number">30</span></span><br><span class="line">*   z       time-zone name              zone-name         Pacific Standard Time; PST</span><br><span class="line">*   O       localized zone-offset       offset-O          GMT+<span class="number">8</span>; GMT+<span class="number">08</span>:<span class="number">00</span>; UTC-<span class="number">08</span>:<span class="number">00</span>;</span><br><span class="line">*   X       zone-offset <span class="string">'Z'</span> <span class="keyword">for</span> zero    offset-X          Z; -<span class="number">08</span>; -<span class="number">0830</span>; -<span class="number">08</span>:<span class="number">30</span>; -<span class="number">083015</span>; -<span class="number">08</span>:<span class="number">30</span>:<span class="number">15</span>;</span><br><span class="line">*   x       zone-offset                 offset-x          +<span class="number">0000</span>; -<span class="number">08</span>; -<span class="number">0830</span>; -<span class="number">08</span>:<span class="number">30</span>; -<span class="number">083015</span>; -<span class="number">08</span>:<span class="number">30</span>:<span class="number">15</span>;</span><br><span class="line">*   Z       zone-offset                 offset-Z          +<span class="number">0000</span>; -<span class="number">0800</span>; -<span class="number">08</span>:<span class="number">00</span>;</span><br><span class="line">*</span><br><span class="line">*   p       pad next                    pad modifier      <span class="number">1</span></span><br><span class="line">*</span><br><span class="line">*   <span class="string">'       escape for text             delimiter</span></span><br><span class="line"><span class="string">*   '</span><span class="string">'      single quote                literal           '</span></span><br><span class="line">*   [       optional section start</span><br><span class="line">*   ]       optional section end</span><br><span class="line">*   #       reserved for future use</span><br><span class="line">*   &#123;       reserved <span class="keyword">for</span> future use</span><br><span class="line">*   &#125;       reserved <span class="keyword">for</span> future use</span><br></pre></td></tr></table></figure>
<h2 id="LocalDateTime-年月日时分秒"><a href="#LocalDateTime-年月日时分秒" class="headerlink" title="LocalDateTime(年月日时分秒)"></a>LocalDateTime(年月日时分秒)</h2><blockquote>
<p>本地日期和时间</p>
</blockquote>
<h3 id="1-常用方法案例"><a href="#1-常用方法案例" class="headerlink" title="1. 常用方法案例"></a>1. 常用方法案例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDateTime ldt = LocalDateTime.of(<span class="number">2014</span>, Month.DECEMBER, <span class="number">31</span>, <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line"></span><br><span class="line">DayOfWeek dayOfWeek = ldt.getDayOfWeek();</span><br><span class="line">System.out.println(dayOfWeek);      <span class="comment">// WEDNESDAY</span></span><br><span class="line"></span><br><span class="line">Month month = ldt.getMonth();</span><br><span class="line">System.out.println(month);          <span class="comment">// DECEMBER</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> minuteOfDay = ldt.getLong(ChronoField.MINUTE_OF_DAY);</span><br><span class="line">System.out.println(minuteOfDay);    <span class="comment">// 23*60+59=1439</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> dayOfWeekLong = ldt.getLong(ChronoField.DAY_OF_WEEK);</span><br><span class="line">System.out.println(dayOfWeekLong);    <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">LocalDateTime parsed = LocalDateTime.parse(<span class="string">"2016-12-01 23:59:59"</span>, formatter);</span><br><span class="line">String string = parsed.format(formatter);</span><br><span class="line">System.out.println(string);     <span class="comment">// 2016-12-01 23:59:59</span></span><br></pre></td></tr></table></figure>
<h3 id="2-Instant时间戳"><a href="#2-Instant时间戳" class="headerlink" title="2. Instant时间戳"></a>2. Instant时间戳</h3><blockquote>
<p>在java.util.Date类与LocalDate、LocalDateTime类之间转换中 均可以通过Instant作为中间类完成转换</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDateTime ldt = LocalDateTime.of(<span class="number">2014</span>, Month.DECEMBER, <span class="number">31</span>, <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line"><span class="comment">//获取当前默认时区下ldt转换成的时间戳</span></span><br><span class="line">      Instant instant = ldt.atZone(ZoneId.systemDefault()).toInstant();</span><br><span class="line"></span><br><span class="line">      Date legacyDate = Date.from(instant);</span><br><span class="line">      System.out.println(legacyDate);     <span class="comment">// Wed Dec 31 23:59:59 CET 2014</span></span><br></pre></td></tr></table></figure>

<h2 id="LocalTime-时分秒"><a href="#LocalTime-时分秒" class="headerlink" title="LocalTime(时分秒)"></a>LocalTime(时分秒)</h2><blockquote>
<p>本地日期和时间</p>
</blockquote>
<h3 id="1-Clock"><a href="#1-Clock" class="headerlink" title="1. Clock"></a>1. Clock</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Clock clock = Clock.systemDefaultZone();</span><br><span class="line"><span class="comment">//返回1970-01-01T00:00Z (UTC)至今的毫秒数，即按毫秒单位的unix时间戳</span></span><br><span class="line"><span class="keyword">long</span> t0 = clock.millis();</span><br><span class="line">System.out.println(t0);</span><br><span class="line"></span><br><span class="line">Instant instant = clock.instant();</span><br><span class="line">Date legacyDate = Date.from(instant);</span><br><span class="line">System.out.println(legacyDate);</span><br></pre></td></tr></table></figure>
<h3 id="2-ZoneId-getRules-isBefore"><a href="#2-ZoneId-getRules-isBefore" class="headerlink" title="2. ZoneId.getRules(),isBefore()"></a>2. ZoneId.getRules(),isBefore()</h3><blockquote>
<p>getRules 当前默认时区与指定时区间的转换公式<br>isBefore 当前时间是否在指定时间之前<br>ChronoUnit.between 按指定时间单位计算俩时间的差</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ZoneId zone1 = ZoneId.of(<span class="string">"Europe/Berlin"</span>);</span><br><span class="line">ZoneId zone2 = ZoneId.of(<span class="string">"Brazil/East"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(zone1.getRules());<span class="comment">//ZoneRules[currentStandardOffset=+01:00]</span></span><br><span class="line">System.out.println(zone2.getRules());<span class="comment">//ZoneRules[currentStandardOffset=-03:00]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// time</span></span><br><span class="line">LocalTime now1 = LocalTime.now(zone1);<span class="comment">//10:17:39.043</span></span><br><span class="line">LocalTime now2 = LocalTime.now(zone2);<span class="comment">//05:17:39.050</span></span><br><span class="line"></span><br><span class="line">System.out.println(now1);</span><br><span class="line">System.out.println(now2);</span><br><span class="line"></span><br><span class="line">System.out.println(now1.isBefore(now2));  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> hoursBetween = ChronoUnit.HOURS.between(now1, now2);</span><br><span class="line"><span class="keyword">long</span> minutesBetween = ChronoUnit.MINUTES.between(now1, now2);</span><br><span class="line">System.out.println(hoursBetween);<span class="comment">//-4</span></span><br><span class="line">System.out.println(minutesBetween);<span class="comment">//-299</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// create time</span></span><br><span class="line"></span><br><span class="line">LocalTime now = LocalTime.now();</span><br><span class="line">System.out.println(now);<span class="comment">//16:17:39.052</span></span><br><span class="line"></span><br><span class="line">LocalTime late = LocalTime.of(<span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line">System.out.println(late);<span class="comment">//23:59:59</span></span><br><span class="line">DateTimeFormatter germanFormatter =</span><br><span class="line">                DateTimeFormatter</span><br><span class="line">                        .ofLocalizedTime(FormatStyle.SHORT)</span><br><span class="line">                        .withLocale(Locale.GERMAN);</span><br><span class="line"></span><br><span class="line">LocalTime formateTime = LocalTime.parse(<span class="string">"13:37"</span>, germanFormatter);</span><br><span class="line">System.out.println(formateTime);<span class="comment">//13:37</span></span><br></pre></td></tr></table></figure>
<h2 id="ZonedDateTime"><a href="#ZonedDateTime" class="headerlink" title="ZonedDateTime"></a>ZonedDateTime</h2><blockquote>
<p>带时区的日期和时间(ISO-8601)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ZonedDateTime  zonedDateTime = ZonedDateTime.now();</span><br><span class="line">System.out.println(zonedDateTime);<span class="comment">//2020-09-28T17:19:44.836+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>jkd1.8</tag>
        <tag>时间类</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk源码_Collection</title>
    <url>/2020/10/07/jdk%E6%BA%90%E7%A0%81-Collection/</url>
    <content><![CDATA[<h1 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h1><blockquote>
<p>集合结构中的根接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Iterable</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h2><blockquote>
<p>继承Iterable接口，故可调用默认方法forEach</p>
</blockquote>
<h1 id="AbstractCollection"><a href="#AbstractCollection" class="headerlink" title="AbstractCollection"></a>AbstractCollection</h1><blockquote>
<p>提供了 Collection 接口的基本实现</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCollection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="iterator"><a href="#iterator" class="headerlink" title="iterator()"></a>iterator()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns an iterator over the elements contained in this collection.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an iterator over the elements contained in this collection</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="AbstractList-iterator"><a href="#AbstractList-iterator" class="headerlink" title="AbstractList.iterator"></a>AbstractList.iterator</h3><blockquote>
<p>public abstract class AbstractList<E> extends AbstractCollection<E> implements List<E> </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Itr();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Itr"><a href="#Itr" class="headerlink" title="Itr"></a>Itr</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Index of element to be returned by subsequent call to next.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> cursor = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Index of element returned by most recent call to next or</span></span><br><span class="line"><span class="comment">         * previous.  Reset to -1 if this element is deleted by a call</span></span><br><span class="line"><span class="comment">         * to remove.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> lastRet = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * The modCount value that the iterator believes that the backing</span></span><br><span class="line"><span class="comment">         * List should have.  If this expectation is violated, the iterator</span></span><br><span class="line"><span class="comment">         * has detected concurrent modification.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> expectedModCount = modCount;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cursor != size();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> i = cursor;</span><br><span class="line">                E next = get(i);</span><br><span class="line">                lastRet = i;</span><br><span class="line">                cursor = i + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span> next;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">                checkForComodification();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="size"><a href="#size" class="headerlink" title="size()"></a>size()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>public abstract class AbstractList<E> extends AbstractCollection<E> implements List<E><br>public class ArrayList<E> extends AbstractList<E> implements List<E>, RandomAccess, Cloneable, java.io.Serializable</p>
</blockquote>
<h3 id="ArrayList-size"><a href="#ArrayList-size" class="headerlink" title="ArrayList.size()"></a>ArrayList.size()</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The size of the ArrayList (the number of elements it contains).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">	</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the number of elements in this list.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the number of elements in this list</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="boolean-isEmpty"><a href="#boolean-isEmpty" class="headerlink" title="boolean isEmpty()"></a>boolean isEmpty()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size() == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="boolean-contains-Object-o"><a href="#boolean-contains-Object-o" class="headerlink" title="boolean contains(Object o)"></a>boolean contains(Object o)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    Iterator&lt;E&gt; it = iterator();</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">            <span class="keyword">if</span> (it.next() == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">            <span class="keyword">if</span> (o.equals(it.next()))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>集合可以存入空对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Collection collection = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    collection.add(<span class="keyword">null</span>);</span><br><span class="line">    System.out.println(collection.size()==<span class="number">0</span>);<span class="comment">//false</span></span><br><span class="line">    System.out.println(collection.contains(<span class="keyword">null</span>));<span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="toArray"><a href="#toArray" class="headerlink" title="toArray()"></a>toArray()</h2><h3 id="Object-toArray"><a href="#Object-toArray" class="headerlink" title="Object[] toArray()"></a>Object[] toArray()</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">    <span class="comment">// Estimate size of array; be prepared to see more or fewer elements</span></span><br><span class="line">    Object[] r = <span class="keyword">new</span> Object[size()];</span><br><span class="line">    Iterator&lt;E&gt; it = iterator();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!it.hasNext()) <span class="comment">// fewer elements than expected</span></span><br><span class="line">            <span class="keyword">return</span> Arrays.copyOf(r, i);</span><br><span class="line">        r[i] = it.next();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> it.hasNext() ? finishToArray(r, it) : r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先根据Size()方法预建立一个与集合长度相等的数组，然后进行判断，若迭代过程中发现对象没有预期的多，则直接截取当前的数组返回</p>
</blockquote>
<h3 id="T-toArray-T-a"><a href="#T-toArray-T-a" class="headerlink" title=" T[] toArray(T[] a)"></a><T> T[] toArray(T[] a)</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">    <span class="comment">// Estimate size of array; be prepared to see more or fewer elements</span></span><br><span class="line">    <span class="keyword">int</span> size = size();</span><br><span class="line">    T[] r = a.length &gt;= size ? a :</span><br><span class="line">            (T[]) java.lang.reflect.Array</span><br><span class="line">                    .newInstance(a.getClass().getComponentType(), size);</span><br><span class="line">    Iterator&lt;E&gt; it = iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!it.hasNext()) &#123; <span class="comment">// fewer elements than expected</span></span><br><span class="line">            <span class="keyword">if</span> (a == r) &#123;</span><br><span class="line">                r[i] = <span class="keyword">null</span>; <span class="comment">// null-terminate</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a.length &lt; i) &#123;</span><br><span class="line">                <span class="keyword">return</span> Arrays.copyOf(r, i);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.arraycopy(r, <span class="number">0</span>, a, <span class="number">0</span>, i);</span><br><span class="line">                <span class="keyword">if</span> (a.length &gt; i) &#123;</span><br><span class="line">                    a[i] = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">        r[i] = (T) it.next();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// more elements than expected</span></span><br><span class="line">    <span class="keyword">return</span> it.hasNext() ? finishToArray(r, it) : r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>若参数数组a的长度大于集合的长度，则直接用a数组赋值，若小于则利用反射建立一个长度等于集合长度的数组</p>
</blockquote>
<h2 id="boolean-remove-Object-o"><a href="#boolean-remove-Object-o" class="headerlink" title="boolean remove(Object o)"></a>boolean remove(Object o)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    Iterator&lt;E&gt; it = iterator();</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (it.next() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                it.remove();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o.equals(it.next())) &#123;</span><br><span class="line">                it.remove();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Object-equals"><a href="#Object-equals" class="headerlink" title="Object.equals"></a>Object.equals</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span> == obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="boolean-containsAll-Collection-lt-gt-c"><a href="#boolean-containsAll-Collection-lt-gt-c" class="headerlink" title="boolean containsAll(Collection&lt;?&gt; c)"></a>boolean containsAll(Collection&lt;?&gt; c)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Object e : c)</span><br><span class="line">        <span class="keyword">if</span> (!contains(e))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="boolean-addAll-Collection-lt-extends-E-gt-c"><a href="#boolean-addAll-Collection-lt-extends-E-gt-c" class="headerlink" title="boolean addAll(Collection&lt;? extends E&gt; c)"></a>boolean addAll(Collection&lt;? extends E&gt; c)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> modified = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (E e : c)</span><br><span class="line">        <span class="keyword">if</span> (add(e))</span><br><span class="line">            modified = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> modified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="boolean-removeAll-Collection-lt-gt-c"><a href="#boolean-removeAll-Collection-lt-gt-c" class="headerlink" title="boolean removeAll(Collection&lt;?&gt; c)"></a>boolean removeAll(Collection&lt;?&gt; c)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(c);</span><br><span class="line">    <span class="keyword">boolean</span> modified = <span class="keyword">false</span>;</span><br><span class="line">    Iterator&lt;?&gt; it = iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (c.contains(it.next())) &#123;</span><br><span class="line">            it.remove();</span><br><span class="line">            modified = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Objects-requireNonNull-c"><a href="#Objects-requireNonNull-c" class="headerlink" title="Objects.requireNonNull(c)"></a>Objects.requireNonNull(c)</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">requireNonNull</span><span class="params">(T obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="default-boolean-removeIf-Predicate-lt-super-E-gt-filter"><a href="#default-boolean-removeIf-Predicate-lt-super-E-gt-filter" class="headerlink" title="default boolean removeIf(Predicate&lt;? super E&gt; filter)"></a>default boolean removeIf(Predicate&lt;? super E&gt; filter)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">removeIf</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> E&gt; filter)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(filter);</span><br><span class="line">    <span class="keyword">boolean</span> removed = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">final</span> Iterator&lt;E&gt; each = iterator();</span><br><span class="line">    <span class="keyword">while</span> (each.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (filter.test(each.next())) &#123;</span><br><span class="line">            each.remove();</span><br><span class="line">            removed = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> removed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>传入一个断言型功能函数，判断，若符合断言要求，remove</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Collection&lt;String&gt; collection = <span class="keyword">new</span> ArrayList&lt;String&gt;(Arrays.asList(<span class="string">"first"</span>,<span class="string">"second"</span>,<span class="string">"third"</span>,<span class="string">"--------"</span>));</span><br><span class="line">collection.removeIf(s-&gt;s.equals(<span class="string">"first"</span>));</span><br></pre></td></tr></table></figure>
<h2 id="boolean-retainAll-Collection-lt-gt-c"><a href="#boolean-retainAll-Collection-lt-gt-c" class="headerlink" title="boolean retainAll(Collection&lt;?&gt; c)"></a>boolean retainAll(Collection&lt;?&gt; c)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(c);</span><br><span class="line">    <span class="keyword">boolean</span> modified = <span class="keyword">false</span>;</span><br><span class="line">    Iterator&lt;E&gt; it = iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!c.contains(it.next())) &#123;</span><br><span class="line">            it.remove();</span><br><span class="line">            modified = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>取交集 遍历集合，若元素存在于参数集合C，则移除，并将modified置为true返回</p>
</blockquote>
<h2 id="boolean-equals-Object-o"><a href="#boolean-equals-Object-o" class="headerlink" title="boolean equals(Object o)"></a>boolean equals(Object o)</h2><blockquote>
<p>AbstractList</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> List))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    ListIterator&lt;E&gt; e1 = listIterator();</span><br><span class="line">    ListIterator&lt;?&gt; e2 = ((List&lt;?&gt;) o).listIterator();</span><br><span class="line">    <span class="keyword">while</span> (e1.hasNext() &amp;&amp; e2.hasNext()) &#123;</span><br><span class="line">        E o1 = e1.next();</span><br><span class="line">        Object o2 = e2.next();</span><br><span class="line">        <span class="keyword">if</span> (!(o1 == <span class="keyword">null</span> ? o2 == <span class="keyword">null</span> : o1.equals(o2)))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> !(e1.hasNext() || e2.hasNext());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先比较参数是否和当前List指向同一对象，再比较参数是否为List实例，然后将两个List中的元素一一对比（若List对象元素不为null，则用Object.equals方法对比，若为null则判断参数List对象中元素是否为null），最后判断长度是否相等</p>
</blockquote>
<h3 id="hasNext"><a href="#hasNext" class="headerlink" title="hasNext()"></a>hasNext()</h3><blockquote>
<p>ArrayList</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> cursor != size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="next"><a href="#next" class="headerlink" title="next()"></a>next()</h3><blockquote>
<p>ArrayList</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">int</span> i = cursor;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    Object[] elementData = ArrayList.<span class="keyword">this</span>.elementData;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    cursor = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h3><blockquote>
<p>instanceof是Java中的二元运算符，左边是对象，右边是类；当对象是右边类或子类所创建对象时，返回true；否则，返回false。</p>
</blockquote>
<ul>
<li>类的实例包含本身的实例，以及所有直接或间接子类的实例</li>
<li>instanceof左边显式声明的类型与右边操作元必须是同种类或存在继承关系，也就是说需要位于同一个继承树，否则会编译错误</li>
<li>左边的对象实例不能是基础数据类型</li>
<li>null用instanceof跟任何类型比较时都是false </li>
</ul>
<h2 id="int-hashCode"><a href="#int-hashCode" class="headerlink" title="int hashCode()"></a>int hashCode()</h2><blockquote>
<p>重写Object.equals方法时必须同样重写Object.hashCode方法 </p>
</blockquote>
<ul>
<li>如果两个对象equals相等，那么这两个对象的HashCode一定也相同</li>
<li>如果两个对象的HashCode相同，不代表两个对象就相同，只能说明这两个对象在散列存储结构中，存放于同一个位置</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the hash code value for this collection.  While the</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;Collection&lt;/tt&gt; interface adds no stipulations to the general</span></span><br><span class="line"><span class="comment"> * contract for the &lt;tt&gt;Object.hashCode&lt;/tt&gt; method, programmers should</span></span><br><span class="line"><span class="comment"> * take note that any class that overrides the &lt;tt&gt;Object.equals&lt;/tt&gt;</span></span><br><span class="line"><span class="comment"> * method must also override the &lt;tt&gt;Object.hashCode&lt;/tt&gt; method in order</span></span><br><span class="line"><span class="comment"> * to satisfy the general contract for the &lt;tt&gt;Object.hashCode&lt;/tt&gt; method.</span></span><br><span class="line"><span class="comment"> * In particular, &lt;tt&gt;c1.equals(c2)&lt;/tt&gt; implies that</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;c1.hashCode()==c2.hashCode()&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the hash code value for this collection</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Object#hashCode()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Object#equals(Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="default-Stream-stream"><a href="#default-Stream-stream" class="headerlink" title="default Stream stream()"></a>default Stream<E> stream()</h2><blockquote>
<p>返回一个不影响数据源的数据序列</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a sequential &#123;<span class="doctag">@code</span> Stream&#125; with this collection as its source.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This method should be overridden when the &#123;<span class="doctag">@link</span> #spliterator()&#125;</span></span><br><span class="line"><span class="comment"> * method cannot return a spliterator that is &#123;<span class="doctag">@code</span> IMMUTABLE&#125;,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> CONCURRENT&#125;, or &lt;em&gt;late-binding&lt;/em&gt;. (See &#123;<span class="doctag">@link</span> #spliterator()&#125;</span></span><br><span class="line"><span class="comment"> * for details.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a sequential &#123;<span class="doctag">@code</span> Stream&#125; over the elements in this collection</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@implSpec</span> The default implementation creates a sequential &#123;<span class="doctag">@code</span> Stream&#125; from the</span></span><br><span class="line"><span class="comment"> * collection's &#123;<span class="doctag">@code</span> Spliterator&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title">stream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> StreamSupport.stream(spliterator(), <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>源码</tag>
        <tag>集合</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk1.8_默认方法</title>
    <url>/2020/07/14/jdk1-8-%E9%BB%98%E8%AE%A4%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h1 id="默认方法"><a href="#默认方法" class="headerlink" title="默认方法"></a>默认方法</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">replaceAll</span><span class="params">(UnaryOperator&lt;E&gt; operator)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(operator);</span><br><span class="line">        <span class="keyword">final</span> ListIterator&lt;E&gt; li = <span class="keyword">this</span>.listIterator();</span><br><span class="line">        <span class="keyword">while</span> (li.hasNext()) &#123;</span><br><span class="line">            li.set(operator.apply(li.next()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; c)</span> </span>&#123;</span><br><span class="line">        Object[] a = <span class="keyword">this</span>.toArray();</span><br><span class="line">        Arrays.sort(a, (Comparator) c);</span><br><span class="line">        ListIterator&lt;E&gt; i = <span class="keyword">this</span>.listIterator();</span><br><span class="line">        <span class="keyword">for</span> (Object e : a) &#123;</span><br><span class="line">            i.next();</span><br><span class="line">            i.set((E) e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>接口类中支持申明带有实现的方法，可以由接口实现类的实例调用</p>
</blockquote>
<h1 id="和抽象类的区别"><a href="#和抽象类的区别" class="headerlink" title="和抽象类的区别"></a>和抽象类的区别</h1><ul>
<li>一个类只能继承一个抽象类；但是一个类可以实现多个接口。</li>
<li>抽象类有实例变量，而接口只能有类变量</li>
</ul>
<h1 id="多继承多实现中的优先级"><a href="#多继承多实现中的优先级" class="headerlink" title="多继承多实现中的优先级"></a>多继承多实现中的优先级</h1><blockquote>
<p>由于一个类可以实现多个接口，所以当一个类继承了多个签名相同的方法，类在选择方法时的优先级规则：</p>
</blockquote>
<ul>
<li>类中的方法优先级最高，类或父类中声明的方法的优先级高于任何声明为默认方法的优先级。</li>
<li>如果第一条无法判断，那么子接口的优先级更高：方法签名相同时，优先选择拥有最具体实现的默认方法的接口， 即如果B继承了A，那么B就比A更加具体。</li>
<li>最后，如果还是无法判断，继承了多个接口的类必须通过显式覆盖和调用期望的方法， 显式地选择使用哪一个默认方法的实现。</li>
</ul>
<h2 id="场景1："><a href="#场景1：" class="headerlink" title="场景1："></a>场景1：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello from A"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello from B"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">implements</span> <span class="title">A</span>, <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> C().hello();<span class="comment">//hello from B</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="1.png" alt=""></p>
<blockquote>
<p>类中无方法，B继承了A，故认为B中的hello()更具体，输出“hello from B”</p>
</blockquote>
<h2 id="场景2："><a href="#场景2：" class="headerlink" title="场景2："></a>场景2：</h2><blockquote>
<p>若C继承了A的实现类D</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">D</span> <span class="keyword">implements</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">D</span> <span class="keyword">implements</span> <span class="title">A</span>, <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> C().hello();<span class="comment">//hello from B</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="2.png" alt=""></p>
<blockquote>
<p>C继承了D，但D没有对A的默认方法进行重写，故比较AB，还是输出“hello from B”</p>
</blockquote>
<h2 id="场景3："><a href="#场景3：" class="headerlink" title="场景3："></a>场景3：</h2><blockquote>
<p>若D中覆盖了A的默认方法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">D</span> <span class="keyword">implements</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello from D"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>父类中方法具有更高优先级，打印“hello from D”</p>
</blockquote>
<h2 id="场景4："><a href="#场景4：" class="headerlink" title="场景4："></a>场景4：</h2><blockquote>
<p>若B不再继承A</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello from A"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello from B"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">implements</span> <span class="title">A</span>, <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> C().hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="3.png" alt=""></p>
<blockquote>
<p>由于编译器无法识别A还是B的实现更加具体，所以会抛出编译错误：“C inherits unrelated defaults for hello() from types A and B”。<br>解决冲突，可以在C中覆盖hello()方法并在方法内显示的选择调用A还是B的方法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">D</span> <span class="keyword">implements</span> <span class="title">A</span>, <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 显式地选择调用接口B中的方法</span></span><br><span class="line">        <span class="comment">// 同理，要调用接口A中的方法，可以这样：A.super.hello()</span></span><br><span class="line">        B.<span class="keyword">super</span>.hello();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> C().hello();<span class="comment">//hello from B</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>jkd1.8</tag>
        <tag>默认方法</tag>
      </tags>
  </entry>
  <entry>
    <title>portal发货单查询表</title>
    <url>/2020/11/26/portal%E5%8F%91%E8%B4%A7%E5%8D%95%E6%9F%A5%E8%AF%A2%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h2><ol>
<li>new_ord_shipment 发货通知单 new_contract_id 合同单号  new_userprofile_id 整机编号</li>
<li>new_contractdetail 合同产品明细 new_contract_id 合同 </li>
<li>new_srv_userprofile 产品档案 new_srv_userprofileid</li>
<li>new_contract 合同申请单 new_contractid</li>
<li>合同申请单为基础关联</li>
</ol>
<h2 id="字段说明"><a href="#字段说明" class="headerlink" title="字段说明"></a>字段说明</h2><ol>
<li>单号–发货通知单号 new_name</li>
<li>物料名称–合同产品明细 物料名称  new_product_id  自定义 new_product_id1</li>
<li>产品特殊要求–合同产品明细 产品特殊要求 new_specialrequirement</li>
<li>物料编码–合同产品明细 物料编码 new_code</li>
<li>合同单号–关联合同的 合同单号CRT（单号）new_name  自定义 new_crt_name</li>
<li>合同类型–关联合同（合同申请单） 合同类型 new_contracttype_id</li>
<li>纸质合同编号–关联合同 纸质合同号（合同申请单） new_pono</li>
<li>整机编号–发货通知单 整机编号 new_userprofile_id</li>
<li>付款条件–发货通知单 付款条件 new_ord_payment_id</li>
<li>产品名称–整机编号（产品档案） 产品名称 new_product_id  自定义 new_product_id2</li>
<li>底盘发动机号–整机编号（产品档案） 底盘发动机号（底盘发动机编码） new_enginecode</li>
<li>首付金额–关联合同（合同申请单） 首付金额 new_downpayments （万元）</li>
<li>首付金额（经销商与重型）–关联合同（合同申请单） 首付金额（经销商与重型）new_sparepartsmoney （万元）</li>
<li>首付比例–关联合同（合同申请单） 首付比例 new_downpaymentsrat（%）</li>
<li>国际贸易条款1–关联合同（合同申请单） 国际贸易条款1 new_ord_trade_id</li>
<li>交货地点–合同产品明细 交货地点 new_sendaddress</li>
<li>经销/直销–发货通知单 经销/直销 new_selltype</li>
<li>是否二手车–发货通知单 是否二手车 new_isold</li>
<li>售达方–关联合同（合同申请单） 售达方 new_customer_id</li>
<li>售达方管理员账号–关联合同（合同申请单） 售达方管理员账号 new_customeradmin_fddid</li>
<li>最终用户–关联合同（合同申请单） 最终用户 new_enduser_id</li>
<li>最终用户管理员账号–关联合同（合同申请单） 最终用户管理员账号（最终客户管理员账号） new_enduseradmin_fddid</li>
<li>详细地址–关联合同（合同申请单） 详细地址 new_address</li>
<li>徐工签约人–关联合同（合同申请单） 徐工签约人 new_ord_sales_id</li>
<li>定价–合同产品明细 定价 new_price</li>
<li>实际单台金额–发货通知单 实际单台金额 new_contractmoney</li>
<li>开单时间–发货通知单 开单时间 createdon</li>
<li>销售代表处–发货通知单 销售代表处 new_office_id</li>
<li>sap合同凭证号–发货通知单 sap合同凭证号 new_sapcontractno</li>
<li>客户SAP编码–发货通知单 最终客户sap编码 new_finalaccountcode</li>
<li>最终客户后面增加，售达方管理员姓名，取值合同申请；  new_customeradmin_fddname 售达方管理员姓名</li>
<li>最后一列增加是否代理制，取值合同申请；  new_isagent 是否代理制</li>
</ol>
<h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	sm.new_name,</span><br><span class="line">	ctd.new_product_idName new_product_id1,</span><br><span class="line">	ctd.new_specialrequirement,</span><br><span class="line">	ctd.new_code,</span><br><span class="line">	ct.new_name new_crt_name,</span><br><span class="line">	ct.new_contracttype_idName new_contracttype_id,</span><br><span class="line">	ct.new_pono,</span><br><span class="line">	sm.new_userprofile_idName new_userprofile_id,</span><br><span class="line">	sm.new_ord_payment_idName new_ord_payment_id,</span><br><span class="line">	up.new_product_idName new_product_id2,</span><br><span class="line">	up.new_enginecode,</span><br><span class="line">	<span class="keyword">CAST</span> ( <span class="keyword">CONVERT</span> ( <span class="built_in">DECIMAL</span> ( <span class="number">18</span>, <span class="number">2</span> ), ct.new_downpayments ) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span> ( <span class="number">256</span> ) ) + <span class="string">'万元'</span> new_downpayments,</span><br><span class="line">	<span class="keyword">CAST</span> ( <span class="keyword">CONVERT</span> ( <span class="built_in">DECIMAL</span> ( <span class="number">18</span>, <span class="number">2</span> ), ct.new_sparepartsmoney ) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span> ( <span class="number">256</span> ) ) + <span class="string">'万元'</span> new_sparepartsmoney,</span><br><span class="line">	<span class="keyword">CAST</span> ( <span class="keyword">CONVERT</span> ( <span class="built_in">DECIMAL</span> ( <span class="number">18</span>, <span class="number">2</span> ), ct.new_downpaymentsrat ) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span> ( <span class="number">256</span> ) ) + <span class="string">'%'</span> new_downpaymentsrat,</span><br><span class="line">	ct.new_ord_trade_idName new_ord_trade_id,</span><br><span class="line">	ctd.new_sendaddress,</span><br><span class="line">	st.value <span class="keyword">AS</span> new_selltype,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">		sm.new_isold </span><br><span class="line">		<span class="keyword">WHEN</span> <span class="string">'0'</span> <span class="keyword">THEN</span></span><br><span class="line">		<span class="string">'否'</span> <span class="keyword">ELSE</span> <span class="string">'是'</span> </span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">AS</span> new_isold,</span><br><span class="line">	ct.new_customer_idName new_customer_id,</span><br><span class="line">	ct.new_customeradmin_fddid,</span><br><span class="line">	ct.new_enduser_idName new_enduser_id,</span><br><span class="line">	ct.new_enduseradmin_fddid,</span><br><span class="line">	ct.new_address,</span><br><span class="line">	ct.new_ord_sales_idName new_ord_sales_id,</span><br><span class="line">	<span class="keyword">CAST</span> ( <span class="keyword">CONVERT</span> ( <span class="built_in">DECIMAL</span> ( <span class="number">18</span>, <span class="number">2</span> ), ctd.new_price ) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span> ( <span class="number">256</span> ) ) + <span class="string">'元'</span> new_price,</span><br><span class="line">	<span class="keyword">CAST</span> ( <span class="keyword">CONVERT</span> ( <span class="built_in">DECIMAL</span> ( <span class="number">18</span>, <span class="number">2</span> ), sm.new_contractmoney ) <span class="keyword">AS</span> <span class="built_in">VARCHAR</span> ( <span class="number">256</span> ) ) + <span class="string">'元'</span> new_contractmoney,</span><br><span class="line">	sm.createdon,</span><br><span class="line">	sm.new_office_idName new_office_id,</span><br><span class="line">	sm.new_sapcontractno,</span><br><span class="line">	sm.new_finalaccountcode </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	new_contract ct</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> new_ord_shipment sm <span class="keyword">ON</span> sm.new_contract_id = ct.new_contractid </span><br><span class="line">	<span class="keyword">AND</span> sm.statecode = <span class="number">0</span></span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> new_contractdetail ctd <span class="keyword">ON</span> ctd.new_contract_id = ct.new_contractid </span><br><span class="line">	<span class="keyword">AND</span> ctd.statecode = <span class="number">0</span></span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> new_srv_userprofile up <span class="keyword">ON</span> sm.new_userprofile_id = up.new_srv_userprofileid </span><br><span class="line">	<span class="keyword">AND</span> up.statecode = <span class="number">0</span></span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> stringmap st <span class="keyword">ON</span> st.objecttypecode = <span class="number">10205</span> </span><br><span class="line">	<span class="keyword">AND</span> st.attributename = <span class="string">'new_selltype'</span> </span><br><span class="line">	<span class="keyword">AND</span> st.AttributeValue = sm.new_selltype </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	ct.statecode = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="角色过滤"><a href="#角色过滤" class="headerlink" title="角色过滤"></a>角色过滤</h2><blockquote>
<p>基于合同申请单进行权限控制<br>直销销售员 portal制单人 new_portalowner_id  徐工签约人 new_ord_sales_id<br>代表处 代表处 new_office_id<br>经销商 经销商 new_discustomer<br>经销销售员 portal制单人 new_portalowner_id<br>Portal 上经销商、代表处、经销销售员、直销销售员绑定部门实体类型均为account</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//互联用户类型</span></span><br><span class="line"><span class="keyword">var</span> userType = UserIdentity.GetUserType();</span><br><span class="line"><span class="comment">//互联用户id</span></span><br><span class="line"><span class="keyword">var</span> userid = UserIdentity.GetCrmUserId();</span><br><span class="line"><span class="comment">//绑定部门id</span></span><br><span class="line"><span class="keyword">var</span> departid = UserIdentity.GetCrmDepartId();</span><br><span class="line"><span class="comment">//代表处</span></span><br><span class="line"><span class="keyword">if</span> (userType.Equals(<span class="string">"7"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//代表处等于绑定部门id(accountid)上的代表处</span></span><br><span class="line">    <span class="keyword">string</span> param = <span class="string">" AND ct.new_office_id = (select new_office_id FROM Account where AccountId = @dbc) "</span>;</span><br><span class="line">    sql += param;</span><br><span class="line">    paramList.Add(<span class="string">"dbc"</span>, departid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//经销商</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (userType.Equals(<span class="string">"3"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//经销商等于绑定部门id(accountid)</span></span><br><span class="line">    <span class="keyword">string</span> param = <span class="string">" AND ct.new_discustomer = @jxs "</span>;</span><br><span class="line">    sql += param;</span><br><span class="line">    paramList.Add(<span class="string">"jxs"</span>, departid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//经销销售员</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (userType.Equals(<span class="string">"6"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//portal制单人等于互联用户上的绑定用户id</span></span><br><span class="line">    <span class="keyword">string</span> param = <span class="string">" AND ct.new_portalowner_id = (select new_binduser_id FROM new_outeruser WHERE new_outeruserid = @jxxsy )"</span>;</span><br><span class="line">    sql += param;</span><br><span class="line">    paramList.Add(<span class="string">"jxxsy"</span>, userid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//直销销售员</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (userType.Equals(<span class="string">"5"</span>)) &#123;</span><br><span class="line">    <span class="comment">//portal制单人、徐工签约人等于互联用户上的绑定用户id</span></span><br><span class="line">    <span class="keyword">string</span> param = <span class="string">" AND ct.new_portalowner_id = (select new_binduser_id FROM new_outeruser WHERE new_outeruserid = @zxxsy ) "</span> +</span><br><span class="line">        <span class="string">"or ct.new_ord_sales_id = (select new_binduser_id FROM new_outeruser WHERE new_outeruserid = @zxxsy ) "</span>;</span><br><span class="line">    sql += param;</span><br><span class="line">    paramList.Add(<span class="string">"zxxsy"</span>, userid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="1.jpg" alt=""></p>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>Portal</tag>
        <tag>销售</tag>
      </tags>
  </entry>
  <entry>
    <title>otto机器人</title>
    <url>/2020/12/09/otto%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
    <content><![CDATA[<h2 id="功能设计"><a href="#功能设计" class="headerlink" title="功能设计"></a>功能设计</h2><ol>
<li>otto跳舞机器人</li>
<li>闹钟</li>
<li>声音播放</li>
</ol>
<h2 id="元器件"><a href="#元器件" class="headerlink" title="元器件"></a>元器件</h2><ol>
<li>Arduino UNO</li>
<li>esp8266</li>
</ol>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">技术群号、模块示例、学习资料，网盘等请访问我们资料官网：www.ultirobot.com</span><br><span class="line">    1、示例教程：网站首页 产品资料库（wiki.ultirobot.com）推荐电脑端打开布局比较清楚，示例教程上涉及到的库文件、软件、资料等都会在该教程页面的最下方有下载。</span><br><span class="line">    2、网盘：网盘里没有教程和示例，是一些第三方视频和电子书。两个网盘内容一样，百度网盘适合转存，但经常会有下载限速。天翼网盘下载不限速。</span><br><span class="line">        百度网盘（密码：s1dj ）：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1fYvqGLNf7Kxpr62bPvh9rg#list&#x2F;path&#x3D;%2F</span><br><span class="line">        天翼网盘（密码：soi2）：https:&#x2F;&#x2F;cloud.189.cn&#x2F;t&#x2F;E7fAnmMzymuy</span><br><span class="line">    3、我们微信公众号不定期会发布新教程、经验案例、优惠信息，欢迎关注。公众号名字：ultirobot</span><br><span class="line">    4、免费技术支持</span><br><span class="line">        产品使用可以参考我们网站上教程，教程做不通可以加我们技术群联系我们技术（群主）协助排查，我们技术周一到周六，9:00-17:30会在线协助解答，节假日休息。非本店售出产品一律不做支持，多谢理解。</span><br><span class="line">        技术交流QQ群群号：628663381，进群需要验证淘宝订单号。技术QQ：1342114269</span><br><span class="line">        （技术支持仅针本网站教程示例，不参与程序更改和个人项目制作。）</span><br><span class="line">    5、如果购买套件的客户，请参照套件内说明进行学习。</span><br><span class="line">    题外话：非技术支持时间，如果碰到问题，一、不要怀疑产品。二、不要怀疑教程。三、耐心细致一句一句看教程。坚持以上三点，90%的问题都可以自己排错。有问题可以随时给我们技术留言。</span><br><span class="line">    客户服务电话（非技术）：19951586806       批量购买、购物体验投诉均可拨打此电话。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">OTTO机器人说明书（Basic&amp;Plus）</span><br><span class="line"></span><br><span class="line">注意事项：</span><br><span class="line">    所有资料，跟本说明书若有冲突的，以本说明书为准。</span><br><span class="line">    如果你的编译器上传程序报错，检查以下方面：</span><br><span class="line">        NANO分新旧固件，旧的编译器只能使用旧固件，请安装最新的arduino编译器，具体可以参考：http:&#x2F;&#x2F;ultirobot.com&#x2F;2019&#x2F;05&#x2F;23&#x2F;arduino-nano-bootloader-update&#x2F;</span><br><span class="line">        如果报错 no such file，就是缺少库文件，检查你的OTTO库文件是否已经安装。</span><br><span class="line">        打开设备管理器，检查CH340端口是否和你勾选的端口一致。</span><br><span class="line">    腿部塑料件卡不进凹槽的，可以进行略微修剪。</span><br><span class="line">OTTO-安装流程：</span><br><span class="line">    OTTO-Basic基础版</span><br><span class="line">        1、安装软件（Arduino编译器和OTTO图形化编译器)</span><br><span class="line">        2、把OTTO库文件拖入arduino编译器对应库文件夹里</span><br><span class="line">        3、把图形化汉化文件拖入OTTO图形化编译器lang文件夹里。</span><br><span class="line">        4、根据视频教程组装OTTO机器人</span><br><span class="line">        5、用我们提供的测试程序对机器人进行测试，初步了解机器人功能。</span><br><span class="line">        6、根据视频教程，对OTTO进行图形化编程。</span><br><span class="line">    OTTO-Plus全功能版</span><br><span class="line">        7、用我们提供的测试程序，测试新增模块的功能、（触摸、声控、LED点阵）</span><br><span class="line">        8、用手机APP连接OTTO，尝试手机远程控制玩法。（蓝牙）</span><br><span class="line">主要模块和传感器：</span><br><span class="line">    OTTO-Basic基础版</span><br><span class="line">        四个舵机：控制腿部和脚部活动</span><br><span class="line">        蜂鸣器：使OTTO能够发出不同的声音</span><br><span class="line">        超声波模块：使得OTTO可以通过眼睛来提供不同的反馈。</span><br><span class="line">    OTTO-Plus全功能版</span><br><span class="line">        包含了Basic版的所有部件，可以实现basic版的所有功能。</span><br><span class="line">        增加蓝牙模块，可以下载手机APP来远程控制OTTO机器人。</span><br><span class="line">        增加声控开关模块，可以通过外部声响来控制OTTO执行命令。</span><br><span class="line">        增加触摸传感器，可以通过OTTO头部触摸来执行命令。</span><br><span class="line">        增加点阵模块，让OTTO增加嘴部不同的表情表达。</span><br><span class="line">接线方式：(扩展板上所有的G都是连通的，所有的V都是连通的，可以任意接。）</span><br><span class="line">    舵机：（橙色线接S）面朝自己时候接线如下</span><br><span class="line">        右上-------- 接2号那排，注意橙色接S。</span><br><span class="line">        左上-------- 接3号那排，注意橙色接S。</span><br><span class="line">        右下-------- 接4号那排，注意橙色接S。</span><br><span class="line">        左下-------- 接5号那排，注意橙色接S。</span><br><span class="line">    蜂鸣器（模块上可以看到一个+，对应下方的线就是正极，另一根就是负极。）</span><br><span class="line">        正极-------- 13号S端</span><br><span class="line">        负极---------接G</span><br><span class="line">    超声波模块</span><br><span class="line">        VCC-------- 接V</span><br><span class="line">        Trig-------- 接8号S端</span><br><span class="line">        Echo-------- 接9号S端</span><br><span class="line">        GND-------- 接G</span><br><span class="line">    声控开关模块（Plus版才有）</span><br><span class="line">        VCC---------V</span><br><span class="line">        GND---------G</span><br><span class="line">        OUT---------A6号S端</span><br><span class="line">    触摸模块（Plus版才有）</span><br><span class="line">        VCC（孔位10）---------V</span><br><span class="line">        I&#x2F;O（孔位9）---------A0号S端</span><br><span class="line">        GND（孔位8）---------G</span><br><span class="line">    点阵模块（Plus版才有）</span><br><span class="line">        VCC---------V</span><br><span class="line">        GND---------G</span><br><span class="line">        DIN---------A3号S端</span><br><span class="line">        CS---------A2号S端</span><br><span class="line">        CLK---------A1号S端</span><br><span class="line">    蓝牙模块（Plus版才有，未上传程序之前不要接。）</span><br><span class="line">        VCC---------V</span><br><span class="line">        GND---------G</span><br><span class="line">        TXD---------RX</span><br><span class="line">        RXD---------TX</span><br><span class="line">套件推荐使用方式：</span><br><span class="line">    1、DIY组装：通过大约1个小时，组装电子模块和3D打印件。</span><br><span class="line">    2、上传测试程序：我们会提供几个测试程序，比如跳舞程序，避障程序，用来测试功能。</span><br><span class="line">    3、图形化编程：我们提供OTTO专属blockly图形化编程软件，方便您进行自定义编程。</span><br><span class="line">    4、手机远程控制和编程（OTTO Plus版）。</span><br><span class="line">资料网盘介绍：</span><br><span class="line">    3Dprint：OTTO主体3D打印文件</span><br><span class="line">        3Daccessories：OTTO的配件3D模型文件</span><br><span class="line">        other bodies：（里面是一些非常规大小的主体模型文件）</span><br><span class="line">        body：身体</span><br><span class="line">        foot：脚</span><br><span class="line">        head：头部</span><br><span class="line">        leg：腿</span><br><span class="line">    CAD：CAD用的文件，正常3D打印版本用不到，激光切割版本才会用到。</span><br><span class="line">    Code：测试代码</span><br><span class="line">        Alarm：测试超声波模块和蜂鸣器的接线是否正常。</span><br><span class="line">        All moves：测试OTTO的所有动作和声音，显示各种关节活动的测试，后面是声音配合体态的测试。</span><br><span class="line">        Avoid：超声波模块测试，前面没障碍物一直往前走，有障碍物后进入新的循环。</span><br><span class="line">        Calibration：校准程序，用来微调舵机角度。</span><br><span class="line">        Calibrationeasy：校准程序，用来微调舵机角度。效果和上一个程序类似。</span><br><span class="line">        Calibrationserial：校准程序，用来微调舵机角度。串口方式，类似Calibration。</span><br><span class="line">        Distance：OTTO变身测距仪</span><br><span class="line">        Follow：跟随，把手放在OTTO眼前，OTTO会跟着你走。</span><br><span class="line">        Footalign：舵机测试程序</span><br><span class="line">        Happybirthday：让OTTO机器人给你唱生日快乐歌</span><br><span class="line">        Happydance：一段跳舞程序，配合音乐表现出OTTO的快乐。</span><br><span class="line">        Jingle： 金哥拜,金哥拜,金哥on the way</span><br><span class="line">        MarioBros：让OTTO演奏超级玛丽背景音</span><br><span class="line">        Mblock：使用Mblock软件时候需要预上传本程序</span><br><span class="line">        retrieve：狩猎，效果上参考follow</span><br><span class="line">        run：OTTO快速小跑</span><br><span class="line">        singleladies：碧昂斯的热门金曲《单身女郎》，由OTTO配舞。</span><br><span class="line">        smoothcriminal：OTTO拿手好戏，演绎迈克杰克逊太空步。</span><br><span class="line">        SW：一段经典背景音</span><br><span class="line">    Driver：OTTO主控板的驱动，在电脑连接OTTO之前，需要先安装这个驱动。</span><br><span class="line">    Instruction manual：说明书</span><br><span class="line">        Arduino编译器使用说明书</span><br><span class="line">        OTTO组装说明书</span><br><span class="line">        OTTO图形化编译器使用说明书</span><br><span class="line">    Papercraft：贴纸，使用A4纸打印，让你的OTTO个性化十足。</span><br><span class="line">    Software：相关软件下载</span><br><span class="line">        Mixly图形化编译器及OTTO插件</span><br><span class="line">        arduino编译器：arduino代码程序的时候，使用该软件编译上传，也就是网盘里code这个文件夹。</span><br><span class="line">            Libraries_V9：OTTO库文件，在使用Arduino编译器之前需要先导入压缩包文件。</span><br><span class="line">        OTTO官方图形化编译器：基于google的blockly开发，适合做OTTO的教育编程。</span><br><span class="line">    Video：相关的教学视频</span><br><span class="line">        OTTO机器人国外玩家演示视频（在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1p4411Z7Ns）</span><br><span class="line">        OTTO机器人v9组装视频（在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV15E411B7Uc&#x2F;）</span><br><span class="line">            注意：蜂鸣器模块视频中接了10号引脚，需要改接到13号引脚，才能在OTTO blockly正常使用。</span><br><span class="line">            视频中有张图片接线图是旧版的，所以新版套件中不再放置。接线方式以本文档为准。</span><br><span class="line">        OTTO机器人官方图形化软件使用指导（在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1K7411m7FC&#x2F;）</span><br><span class="line">        OTTO米思奇图形化编程软件使用指导 (在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Vb411k7Ep&#x2F;）</span><br><span class="line">        OTTO机器人电池盒指南（在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV16E411F7qR&#x2F;）</span><br><span class="line">        OTTO机器人V9资料介绍（在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1PE411P7Ni&#x2F;）</span><br><span class="line">        V8和V9外壳对比区别（在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1vJ411g7R3&#x2F;）</span><br><span class="line">        OTTO机器人Plus版本新增模块功能介绍和接线方式介绍（触摸、声控、LED点阵）（在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1hQ4y1M74z&#x2F;)</span><br><span class="line">        OTTO机器人Plus版本新增模块功能介绍和接线方式介绍（蓝牙控制）（在线播放：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1n54y1d74A&#x2F;)</span><br><span class="line">    Old：OTTO以前版本的老资料，提供参考，不做技术答疑。</span><br><span class="line">    otto-plus：Plus版本用户使用（Basic版用不到）</span><br><span class="line">        codes：所有的basic版程序，plus用户都可以使用，并且新增了本文件夹的程序。</span><br><span class="line">            OttoAPP_sound_V9：使用蓝牙控制时候预先上传的程序</span><br><span class="line">            OttoPlus_clapdance_V9: 通过声控，来切换OTTO的不同舞蹈。</span><br><span class="line">            OttoPLUS_clapwalk_V9：通过声控，来控制OTTO是否向前走。</span><br><span class="line">            OttoPLUS_Guardian_V9：守卫模块，可以通过顶部触摸模块切换不同模式，由超声波模块来检测是否otto前方有物体经过。</span><br><span class="line">            OttoPLUS_stopgo_V9：LED点阵模块的测试程序</span><br><span class="line">            OttoPLUS_touchultrasound_V9：通过头顶触摸模块，让OTTO随机触发不同动作。</span><br><span class="line">        OttoPLUS_touchultrasound_V9：Plus的说明书，以我们视频教程为主，说明书辅助。</span><br><span class="line">        Librares：基本跟basic版的库文件一样，多了点阵模块的库。也需要拖入arduino的库文件夹。</span><br><span class="line">产品购买、技术支持：</span><br><span class="line">    购买地址一：ultirobot.taobao.com</span><br><span class="line">    购买地址二：zhongbest.taobao.com</span><br><span class="line">    OTTO Club China 官方交流QQ群：812485512</span><br><span class="line">    微信公众号：ultirobot </span><br><span class="line">    技术支持QQ：1342114269</span><br><span class="line">    技术支持微信：ultirobot1024</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Arduino</tag>
        <tag>DIY</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk源码_List</title>
    <url>/2020/10/08/jdk%E6%BA%90%E7%A0%81-List/</url>
    <content><![CDATA[<h1 id="List"><a href="#List" class="headerlink" title="List"></a>List</h1><blockquote>
<p>继承了Collection，Collection继承了Iterable</p>
</blockquote>
<ul>
<li><strong>文档简述</strong>：</li>
<li>有序的集合，也被称为序列，此接口的使用者可以对插入List中的每个元素进行精准的控制，可以通过下标搜索或访问List中的每一个元素。</li>
<li>与set不同，List允许重复的元素。</li>
<li>索引从零开始。</li>
<li>ListIterator：更强大的迭代器，继承于Iterator接口,只能用于各种List类型的访问。</li>
<li>List接口提供了两个方法来搜索指定的对象，但在很多实现中，它们将执行高开销的线性搜索。</li>
<li>List接口提供了两种方法来有效地插入，并在该列表中的任意点移除多个元件。</li>
<li>虽然List允许把自身做为元素包含,但equals方法和hashCode方法在这样的List上将不具备很好的支持性</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An ordered collection (also known as a &lt;i&gt;sequence&lt;/i&gt;).  The user of this</span></span><br><span class="line"><span class="comment"> * interface has precise control over where in the list each element is</span></span><br><span class="line"><span class="comment"> * inserted.  The user can access elements by their integer index (position in</span></span><br><span class="line"><span class="comment"> * the list), and search for elements in the list.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Unlike sets, lists typically allow duplicate elements.  More formally,</span></span><br><span class="line"><span class="comment"> * lists typically allow pairs of elements &lt;tt&gt;e1&lt;/tt&gt; and &lt;tt&gt;e2&lt;/tt&gt;</span></span><br><span class="line"><span class="comment"> * such that &lt;tt&gt;e1.equals(e2)&lt;/tt&gt;, and they typically allow multiple</span></span><br><span class="line"><span class="comment"> * null elements if they allow null elements at all.  It is not inconceivable</span></span><br><span class="line"><span class="comment"> * that someone might wish to implement a list that prohibits duplicates, by</span></span><br><span class="line"><span class="comment"> * throwing runtime exceptions when the user attempts to insert them, but we</span></span><br><span class="line"><span class="comment"> * expect this usage to be rare.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The &lt;tt&gt;List&lt;/tt&gt; interface places additional stipulations, beyond those</span></span><br><span class="line"><span class="comment"> * specified in the &lt;tt&gt;Collection&lt;/tt&gt; interface, on the contracts of the</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;iterator&lt;/tt&gt;, &lt;tt&gt;add&lt;/tt&gt;, &lt;tt&gt;remove&lt;/tt&gt;, &lt;tt&gt;equals&lt;/tt&gt;, and</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;hashCode&lt;/tt&gt; methods.  Declarations for other inherited methods are</span></span><br><span class="line"><span class="comment"> * also included here for convenience.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The &lt;tt&gt;List&lt;/tt&gt; interface provides four methods for positional (indexed)</span></span><br><span class="line"><span class="comment"> * access to list elements.  Lists (like Java arrays) are zero based.  Note</span></span><br><span class="line"><span class="comment"> * that these operations may execute in time proportional to the index value</span></span><br><span class="line"><span class="comment"> * for some implementations (the &lt;tt&gt;LinkedList&lt;/tt&gt; class, for</span></span><br><span class="line"><span class="comment"> * example). Thus, iterating over the elements in a list is typically</span></span><br><span class="line"><span class="comment"> * preferable to indexing through it if the caller does not know the</span></span><br><span class="line"><span class="comment"> * implementation.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The &lt;tt&gt;List&lt;/tt&gt; interface provides a special iterator, called a</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;ListIterator&lt;/tt&gt;, that allows element insertion and replacement, and</span></span><br><span class="line"><span class="comment"> * bidirectional access in addition to the normal operations that the</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;Iterator&lt;/tt&gt; interface provides.  A method is provided to obtain a</span></span><br><span class="line"><span class="comment"> * list iterator that starts at a specified position in the list.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The &lt;tt&gt;List&lt;/tt&gt; interface provides two methods to search for a specified</span></span><br><span class="line"><span class="comment"> * object.  From a performance standpoint, these methods should be used with</span></span><br><span class="line"><span class="comment"> * caution.  In many implementations they will perform costly linear</span></span><br><span class="line"><span class="comment"> * searches.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The &lt;tt&gt;List&lt;/tt&gt; interface provides two methods to efficiently insert and</span></span><br><span class="line"><span class="comment"> * remove multiple elements at an arbitrary point in the list.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Note: While it is permissible for lists to contain themselves as elements,</span></span><br><span class="line"><span class="comment"> * extreme caution is advised: the &lt;tt&gt;equals&lt;/tt&gt; and &lt;tt&gt;hashCode&lt;/tt&gt;</span></span><br><span class="line"><span class="comment"> * methods are no longer well defined on such a list.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Some list implementations have restrictions on the elements that</span></span><br><span class="line"><span class="comment"> * they may contain.  For example, some implementations prohibit null elements,</span></span><br><span class="line"><span class="comment"> * and some have restrictions on the types of their elements.  Attempting to</span></span><br><span class="line"><span class="comment"> * add an ineligible element throws an unchecked exception, typically</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;NullPointerException&lt;/tt&gt; or &lt;tt&gt;ClassCastException&lt;/tt&gt;.  Attempting</span></span><br><span class="line"><span class="comment"> * to query the presence of an ineligible element may throw an exception,</span></span><br><span class="line"><span class="comment"> * or it may simply return false; some implementations will exhibit the former</span></span><br><span class="line"><span class="comment"> * behavior and some will exhibit the latter.  More generally, attempting an</span></span><br><span class="line"><span class="comment"> * operation on an ineligible element whose completion would not result in</span></span><br><span class="line"><span class="comment"> * the insertion of an ineligible element into the list may throw an</span></span><br><span class="line"><span class="comment"> * exception or it may succeed, at the option of the implementation.</span></span><br><span class="line"><span class="comment"> * Such exceptions are marked as "optional" in the specification for this</span></span><br><span class="line"><span class="comment"> * interface.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This interface is a member of the</span></span><br><span class="line"><span class="comment"> * &lt;a href="&#123;<span class="doctag">@docRoot</span>&#125;/../technotes/guides/collections/index.html"&gt;</span></span><br><span class="line"><span class="comment"> * Java Collections Framework&lt;/a&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;E&gt; the type of elements in this list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Josh Bloch</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Neal Gafter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Collection</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Set</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ArrayList</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> LinkedList</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Vector</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Arrays#asList(Object[])</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Collections#nCopies(int, Object)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Collections#EMPTY_LIST</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> AbstractList</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> AbstractSequentialList</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="AbstractList"><a href="#AbstractList" class="headerlink" title="AbstractList"></a>AbstractList</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractCollection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="modConut"><a href="#modConut" class="headerlink" title="modConut"></a>modConut</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The number of times this list has been &lt;i&gt;structurally modified&lt;/i&gt;.</span></span><br><span class="line"><span class="comment"> * Structural modifications are those that change the size of the</span></span><br><span class="line"><span class="comment"> * list, or otherwise perturb it in such a fashion that iterations in</span></span><br><span class="line"><span class="comment"> * progress may yield incorrect results.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This field is used by the iterator and list iterator implementation</span></span><br><span class="line"><span class="comment"> * returned by the &#123;<span class="doctag">@code</span> iterator&#125; and &#123;<span class="doctag">@code</span> listIterator&#125; methods.</span></span><br><span class="line"><span class="comment"> * If the value of this field changes unexpectedly, the iterator (or list</span></span><br><span class="line"><span class="comment"> * iterator) will throw a &#123;<span class="doctag">@code</span> ConcurrentModificationException&#125; in</span></span><br><span class="line"><span class="comment"> * response to the &#123;<span class="doctag">@code</span> next&#125;, &#123;<span class="doctag">@code</span> remove&#125;, &#123;<span class="doctag">@code</span> previous&#125;,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> set&#125; or &#123;<span class="doctag">@code</span> add&#125; operations.  This provides</span></span><br><span class="line"><span class="comment"> * &lt;i&gt;fail-fast&lt;/i&gt; behavior, rather than non-deterministic behavior in</span></span><br><span class="line"><span class="comment"> * the face of concurrent modification during iteration.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;Use of this field by subclasses is optional.&lt;/b&gt; If a subclass</span></span><br><span class="line"><span class="comment"> * wishes to provide fail-fast iterators (and list iterators), then it</span></span><br><span class="line"><span class="comment"> * merely has to increment this field in its &#123;<span class="doctag">@code</span> add(int, E)&#125; and</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> remove(int)&#125; methods (and any other methods that it overrides</span></span><br><span class="line"><span class="comment"> * that result in structural modifications to the list).  A single call to</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> add(int, E)&#125; or &#123;<span class="doctag">@code</span> remove(int)&#125; must add no more than</span></span><br><span class="line"><span class="comment"> * one to this field, or the iterators (and list iterators) will throw</span></span><br><span class="line"><span class="comment"> * bogus &#123;<span class="doctag">@code</span> ConcurrentModificationExceptions&#125;.  If an implementation</span></span><br><span class="line"><span class="comment"> * does not wish to provide fail-fast iterators, this field may be</span></span><br><span class="line"><span class="comment"> * ignored.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Itr"><a href="#Itr" class="headerlink" title="Itr"></a>Itr</h2><h2 id="ListItr"><a href="#ListItr" class="headerlink" title="ListItr"></a>ListItr</h2><h1 id="AbstractSequentialList"><a href="#AbstractSequentialList" class="headerlink" title="AbstractSequentialList"></a>AbstractSequentialList</h1><blockquote>
<p>有序List</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractSequentialList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="get-–-AbstractObjectList"><a href="#get-–-AbstractObjectList" class="headerlink" title="get() – AbstractObjectList"></a>get() – AbstractObjectList</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt; getLength()) &#123;</span><br><span class="line">        <span class="keyword">return</span> item(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="get-–-AbstractSequentialList"><a href="#get-–-AbstractSequentialList" class="headerlink" title="get() – AbstractSequentialList"></a>get() – AbstractSequentialList</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the element at the specified position in this list.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This implementation first gets a list iterator pointing to the</span></span><br><span class="line"><span class="comment"> * indexed element (with &lt;tt&gt;listIterator(index)&lt;/tt&gt;).  Then, it gets</span></span><br><span class="line"><span class="comment"> * the element using &lt;tt&gt;ListIterator.next&lt;/tt&gt; and returns it.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IndexOutOfBoundsException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> listIterator(index).next();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchElementException exc) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="listIterator-index"><a href="#listIterator-index" class="headerlink" title="listIterator(index)"></a>listIterator(index)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a list-iterator of the elements in this list (in proper</span></span><br><span class="line"><span class="comment"> * sequence), starting at the specified position in the list.</span></span><br><span class="line"><span class="comment"> * Obeys the general contract of &#123;<span class="doctag">@code</span> List.listIterator(int)&#125;.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The list-iterator is &lt;i&gt;fail-fast&lt;/i&gt;: if the list is structurally</span></span><br><span class="line"><span class="comment"> * modified at any time after the Iterator is created, in any way except</span></span><br><span class="line"><span class="comment"> * through the list-iterator's own &#123;<span class="doctag">@code</span> remove&#125; or &#123;<span class="doctag">@code</span> add&#125;</span></span><br><span class="line"><span class="comment"> * methods, the list-iterator will throw a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> ConcurrentModificationException&#125;.  Thus, in the face of</span></span><br><span class="line"><span class="comment"> * concurrent modification, the iterator fails quickly and cleanly, rather</span></span><br><span class="line"><span class="comment"> * than risking arbitrary, non-deterministic behavior at an undetermined</span></span><br><span class="line"><span class="comment"> * time in the future.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index index of the first element to be returned from the</span></span><br><span class="line"><span class="comment"> *              list-iterator (by a call to &#123;<span class="doctag">@code</span> next&#125;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a ListIterator of the elements in this list (in proper</span></span><br><span class="line"><span class="comment"> * sequence), starting at the specified position in the list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IndexOutOfBoundsException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> List#listIterator(int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    checkPositionIndex(index);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ListItr(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ListIterator"><a href="#ListIterator" class="headerlink" title="ListIterator"></a>ListIterator</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An iterator for lists that allows the programmer</span></span><br><span class="line"><span class="comment"> * to traverse the list in either direction, modify</span></span><br><span class="line"><span class="comment"> * the list during iteration, and obtain the iterator's</span></span><br><span class="line"><span class="comment"> * current position in the list. A &#123;<span class="doctag">@code</span> ListIterator&#125;</span></span><br><span class="line"><span class="comment"> * has no current element; its &lt;I&gt;cursor position&lt;/I&gt; always</span></span><br><span class="line"><span class="comment"> * lies between the element that would be returned by a call</span></span><br><span class="line"><span class="comment"> * to &#123;<span class="doctag">@code</span> previous()&#125; and the element that would be</span></span><br><span class="line"><span class="comment"> * returned by a call to &#123;<span class="doctag">@code</span> next()&#125;.</span></span><br><span class="line"><span class="comment"> * An iterator for a list of length &#123;<span class="doctag">@code</span> n&#125; has &#123;<span class="doctag">@code</span> n+1&#125; possible</span></span><br><span class="line"><span class="comment"> * cursor positions, as illustrated by the carets (&#123;<span class="doctag">@code</span> ^&#125;) below:</span></span><br><span class="line"><span class="comment"> * &lt;PRE&gt;</span></span><br><span class="line"><span class="comment"> *                      Element(0)   Element(1)   Element(2)   ... Element(n-1)</span></span><br><span class="line"><span class="comment"> * cursor positions:  ^            ^            ^            ^                  ^</span></span><br><span class="line"><span class="comment"> * &lt;/PRE&gt;</span></span><br><span class="line"><span class="comment"> * Note that the &#123;<span class="doctag">@link</span> #remove&#125; and &#123;<span class="doctag">@link</span> #set(Object)&#125; methods are</span></span><br><span class="line"><span class="comment"> * &lt;i&gt;not&lt;/i&gt; defined in terms of the cursor position;  they are defined to</span></span><br><span class="line"><span class="comment"> * operate on the last element returned by a call to &#123;<span class="doctag">@link</span> #next&#125; or</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #previous()&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This interface is a member of the</span></span><br><span class="line"><span class="comment"> * &lt;a href="&#123;<span class="doctag">@docRoot</span>&#125;/../technotes/guides/collections/index.html"&gt;</span></span><br><span class="line"><span class="comment"> * Java Collections Framework&lt;/a&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>  Josh Bloch</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Collection</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> List</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Iterator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Enumeration</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> List#listIterator()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span>   1.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ListIterator</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="next"><a href="#next" class="headerlink" title="next()"></a>next()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the next element in the list and advances the cursor position.</span></span><br><span class="line"><span class="comment"> * This method may be called repeatedly to iterate through the list,</span></span><br><span class="line"><span class="comment"> * or intermixed with calls to &#123;<span class="doctag">@link</span> #previous&#125; to go back and forth.</span></span><br><span class="line"><span class="comment"> * (Note that alternating calls to &#123;<span class="doctag">@code</span> next&#125; and &#123;<span class="doctag">@code</span> previous&#125;</span></span><br><span class="line"><span class="comment"> * will return the same element repeatedly.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the next element in the list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchElementException if the iteration has no next element</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">E <span class="title">next</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="previous"><a href="#previous" class="headerlink" title="previous()"></a>previous()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the previous element in the list and moves the cursor</span></span><br><span class="line"><span class="comment"> * position backwards.  This method may be called repeatedly to</span></span><br><span class="line"><span class="comment"> * iterate through the list backwards, or intermixed with calls to</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #next&#125; to go back and forth.  (Note that alternating calls</span></span><br><span class="line"><span class="comment"> * to &#123;<span class="doctag">@code</span> next&#125; and &#123;<span class="doctag">@code</span> previous&#125; will return the same</span></span><br><span class="line"><span class="comment"> * element repeatedly.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the previous element in the list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchElementException if the iteration has no previous</span></span><br><span class="line"><span class="comment"> *         element</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">E <span class="title">previous</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h1 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h1><blockquote>
<p>线程安全的ArrayList结构</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A thread-safe variant of &#123;<span class="doctag">@link</span> java.util.ArrayList&#125; in which all mutative</span></span><br><span class="line"><span class="comment"> * operations (&#123;<span class="doctag">@code</span> add&#125;, &#123;<span class="doctag">@code</span> set&#125;, and so on) are implemented by</span></span><br><span class="line"><span class="comment"> * making a fresh copy of the underlying array.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This is ordinarily too costly, but may be &lt;em&gt;more&lt;/em&gt; efficient</span></span><br><span class="line"><span class="comment"> * than alternatives when traversal operations vastly outnumber</span></span><br><span class="line"><span class="comment"> * mutations, and is useful when you cannot or don't want to</span></span><br><span class="line"><span class="comment"> * synchronize traversals, yet need to preclude interference among</span></span><br><span class="line"><span class="comment"> * concurrent threads.  The "snapshot" style iterator method uses a</span></span><br><span class="line"><span class="comment"> * reference to the state of the array at the point that the iterator</span></span><br><span class="line"><span class="comment"> * was created. This array never changes during the lifetime of the</span></span><br><span class="line"><span class="comment"> * iterator, so interference is impossible and the iterator is</span></span><br><span class="line"><span class="comment"> * guaranteed not to throw &#123;<span class="doctag">@code</span> ConcurrentModificationException&#125;.</span></span><br><span class="line"><span class="comment"> * The iterator will not reflect additions, removals, or changes to</span></span><br><span class="line"><span class="comment"> * the list since the iterator was created.  Element-changing</span></span><br><span class="line"><span class="comment"> * operations on iterators themselves (&#123;<span class="doctag">@code</span> remove&#125;, &#123;<span class="doctag">@code</span> set&#125;, and</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> add&#125;) are not supported. These methods throw</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> UnsupportedOperationException&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;All elements are permitted, including &#123;<span class="doctag">@code</span> null&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Memory consistency effects: As with other concurrent</span></span><br><span class="line"><span class="comment"> * collections, actions in a thread prior to placing an object into a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> CopyOnWriteArrayList&#125;</span></span><br><span class="line"><span class="comment"> * &lt;a href="package-summary.html#MemoryVisibility"&gt;&lt;i&gt;happen-before&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * actions subsequent to the access or removal of that element from</span></span><br><span class="line"><span class="comment"> * the &#123;<span class="doctag">@code</span> CopyOnWriteArrayList&#125; in another thread.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This class is a member of the</span></span><br><span class="line"><span class="comment"> * &lt;a href="&#123;<span class="doctag">@docRoot</span>&#125;/../technotes/guides/collections/index.html"&gt;</span></span><br><span class="line"><span class="comment"> * Java Collections Framework&lt;/a&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;E&gt; the type of elements held in this collection</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Doug Lea</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CopyOnWriteArrayList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="COWIterator"><a href="#COWIterator" class="headerlink" title="COWIterator"></a>COWIterator</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">COWIterator</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">ListIterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h1><h2 id="get-–-arrayList"><a href="#get-–-arrayList" class="headerlink" title="get() – arrayList"></a>get() – arrayList</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    rangeCheck(index);</span><br><span class="line">		</span><br><span class="line">    <span class="keyword">return</span> elementData(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>检查是否越界，返回对应下标元素</p>
</blockquote>
<h2 id="elementData"><a href="#elementData" class="headerlink" title="elementData"></a>elementData</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The array buffer into which the elements of the ArrayList are stored.</span></span><br><span class="line"><span class="comment">    * The capacity of the ArrayList is the length of this array buffer. Any</span></span><br><span class="line"><span class="comment">    * empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span></span><br><span class="line"><span class="comment">    * will be expanded to DEFAULT_CAPACITY when the first element is added.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">transient</span> Object[] elementData; <span class="comment">// non-private to simplify nested class access</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>存储ArrayList中的元素</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>空ArrayList</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>初始化时的默认大小<br>当初始化ArrayList实例时，若为实例赋大小，则使用 EMPTY_ELEMENTDATA，若不赋大小，则使用 DEFAULTCAPACITY_EMPTY_ELEMENTDATA<br>区别在当向空的ArrayList添加元素时</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span> +</span><br><span class="line">                   initialCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateCapacity</span><span class="params">(Object[] elementData, <span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">           <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> minCapacity;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">       ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">       modCount++;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// overflow-conscious code</span></span><br><span class="line">       <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">           grow(minCapacity);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">       ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">       elementData[size++] = e;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// overflow-conscious code</span></span><br><span class="line">       <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">       <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">       <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">           newCapacity = minCapacity;</span><br><span class="line">       <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">           newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">       <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">       elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="next-1"><a href="#next-1" class="headerlink" title="next()"></a>next()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">int</span> i = cursor;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    Object[] elementData = ArrayList.<span class="keyword">this</span>.elementData;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    cursor = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="previous-1"><a href="#previous-1" class="headerlink" title="previous()"></a>previous()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">previous</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">int</span> i = cursor - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    Object[] elementData = ArrayList.<span class="keyword">this</span>.elementData;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    cursor = i;</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h1><h2 id="next-2"><a href="#next-2" class="headerlink" title="next()"></a>next()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">if</span> (!hasNext())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line"></span><br><span class="line">    lastReturned = next;</span><br><span class="line">    next = next.next;</span><br><span class="line">    nextIndex++;</span><br><span class="line">    <span class="keyword">return</span> lastReturned.item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="previous-2"><a href="#previous-2" class="headerlink" title="previous()"></a>previous()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">previous</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">if</span> (!hasPrevious())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line"></span><br><span class="line">    lastReturned = next = (next == <span class="keyword">null</span>) ? last : next.prev;</span><br><span class="line">    nextIndex--;</span><br><span class="line">    <span class="keyword">return</span> lastReturned.item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>源码</tag>
        <tag>集合</tag>
      </tags>
  </entry>
  <entry>
    <title>portal搭建相关</title>
    <url>/2020/12/11/portal%E6%90%AD%E5%BB%BA%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h2 id="web-api项目"><a href="#web-api项目" class="headerlink" title="web api项目"></a>web api项目</h2><blockquote>
<p>解决方案下新建ASP.NET WEB应用程序（.net Framework）</p>
</blockquote>
<p><img src="1.jpg" alt=""></p>
<blockquote>
<p>右键项目发布<br>根据所选的发布内容生成相应的目录结构<br>portal即发布在文件夹下，由多个dll配合完成后台响应</p>
</blockquote>
<p><img src="2.jpg" alt=""></p>
<h2 id="服务器站点"><a href="#服务器站点" class="headerlink" title="服务器站点"></a>服务器站点</h2><blockquote>
<p>将项目目录配置在站点下</p>
</blockquote>
<h2 id="事件查看器"><a href="#事件查看器" class="headerlink" title="事件查看器"></a>事件查看器</h2><blockquote>
<p>查找bug</p>
</blockquote>
<p><img src="3.jpg" alt=""></p>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>Portal</tag>
      </tags>
  </entry>
  <entry>
    <title>发货单页面</title>
    <url>/2020/12/11/%E5%8F%91%E8%B4%A7%E5%8D%95%E9%A1%B5%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h2><blockquote>
<p>移动端vue框架  vant<br><a href="https://vant-contrib.gitee.io/vant/#/zh-CN/" target="_blank" rel="noopener">文档</a></p>
</blockquote>
<h2 id="js"><a href="#js" class="headerlink" title="js"></a>js</h2><h3 id="获取url参数"><a href="#获取url参数" class="headerlink" title="获取url参数"></a>获取url参数</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取页面url参数</span></span><br><span class="line">getQueryVariable(variable)</span><br><span class="line">&#123;</span><br><span class="line">       <span class="keyword">var</span> query = <span class="built_in">window</span>.location.search.substring(<span class="number">1</span>);</span><br><span class="line">       <span class="keyword">var</span> vars = query.split(<span class="string">"&amp;"</span>);</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.length;i++) &#123;</span><br><span class="line">               <span class="keyword">var</span> pair = vars[i].split(<span class="string">"="</span>);</span><br><span class="line">               <span class="keyword">if</span>(pair[<span class="number">0</span>] == variable)&#123;<span class="keyword">return</span> pair[<span class="number">1</span>];&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="css背景图片设置"><a href="#css背景图片设置" class="headerlink" title="css背景图片设置"></a>css背景图片设置</h2><h3 id="body设置"><a href="#body设置" class="headerlink" title="body设置"></a>body设置</h3><blockquote>
<p>缺点是只能横向充满，高度是按比例拉伸的</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">   <span class="attribute">background-image</span>:<span class="built_in">url</span>(test.jpg);</span><br><span class="line">   <span class="attribute">background-repeat</span>:no-repeat;</span><br><span class="line">   <span class="attribute">background-size</span>:<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用一个div充满整个body"><a href="#用一个div充满整个body" class="headerlink" title="用一个div充满整个body"></a>用一个div充满整个body</h3><blockquote>
<p>缺点可想而知，网页的代码只能放在这个div里</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"background"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>测试测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">	<span class="attribute">overflow</span>:hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.background</span>&#123;</span><br><span class="line">	<span class="attribute">position</span>:absolute;</span><br><span class="line">	<span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">background-image</span>:<span class="built_in">url</span>(timg.jpg);</span><br><span class="line">	<span class="attribute">background-repeat</span>:no-repeat;</span><br><span class="line">	<span class="attribute">background-size</span>:<span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用一个img充满整个body"><a href="#用一个img充满整个body" class="headerlink" title="用一个img充满整个body"></a>用一个img充满整个body</h3><blockquote>
<p>后面的元素都要设置定位</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"background"</span> <span class="attr">src</span>=<span class="string">"timg.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>测试测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">	<span class="attribute">overflow</span>:hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span><span class="selector-class">.background</span>&#123;</span><br><span class="line">	<span class="attribute">position</span>:absolute;</span><br><span class="line">	<span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">	<span class="attribute">position</span>:absolute;</span><br><span class="line">	<span class="attribute">top</span>:<span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="opacity"><a href="#opacity" class="headerlink" title="opacity"></a>opacity</h3><blockquote>
<p>设置div透明度</p>
</blockquote>
<h2 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h2><h3 id="AllowAnonymous-匿名头"><a href="#AllowAnonymous-匿名头" class="headerlink" title="AllowAnonymous 匿名头"></a>AllowAnonymous 匿名头</h3><blockquote>
<p>绕过登录验证，类似注解</p>
</blockquote>
<h3 id="系统参数"><a href="#系统参数" class="headerlink" title="系统参数"></a>系统参数</h3><blockquote>
<p>自定义项中系统参数设置</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取系统参数</span></span><br><span class="line"><span class="keyword">string</span> ip = CrmHelper.GetSystemParameterValue(OrganizationService, <span class="string">"dingTalkIp"</span>);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>自定义页面</tag>
        <tag>绕过登录权限</tag>
      </tags>
  </entry>
  <entry>
    <title>关键业务表单体现vip客户</title>
    <url>/2020/12/18/%E5%85%B3%E9%94%AE%E4%B8%9A%E5%8A%A1%E8%A1%A8%E5%8D%95%E4%BD%93%E7%8E%B0vip%E5%AE%A2%E6%88%B7/</url>
    <content><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p><img src="%E5%85%B3%E9%94%AE%E4%B8%9A%E5%8A%A1%E8%A1%A8%E5%8D%95%E4%BD%93%E7%8E%B0vip%E5%AE%A2%E6%88%B7_files/1.png" alt=""></p>
<blockquote>
<p>销售信息、客户档案、客户分级申请单、合同、发货通知单、逾期催收和服务单</p>
</blockquote>
<h2 id="客户档案"><a href="#客户档案" class="headerlink" title="客户档案"></a>客户档案</h2><blockquote>
<p>account.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="keyword">if</span>(rtcrm(<span class="string">"#new_accountproperty"</span>).val()==<span class="number">2</span>)&#123;</span><br><span class="line">   <span class="built_in">window</span>.parent.document.getElementById(<span class="string">"客户名称_label"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line"><span class="built_in">window</span>.parent.document.getElementById(<span class="string">"客户类别_label"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="销售信息"><a href="#销售信息" class="headerlink" title="销售信息"></a>销售信息</h2><blockquote>
<p>opportunity.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据客户名称查询客户类别，vip客户背景颜色变为黄色</span></span><br><span class="line"><span class="keyword">var</span> id = rtcrm(<span class="string">"#new_account_id"</span>).val()[<span class="number">0</span>].id.replace(<span class="string">"&#123;"</span>, <span class="string">""</span>).replace(<span class="string">"&#125;"</span>, <span class="string">""</span>);</span><br><span class="line"><span class="keyword">var</span> account = rtcrm.retrieve(<span class="string">"accounts("</span> + id + <span class="string">")"</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">var</span> new_accountproperty = account[<span class="string">"new_accountproperty"</span>];</span><br><span class="line"><span class="keyword">if</span> (new_accountproperty == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.parent.document.getElementById(<span class="string">"new_account_id_lookupValue"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="客户分级申请单"><a href="#客户分级申请单" class="headerlink" title="客户分级申请单"></a>客户分级申请单</h2><blockquote>
<p>new_accountclassification.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> id = rtcrm(<span class="string">"#new_account_id"</span>).val()[<span class="number">0</span>].id.replace(<span class="string">"&#123;"</span>, <span class="string">""</span>).replace(<span class="string">"&#125;"</span>, <span class="string">""</span>);</span><br><span class="line"><span class="keyword">var</span> account = rtcrm.retrieve(<span class="string">"accounts("</span> + id + <span class="string">")"</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">var</span> new_accountproperty = account[<span class="string">"new_accountproperty"</span>];</span><br><span class="line"><span class="keyword">if</span> (new_accountproperty == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.parent.document.getElementById(<span class="string">"new_account_id"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">    <span class="built_in">window</span>.parent.document.getElementById(<span class="string">"客户类别_label"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="合同申请单"><a href="#合同申请单" class="headerlink" title="合同申请单"></a>合同申请单</h2><blockquote>
<p>new_contract.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">new_enduser_id_lookupValue</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> id = rtcrm(<span class="string">"#new_enduser_id"</span>).val()[<span class="number">0</span>].id.replace(<span class="string">"&#123;"</span>, <span class="string">""</span>).replace(<span class="string">"&#125;"</span>, <span class="string">""</span>);</span><br><span class="line">   <span class="keyword">var</span> account = rtcrm.retrieve(<span class="string">"accounts("</span> + id + <span class="string">")"</span>, <span class="literal">true</span>);</span><br><span class="line">   <span class="keyword">var</span> new_accountproperty = account[<span class="string">"new_accountproperty"</span>];</span><br><span class="line">   <span class="keyword">if</span> (new_accountproperty == <span class="number">2</span>) &#123;</span><br><span class="line">       <span class="built_in">window</span>.parent.document.getElementById(<span class="string">"new_enduser_id_lookupValue"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="发货通知单"><a href="#发货通知单" class="headerlink" title="发货通知单"></a>发货通知单</h2><blockquote>
<p>new_ord_shipment.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据最终用户查询客户类别，vip客户背景颜色变为黄色</span></span><br><span class="line"><span class="keyword">var</span> id = rtcrm(<span class="string">"#new_finalaccount_id"</span>).val()[<span class="number">0</span>].id.replace(<span class="string">"&#123;"</span>, <span class="string">""</span>).replace(<span class="string">"&#125;"</span>, <span class="string">""</span>);</span><br><span class="line"><span class="keyword">var</span> account = rtcrm.retrieve(<span class="string">"accounts("</span> + id + <span class="string">")"</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">var</span> new_accountproperty = account[<span class="string">"new_accountproperty"</span>];</span><br><span class="line"><span class="keyword">if</span> (new_accountproperty == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.parent.document.getElementById(<span class="string">"new_finalaccount_id"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="逾期催收"><a href="#逾期催收" class="headerlink" title="逾期催收"></a>逾期催收</h2><blockquote>
<p>new_delaymanagement.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> id = rtcrm(<span class="string">"#new_account_id"</span>).val()[<span class="number">0</span>].id.replace(<span class="string">"&#123;"</span>, <span class="string">""</span>).replace(<span class="string">"&#125;"</span>, <span class="string">""</span>);</span><br><span class="line">   <span class="keyword">var</span> account = rtcrm.retrieve(<span class="string">"accounts("</span> + id + <span class="string">")"</span>, <span class="literal">true</span>);</span><br><span class="line">   <span class="keyword">var</span> new_accountproperty = account[<span class="string">"new_accountproperty"</span>];</span><br><span class="line">   <span class="keyword">if</span> (new_accountproperty == <span class="number">2</span>) &#123;</span><br><span class="line">       <span class="built_in">window</span>.parent.document.getElementById(<span class="string">"new_account_id"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="服务单"><a href="#服务单" class="headerlink" title="服务单"></a>服务单</h2><blockquote>
<p>new_srv_workorder.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> id = rtcrm(<span class="string">"#new_customerid"</span>).val()[<span class="number">0</span>].id.replace(<span class="string">"&#123;"</span>, <span class="string">""</span>).replace(<span class="string">"&#125;"</span>, <span class="string">""</span>);</span><br><span class="line">   <span class="keyword">var</span> account = rtcrm.retrieve(<span class="string">"accounts("</span> + id + <span class="string">")"</span>, <span class="literal">true</span>);</span><br><span class="line">   <span class="keyword">var</span> new_accountproperty = account[<span class="string">"new_accountproperty"</span>];</span><br><span class="line">   <span class="keyword">if</span> (new_accountproperty == <span class="number">2</span>) &#123;</span><br><span class="line">       <span class="built_in">window</span>.parent.document.getElementById(<span class="string">"new_customerid_lookupValue"</span>).style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>CRM样式变更</tag>
      </tags>
  </entry>
  <entry>
    <title>发货通知单二维码</title>
    <url>/2020/11/17/%E5%8F%91%E8%B4%A7%E9%80%9A%E7%9F%A5%E5%8D%95%E4%BA%8C%E7%BB%B4%E7%A0%81/</url>
    <content><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><blockquote>
<p>成品资源出库时使用的发货通知单中二维码信息增加：<br>1、产品信息(物料名称) new_contractdetail_id<br>2、合同号 (合同单号) new_contract_id<br>3、最终客户 new_finalaccount_id<br>4、运输方式 new_shiptype –单行文本<br>5、产品送达地 new_shipplace  –单行文本<br>6、交货联系人 new_contact2 –单行文本</p>
</blockquote>
<h2 id="代码位置"><a href="#代码位置" class="headerlink" title="代码位置"></a>代码位置</h2><blockquote>
<p>RekTec.Crm.Workflow.Sales.ShipmentController.CreateQRCode</p>
</blockquote>
<h2 id="OrganizationService-Retrieve"><a href="#OrganizationService-Retrieve" class="headerlink" title="OrganizationService.Retrieve"></a>OrganizationService.Retrieve</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">OrganizationService.Retrieve(<span class="string">"new_ord_shipment"</span>, <span class="keyword">new</span> Guid(shipmentid), <span class="keyword">new</span> ColumnSet(<span class="keyword">new</span> string[] &#123; <span class="string">"new_name"</span> &#125;));</span><br><span class="line">Entity accountclassification = OrganizationService.Retrieve(<span class="string">"new_accountclassification"</span>, classificationId, <span class="keyword">new</span> ColumnSet(<span class="keyword">true</span>));</span><br><span class="line">columnSet: 传入字段时为字段，传入<span class="keyword">true</span>为所有字段，传入<span class="keyword">false</span>只查询主键</span><br></pre></td></tr></table></figure>

<h2 id="修改字段大小"><a href="#修改字段大小" class="headerlink" title="修改字段大小"></a>修改字段大小</h2><blockquote>
<p>自定义项字段详情中可设置字段长度</p>
</blockquote>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>销售</tag>
        <tag>报表</tag>
      </tags>
  </entry>
  <entry>
    <title>开窗函数</title>
    <url>/2020/10/21/%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h1 id="开窗函数"><a href="#开窗函数" class="headerlink" title="开窗函数"></a>开窗函数</h1><blockquote>
<p>与聚合函数一样，开窗函数也是对行集组进行聚合计算，但是它不像普通聚合函数那样每组只返回一个值，开窗函数可以为每组返回多个值，因为开窗函数所执行聚合计算的行集组是窗口。在 ISO SQL 规定了这样的函数为开窗函数，在 Oracle 中则被称为分析函数。</p>
</blockquote>
<h2 id="PARTITION-BY"><a href="#PARTITION-BY" class="headerlink" title="PARTITION BY"></a>PARTITION BY</h2><blockquote>
<p>分组<br>开窗函数的OVER关键字后括号中的可以使用PARTITION BY 子句来定义行的分区来供进行聚合计算。与GROUP BY 子句不同，PARTITION BY 子句创建的分区是独立于结果集的，创建的分区只是供进行聚合计算的，而且不同的开窗函数所创建的分区也不互相影响。</p>
</blockquote>
<h2 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h2><blockquote>
<p>排序</p>
</blockquote>
<h2 id="聚合开窗函数"><a href="#聚合开窗函数" class="headerlink" title="聚合开窗函数"></a>聚合开窗函数</h2><blockquote>
<p>聚合函数(列) OVER (选项)，这里的选项可以是PARTITION BY子句，但不可是ORDER BY子句</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">name</span>,</span><br><span class="line">new_age,</span><br><span class="line"><span class="keyword">SUM</span>(new_age)<span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> new_age) max_age</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Account</span></span><br></pre></td></tr></table></figure>
<h2 id="排序开窗函数"><a href="#排序开窗函数" class="headerlink" title="排序开窗函数"></a>排序开窗函数</h2><blockquote>
<p>排序函数(列) OVER(选项)，这里的选项可以是ORDER BY子句，也可以是　OVER（PARTITION BY子句　ORDER BY子句），但不可以是PARTITION BY子句</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">name</span>,</span><br><span class="line">AccountNumber,</span><br><span class="line">row_number()<span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> AccountNumber <span class="keyword">ORDER</span> <span class="keyword">BY</span> AccountNumber) <span class="keyword">repeat</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Account</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>SQL Server</tag>
        <tag>数据库</tag>
        <tag>SQL语法</tag>
      </tags>
  </entry>
  <entry>
    <title>rtcrm.js常用脚本库方法解析</title>
    <url>/2020/11/15/rtcrm-js%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC%E5%BA%93%E6%96%B9%E6%B3%95%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***********************************************************</span></span><br><span class="line"><span class="comment">将Xrm对象下的常用的方法封装为 Rt对象，使用类似JQuery的Selector 方式访问 </span></span><br><span class="line"><span class="comment">选择器，支持如 #new_name, :section #section01 ,#tab tab01 三种的选择器</span></span><br><span class="line"><span class="comment">************************************************************/</span></span><br><span class="line"><span class="keyword">var</span> rtcrm = <span class="function"><span class="keyword">function</span> (<span class="params">selector</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_isNull</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;check if object null&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="v"&gt;&lt;/param&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns type=""&gt;&lt;/returns&gt;</span></span><br><span class="line">        <span class="keyword">return</span> v === <span class="literal">null</span> || v === <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_isNullOrEmpty</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;check if stirng is null or empty&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="v"&gt;&lt;/param&gt;</span></span><br><span class="line">        <span class="keyword">return</span> _isNull(v) || v === <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_gets</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;根据selector返回CRM的对象数组&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns type="Array"&gt;CRM对象数组&lt;/returns&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (_isNullOrEmpty(selector)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将形如 #new_name,#new_date,:tab #tab01 的selector拆分逐个判断查找</span></span><br><span class="line">        <span class="keyword">var</span> strList = selector.split(<span class="string">','</span>);</span><br><span class="line">        <span class="keyword">if</span> (_isNull(strList) || strList.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//要返回的UI 对象数据，包括界面上的控件、Tab、Section三种类型</span></span><br><span class="line">        <span class="keyword">var</span> uis = [];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//逐个的Selector判断</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; strList.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> str = strList[i];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// # 号开头的是Id Selector</span></span><br><span class="line">            <span class="keyword">if</span> (str.charAt(<span class="number">0</span>) == <span class="string">"#"</span>) &#123;</span><br><span class="line">				<span class="comment">//去掉前缀</span></span><br><span class="line">                <span class="keyword">var</span> ui = Xrm.Page.ui.controls.get(str.substring(<span class="number">1</span>));</span><br><span class="line">                <span class="keyword">if</span> (ui) &#123;</span><br><span class="line">                    uis[uis.length] = ui;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// * 代表选择所有的界面UI控件</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (str.charAt(<span class="number">0</span>) == <span class="string">"*"</span>) &#123;</span><br><span class="line">                Xrm.Page.ui.controls.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">uiA</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (uiA) &#123;</span><br><span class="line">                        uis[uis.length] = uiA;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//：好开头的代表伪类，只支持 ;tab :section两种伪类</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (str.charAt(<span class="number">0</span>) == <span class="string">":"</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> tabStrList = str.split(<span class="string">' '</span>);</span><br><span class="line">                <span class="keyword">if</span> (_isNull(tabStrList) || tabStrList.length &lt; <span class="number">2</span> || tabStrList[<span class="number">1</span>].substring(<span class="number">0</span>, <span class="number">1</span>) != <span class="string">"#"</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> tabName = tabStrList[<span class="number">1</span>].substring(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// :tab 伪类 selector</span></span><br><span class="line">                <span class="keyword">var</span> obj = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (tabStrList[<span class="number">0</span>] == <span class="string">":tab"</span>) &#123;</span><br><span class="line">                    obj = Xrm.Page.ui.tabs.get(tabName);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//:section 伪类 selector</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (tabStrList[<span class="number">0</span>] == <span class="string">":section"</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> tabs = Xrm.Page.ui.tabs.get();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> tabs) &#123;</span><br><span class="line">                        obj = tabs[index].sections.get(tabName);</span><br><span class="line">                        <span class="keyword">if</span> (!_isNull(obj))</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (_isNull(obj)) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="comment">//如果Selector内容只有2个字符串，如 :tab #tab01 ,则代表选择的是tab本身</span></span><br><span class="line">                <span class="keyword">if</span> (tabStrList.length == <span class="number">2</span>) &#123;</span><br><span class="line">                    uis[uis.length] = obj;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//如果Selector内容只有3 个字符串，如 :tab #tab01 * ,代表选择tab下的所有的 控件，第三个字符串必须是 * 号</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (tabStrList.length == <span class="number">3</span>) &#123;</span><br><span class="line">                    tabStrList[<span class="number">2</span>] == <span class="string">"*"</span> &amp;&amp; obj &amp;&amp; obj.controls &amp;&amp; obj.controls.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">uiA</span>) </span>&#123;</span><br><span class="line">                        uis[uis.length] = uiA;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_each</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;对于 选择到的所有的CRM UI元素调用 fn函数，fn函数形如： function(ui,index)&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="fn"&gt;回调函数&lt;/param&gt;</span></span><br><span class="line">        <span class="keyword">var</span> objs = _gets();</span><br><span class="line">        <span class="keyword">if</span> (_isNull(objs) || objs.length == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; objs.length; i++) &#123;</span><br><span class="line">            fn &amp;&amp; fn(objs[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_eachAttr</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;对于 选择到的所有的CRM attribute 调用 fn函数，fn函数形如： function(attr,index)&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="fn"&gt;回调函数&lt;/param&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (_isNull(fn)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> objs = _gets();</span><br><span class="line">        <span class="keyword">if</span> (_isNull(objs) || objs.length == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; objs.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (objs[i] &amp;&amp; objs[i].getAttribute) &#123;</span><br><span class="line">                <span class="keyword">var</span> attr = objs[i].getAttribute();</span><br><span class="line">                fn &amp;&amp; fn(attr, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_get</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;返回selector选择到的第 i 个UI 控件，如果i 不输入，则返回第一个&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="i"&gt;字段的索引，标识第几个字段&lt;/param&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// '&gt;'优先级大于'&amp;&amp;'大于'?:',i为undefined时,undefined&gt;0返回false,undefined&amp;&amp;false为undefined,undefined?undefined:0值为0</span></span><br><span class="line">		<span class="comment">//undefined 派生自 null，null 和 undefined 都表示空缺的值，转化为布尔值时都是假值，可以相等</span></span><br><span class="line">		<span class="comment">//null 和 undefined 属于两种不同类型，使用全等运算符（==）或 typeof 运算符可以进行检测</span></span><br><span class="line">		<span class="comment">//检测一个变量是否初始化，可以使用 、undefined或typeof快速检测 eg：(a == undefined) &amp;&amp; (a = 0);(typeof a == "undefined") &amp;&amp; (a = 0);</span></span><br><span class="line">        <span class="keyword">var</span> index = i &amp;&amp; i &gt; <span class="number">0</span> ? i : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> objs = _gets();</span><br><span class="line">		<span class="comment">//若为只传一个页面字段的情况下,如rtcrm(#new_name),则此时objs中只有一个boj为"Xrm.Page.ui.controls.get('new_name');",obj.length&gt;index为true,objs&amp;&amp;1为1,1&amp;&amp;true为true</span></span><br><span class="line">		<span class="comment">//则表达式结果为objs[0]</span></span><br><span class="line">        <span class="keyword">return</span> objs &amp;&amp; objs.length &amp;&amp; objs.length &gt; index ? objs[index] : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_getAttr</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">///	&lt;summary&gt;返回selector选择到的第 1 个attribute &lt;/summary&gt;</span></span><br><span class="line">        <span class="keyword">var</span> obj = _get();</span><br><span class="line">        <span class="keyword">return</span> obj &amp;&amp; obj.getAttribute ? obj.getAttribute() : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_val</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        <span class="comment">///	&lt;summary&gt;获取字段的值，或者设定字段的值&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">///	&lt;param name="v" type="Object"&gt;如果v==undifined，则为获取字段的值，否则为设定字段的值&lt;/param&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> attr = _getAttr();</span><br><span class="line">        <span class="keyword">if</span> (_isNull(attr)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (v === <span class="literal">undefined</span>)</span><br><span class="line">            <span class="keyword">return</span> attr.getValue ? attr.getValue() : <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> attr.setValue ? attr.setValue(v) : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_text</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;获取CRM的字段的文本表示&lt;/summary&gt;</span></span><br><span class="line">        <span class="keyword">var</span> attr = _getAttr();</span><br><span class="line">        <span class="keyword">return</span> attr &amp;&amp; attr.getText ? attr.getText() : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_req</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;获取或设定字段的Requie Level，none、&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="v"&gt;none，required，recommended&lt;/param&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (_isNullOrEmpty(v)) &#123;</span><br><span class="line">            <span class="keyword">var</span> attr = _getAttr();</span><br><span class="line">            <span class="keyword">return</span> attr &amp;&amp; attr.getRequiredLevel ? attr.getRequiredLevel() : <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            _eachAttr(<span class="function"><span class="keyword">function</span> (<span class="params">attribute</span>) </span>&#123;</span><br><span class="line">                attribute &amp;&amp; attribute.setRequiredLevel &amp;&amp; attribute.setRequiredLevel(v);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_length</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;返回选择器选择到的UI控件的个数&lt;/summary&gt;</span></span><br><span class="line">        <span class="keyword">var</span> objs = _gets();</span><br><span class="line">        <span class="keyword">if</span> (_isNull(objs)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> objs.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_attrType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;字段的属性类别&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns type="String"&gt;&lt;/returns&gt;</span></span><br><span class="line">        <span class="keyword">var</span> attr = _getAttr();</span><br><span class="line">        <span class="keyword">return</span> attr &amp;&amp; attr.getAttributeType ? attr.getAttributeType() : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_fire</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;调用字段的 fireOnChange&lt;/summary&gt;</span></span><br><span class="line">        <span class="keyword">var</span> attr = _getAttr();</span><br><span class="line">        attr &amp;&amp; attr.fireOnChange &amp;&amp; attr.fireOnChange();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_isDirty</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;检查界面上的字段的值是否发生改变了&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns type="Boolean"&gt;&lt;/returns&gt;</span></span><br><span class="line">        <span class="keyword">var</span> attr = _getAttr();</span><br><span class="line">        <span class="keyword">return</span> attr &amp;&amp; attr.getIsDirty ? attr.getIsDirty() : Xrm.Page.data.entity.getIsDirty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_submitMode</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;设定或者获取属性的SubmitMode&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="v"&gt;&lt;/param&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns type=""&gt;&lt;/returns&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (_isNullOrEmpty(v)) &#123;</span><br><span class="line">            <span class="keyword">var</span> attr = _getAttr();</span><br><span class="line">            <span class="keyword">return</span> attr &amp;&amp; attr.getSubmitMode ? attr.getSubmitMode() : <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            _eachAttr(<span class="function"><span class="keyword">function</span> (<span class="params">attribute</span>) </span>&#123;</span><br><span class="line">                attribute &amp;&amp; attribute.setSubmitMode &amp;&amp; attribute.setSubmitMode(v);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_disabled</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;设定或获取UI控件是否禁用&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="v"&gt;&lt;/param&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns type=""&gt;&lt;/returns&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (_isNull(v)) &#123;</span><br><span class="line">            <span class="keyword">var</span> obj = _get();</span><br><span class="line">            <span class="keyword">return</span> obj &amp;&amp; obj.getDisabled ? obj.getDisabled() : <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            _each(<span class="function"><span class="keyword">function</span> (<span class="params">ui</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> controlType = ui.getControlType();</span><br><span class="line">                <span class="keyword">if</span> (controlType != <span class="string">"iframe"</span> &amp;&amp; controlType != <span class="string">"webresource"</span> &amp;&amp; controlType != <span class="string">"subgrid"</span> &amp;&amp; controlType != <span class="string">"searchwidget"</span> &amp;&amp; controlType != <span class="string">"kbsearch"</span>)</span><br><span class="line">                    ui &amp;&amp; ui.setDisabled &amp;&amp; ui.setDisabled(v);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_visible</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;设定或获取UI控件是否可视&lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="v"&gt;&lt;/param&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns type=""&gt;&lt;/returns&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (_isNull(v)) &#123;</span><br><span class="line">            <span class="keyword">var</span> obj = _get();</span><br><span class="line">            <span class="keyword">return</span> obj &amp;&amp; obj.getVisible ? obj.getVisible() : <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            _each(<span class="function"><span class="keyword">function</span> (<span class="params">ui</span>) </span>&#123;</span><br><span class="line">                ui &amp;&amp; ui.setVisible &amp;&amp; ui.setVisible(v);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_hide</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// 隐藏界面UI控件</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        _visible(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">///显示字段或其他的UI控件</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        _visible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_focus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">///设定控件获取输入焦点</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        <span class="keyword">var</span> obj = _get();</span><br><span class="line">        obj &amp;&amp; obj.setFocus &amp;&amp; obj.setFocus();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="keyword">get</span>: _get,</span><br><span class="line">        getAttr: _getAttr,</span><br><span class="line">        val: _val,</span><br><span class="line">        text: _text,</span><br><span class="line">        req: _req,</span><br><span class="line">        focus: _focus,</span><br><span class="line">        each: _each,</span><br><span class="line">        eachAttr: _eachAttr,</span><br><span class="line">        length: _length,</span><br><span class="line">        attrType: _attrType,</span><br><span class="line">        fire: _fire,</span><br><span class="line">        isDirty: _isDirty,</span><br><span class="line">        submitMode: _submitMode,</span><br><span class="line">        disabled: _disabled,</span><br><span class="line">        visible: _visible,</span><br><span class="line">        hide: _hide,</span><br><span class="line">        show: _show</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h1><h2 id="val"><a href="#val" class="headerlink" title="val()"></a>val()</h2><blockquote>
<p>rtcrm(“#new_name”).val();<br>获取new_name字段的值</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//找到表单上一个对象,_gets()、_get()方法</span></span><br><span class="line">Xrm.Page.ui.controls.get(<span class="string">"new_account_id"</span>);</span><br><span class="line"><span class="comment">//获取属性,_getAttr()方法</span></span><br><span class="line">Xrm.Page.ui.controls.get(<span class="string">"new_account_id"</span>).getAttribute();</span><br><span class="line"><span class="comment">//获取值,_val(v)方法</span></span><br><span class="line">Xrm.Page.ui.controls.get(<span class="string">"new_account_id"</span>).getAttribute().getValue();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>便捷的写法</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//直接获取字段</span></span><br><span class="line">Xrm.Page.getAttribute(<span class="string">"new_account_id"</span>).getValue()</span><br></pre></td></tr></table></figure>

<h2 id="getEntityId"><a href="#getEntityId" class="headerlink" title="getEntityId()"></a>getEntityId()</h2><blockquote>
<p>rtcrm.getEntityId(); “{30FEBF82-0440-EB11-8AC1-005056AF9937}”<br>Xrm.Page.data.entity.getId()</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var new_srv_superviseid &#x3D; window.parent.Xrm.Page.data.entity.getId().replace(&quot;&#123;&quot;,&quot;&quot;).replace(&quot;&#125;&quot;,&quot;&quot;);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>瑞泰框架</tag>
        <tag>rtcrm.js</tag>
      </tags>
  </entry>
  <entry>
    <title>成品资源报表</title>
    <url>/2020/11/18/%E6%88%90%E5%93%81%E8%B5%84%E6%BA%90%E6%8A%A5%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="从字符串中提取数字、字母、中文"><a href="#从字符串中提取数字、字母、中文" class="headerlink" title="从字符串中提取数字、字母、中文"></a>从字符串中提取数字、字母、中文</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*方法一: 一个一个找出来*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> [dbo].[Fun_GetNumPart] </span><br><span class="line">( @<span class="keyword">Str</span> <span class="keyword">NVARCHAR</span>(<span class="keyword">MAX</span>) )</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">NVARCHAR</span>(<span class="keyword">MAX</span>)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> @<span class="keyword">Start</span> <span class="built_in">INT</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> @<span class="keyword">End</span> <span class="built_in">INT</span>; </span><br><span class="line">        <span class="keyword">DECLARE</span> @Part <span class="keyword">NVARCHAR</span>(<span class="keyword">MAX</span>)</span><br><span class="line">        <span class="keyword">SET</span> @<span class="keyword">Start</span> = <span class="keyword">PATINDEX</span>(<span class="string">'%[0-9]%'</span>, @<span class="keyword">Str</span>);</span><br><span class="line">        <span class="keyword">SET</span> @<span class="keyword">End</span> = <span class="keyword">PATINDEX</span>(<span class="string">'%[0-9]%'</span>,<span class="keyword">SUBSTRING</span>(@<span class="keyword">Str</span>, @<span class="keyword">Start</span>+<span class="number">1</span>,<span class="keyword">LEN</span>(@<span class="keyword">Str</span>) - @<span class="keyword">Start</span>));</span><br><span class="line">        <span class="keyword">SET</span> @Part = <span class="keyword">SUBSTRING</span>(@<span class="keyword">Str</span>,@<span class="keyword">Start</span>,<span class="number">1</span>) </span><br><span class="line">        <span class="keyword">WHILE</span>  @<span class="keyword">End</span> &gt;<span class="number">0</span> </span><br><span class="line">        <span class="keyword">BEGIN</span> </span><br><span class="line">                <span class="keyword">SET</span> @<span class="keyword">Start</span> = @<span class="keyword">start</span>+@<span class="keyword">End</span></span><br><span class="line">                <span class="keyword">SET</span> @Part = @Part+<span class="keyword">SUBSTRING</span>(@<span class="keyword">Str</span>,@<span class="keyword">Start</span>,<span class="number">1</span>)       </span><br><span class="line">                <span class="keyword">SET</span> @<span class="keyword">End</span> = <span class="keyword">PATINDEX</span>(<span class="string">'%[0-9]%'</span>,<span class="keyword">SUBSTRING</span>(@<span class="keyword">Str</span>, @<span class="keyword">Start</span>+<span class="number">1</span>,<span class="keyword">LEN</span>(@<span class="keyword">Str</span>) - @<span class="keyword">Start</span>)); </span><br><span class="line">        <span class="keyword">END</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">RETURN</span>  @Part;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/*方法二：一个一个去掉*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> [dbo].[Fun_GetNumPart]  </span><br><span class="line">( @<span class="keyword">Str</span> <span class="keyword">NVARCHAR</span>(<span class="keyword">MAX</span>) ) </span><br><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">NVARCHAR</span>(<span class="keyword">MAX</span>)   </span><br><span class="line"><span class="keyword">AS</span>   </span><br><span class="line"><span class="keyword">BEGIN</span>   </span><br><span class="line">    <span class="keyword">WHILE</span> <span class="keyword">PATINDEX</span>(<span class="string">'%[^0-9]%'</span>,@<span class="keyword">Str</span>)&gt;<span class="number">0</span>   </span><br><span class="line">    <span class="keyword">BEGIN</span>   </span><br><span class="line">        <span class="keyword">SET</span> @<span class="keyword">Str</span>=<span class="keyword">STUFF</span>(@<span class="keyword">Str</span>,<span class="keyword">PATINDEX</span>(<span class="string">'%[^0-9]%'</span>,@<span class="keyword">Str</span>),<span class="number">1</span>,<span class="string">''</span>) <span class="comment">--删掉非数字的字符</span></span><br><span class="line">    <span class="keyword">END</span>   </span><br><span class="line">    <span class="keyword">RETURN</span> @<span class="keyword">Str</span> </span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--可以通过将函数中的 ‘%[0-9]%’ 替换成 ‘%[A-Z]%’、’%[吖-做]%’，，改造成找字母、找中文的函数</span></span><br></pre></td></tr></table></figure>
<h2 id="Convert函数"><a href="#Convert函数" class="headerlink" title="Convert函数"></a>Convert函数</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">CONVERT(data_type(length),data_to_be_converted,style)</span><br><span class="line">eg:</span><br><span class="line">CONVERT(int,dbo.Fun_GetNumPart(right(new_vinidname,8))) AS sort_vin,</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>vsReport</tag>
        <tag>成品资源</tag>
      </tags>
  </entry>
  <entry>
    <title>报表翻页保留静态标题</title>
    <url>/2020/11/12/%E6%8A%A5%E8%A1%A8%E7%BF%BB%E9%A1%B5%E4%BF%9D%E7%95%99%E9%9D%99%E6%80%81%E6%A0%87%E9%A2%98/</url>
    <content><![CDATA[<ol>
<li>搜索栏搜索属性或f4打开属性面板</li>
<li>点击行组中的静态</li>
<li>将RepeatOnNewPage置为true</li>
</ol>
<p><img src="1.jpg" alt=""></p>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>vsReport</tag>
      </tags>
  </entry>
  <entry>
    <title>发货通知单导入按钮</title>
    <url>/2020/11/23/%E5%8F%91%E8%B4%A7%E9%80%9A%E7%9F%A5%E5%8D%95%E5%AF%BC%E5%85%A5%E6%8C%89%E9%92%AE/</url>
    <content><![CDATA[<h2 id="导入字段整理"><a href="#导入字段整理" class="headerlink" title="导入字段整理"></a>导入字段整理</h2><ol>
<li>单号    new_name</li>
<li>负责人 ownerid 负责人当前账户</li>
<li>所属组织 new_organisation_id 徐工重型</li>
<li>实际单台金额 new_contractmoney</li>
<li>销售代表处 new_office_id</li>
<li>单据状态 new_documentstatus 已确认</li>
<li>发车类型 new_saletype TS发车</li>
<li>整机编号 new_userprofile_id 整机编号 客户 –取可用</li>
<li>物料编码 new_productcode    </li>
<li>客户名称/售达方名称 new_account_id (客户名称/最终客户: 有编码优先编码查然后按名字 有一个必须有值)</li>
<li>最终客户    new_finalaccount_id</li>
<li>客户sap编码/售达方sap编码 new_accountno</li>
<li>最终客户SAP编码 new_finalaccountcode</li>
<li>付款条件 new_ord_payment_id<h2 id="导入成功后生成回款计划明细字段整理"><a href="#导入成功后生成回款计划明细字段整理" class="headerlink" title="导入成功后生成回款计划明细字段整理"></a>导入成功后生成回款计划明细字段整理</h2></li>
<li>发货通知单 new_ord_shipment_id</li>
<li>项次 new_seq</li>
<li>计划回款日期 new_plandate</li>
<li>计划回款金额 new_planmoney</li>
<li>实际已回金额 new_actualmoney<h2 id="备忘"><a href="#备忘" class="headerlink" title="备忘"></a>备忘</h2><h3 id="objecttypecode"><a href="#objecttypecode" class="headerlink" title="objecttypecode"></a>objecttypecode</h3><blockquote>
<p>StringMap表中objecttypecode字段<br>组织服务查询出的objecttypecode实际为entityName<br>sql查询出的是数字代码</p>
</blockquote>
</li>
</ol>
<p><img src="1.jpg" alt=""><br><img src="2.jpg" alt=""></p>
<h3 id="CreateRequest"><a href="#CreateRequest" class="headerlink" title="CreateRequest"></a>CreateRequest</h3><blockquote>
<p>创建实体<br>另一种方法是IOrganizationService.Create(Entity entity)<br>事物的执行条数受限制 最大1000条<br><a href="https://docs.microsoft.com/zh-tw/powerapps/developer/common-data-service/org-service/execute-multiple-requests" target="_blank" rel="noopener"></a></p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 摘要:</span></span><br><span class="line"><span class="comment">//     Contains the data that is needed to create a record.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 言论：</span></span><br><span class="line"><span class="comment">//     Message Availability</span></span><br><span class="line"><span class="comment">//     Not all entity types support this message offline. For some supported entities,</span></span><br><span class="line"><span class="comment">//     this message works regardless whether the caller is connected to the server or</span></span><br><span class="line"><span class="comment">//     offline. For other entities, the caller must be connected to the server before</span></span><br><span class="line"><span class="comment">//     the message works. For more information, see Supported Entities later in this</span></span><br><span class="line"><span class="comment">//     topic.</span></span><br><span class="line"><span class="comment">//     Usage</span></span><br><span class="line"><span class="comment">//     Pass an instance of this class to the Microsoft.Xrm.Sdk.IOrganizationService.Execute(Microsoft.Xrm.Sdk.OrganizationRequest)</span></span><br><span class="line"><span class="comment">//     method, which returns an instance of the Microsoft.Xrm.Sdk.Messages.CreateResponse</span></span><br><span class="line"><span class="comment">//     class.</span></span><br><span class="line"><span class="comment">//     This message supports one or more optional parameters. For more information,</span></span><br><span class="line"><span class="comment">//     see Use messages (request and response classes) with the Execute method.</span></span><br><span class="line"><span class="comment">//     Privileges and Access Rights</span></span><br><span class="line"><span class="comment">//     To perform this action, the caller must have privileges on the specified entity</span></span><br><span class="line"><span class="comment">//     in the entity parameter. For a list of the required privileges, see Create message</span></span><br><span class="line"><span class="comment">//     privileges.</span></span><br><span class="line"><span class="comment">//     Notes for Callers</span></span><br><span class="line"><span class="comment">//     This message creates a record with related records in one transaction. For a</span></span><br><span class="line"><span class="comment">//     less complex method that creates a single record, use the Microsoft.Xrm.Sdk.IOrganizationService.Create(Microsoft.Xrm.Sdk.Entity)</span></span><br><span class="line"><span class="comment">//     method.</span></span><br><span class="line"><span class="comment">//     By default, the caller becomes the owner for the new record. For this message</span></span><br><span class="line"><span class="comment">//     to work, the caller must have both Create and Read privileges for the entity.</span></span><br><span class="line"><span class="comment">//     For more information, see Privileges by entity. Or you can set the ownerid attribute</span></span><br><span class="line"><span class="comment">//     for the record to the ID of another user.</span></span><br><span class="line"><span class="comment">//     Supported Entities</span></span><br><span class="line"><span class="comment">//     You can use this method to create any record of an entity (includes custom entities)</span></span><br><span class="line"><span class="comment">//     that supports the Microsoft.Xrm.Sdk.Messages.CreateRequest message.</span></span><br><span class="line"><span class="comment">//     The following table shows the default entities that support this message. For</span></span><br><span class="line"><span class="comment">//     the listed entities of this message, the Availability column shows Server if</span></span><br><span class="line"><span class="comment">//     the caller must be connected to the server and shows Both if the caller can be</span></span><br><span class="line"><span class="comment">//     either connected to, or disconnected from, the server.</span></span><br><span class="line">[<span class="meta">DataContract(Namespace = <span class="meta-string">"http://schemas.microsoft.com/xrm/2011/Contracts"</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">CreateRequest</span> : <span class="title">OrganizationRequest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 摘要:</span></span><br><span class="line">    <span class="comment">//     Initializes a new instance of the Microsoft.Xrm.Sdk.Messages.CreateRequest class.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CreateRequest</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 摘要:</span></span><br><span class="line">    <span class="comment">//     Gets or sets an instance of an entity that you can use to create a new record.</span></span><br><span class="line">    <span class="comment">//     Required.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 返回结果:</span></span><br><span class="line">    <span class="comment">//     Type: Microsoft.Xrm.Sdk.Entity The entity instance.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 言论：</span></span><br><span class="line">    <span class="comment">//     The specified target record must contain values for all the attributes where</span></span><br><span class="line">    <span class="comment">//     the Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.RequiredLevel is set to Microsoft.Xrm.Sdk.Metadata.AttributeRequiredLevel.SystemRequired.</span></span><br><span class="line">    <span class="comment">//     You can see the required level value for each entity in the Entity Metadata topic</span></span><br><span class="line">    <span class="comment">//     for the entity. If the entity instance includes properties where Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.IsValidForCreate</span></span><br><span class="line">    <span class="comment">//     is false, the values are ignored. You can find this information in the metadata</span></span><br><span class="line">    <span class="comment">//     for your organization. See the preceding metadata browser information.</span></span><br><span class="line">    <span class="keyword">public</span> Entity Target &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义导入"><a href="#自定义导入" class="headerlink" title="自定义导入"></a>自定义导入</h3><ol>
<li>RekTec.Crm.Workflow.Import中创建类并继承ImportBase</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">namespace RekTec.Crm.Workflow.Import</span><br><span class="line">&#123;</span><br><span class="line">    public class ImportNewOrdShipment : ImportBase</span><br><span class="line">    &#123;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>生成并上传</li>
<li>创建新流程<ul>
<li>添加流程参数<ul>
<li><img src="a.jpg" alt=""></li>
<li>ParentEntityId 字符串 可选 输入</li>
<li>ParentEntityName 字符串 可选 输入</li>
<li>ImportLogId 字符串 必需 输入</li>
<li>Message 字符串 可选 输出</li>
</ul>
</li>
<li>添加步骤<ul>
<li><img src="b.jpg" alt=""></li>
<li><img src="c.jpg" alt=""></li>
</ul>
</li>
<li>分派值<ul>
<li><img src="d.jpg" alt=""></li>
<li>选择导入类型</li>
</ul>
</li>
</ul>
</li>
<li>在数据导入中新建记录<ul>
<li>实体名称填写要导入的实体</li>
<li>导入动作选择刚刚新建的流程</li>
<li>保存后将模板上传至导入模板</li>
</ul>
</li>
<li>使用VisualRibbonEditor在系统中添加按钮<ul>
<li>Action中选择$webresource:new_/js/rtcrm.min.js文件中的rtcrm.showImportWindow方法</li>
</ul>
</li>
</ol>
<h3 id="rtcrm-showImportWindow"><a href="#rtcrm-showImportWindow" class="headerlink" title="rtcrm.showImportWindow"></a>rtcrm.showImportWindow</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">showImportWindow: <span class="function"><span class="keyword">function</span> (<span class="params">entityName</span>) </span>&#123;</span><br><span class="line">    <span class="comment">///	&lt;summary&gt;弹出导入数据对话框&lt;/summary&gt;</span></span><br><span class="line">    <span class="comment">///	&lt;param name="entityName" type="String"&gt;实体名称&lt;/param&gt;</span></span><br><span class="line">    <span class="keyword">if</span> (RekTec.common.isNullOrWhiteSpace(entityName)) &#123;</span><br><span class="line">        Xrm.Utility.alertDialog(<span class="string">"entityName is not defined"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> paramList = <span class="string">"entityName="</span> + entityName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Xrm &amp;&amp; Xrm.Page &amp;&amp; Xrm.Page.data &amp;&amp; Xrm.Page.data.entity &amp;&amp; Xrm.Page.data.entity.getId) &#123;</span><br><span class="line">        <span class="keyword">var</span> parentEntityName = Xrm.Page.data.entity.getEntityName();</span><br><span class="line">        <span class="keyword">var</span> parentEntityId = Xrm.Page.data.entity.getId();</span><br><span class="line"></span><br><span class="line">        paramList += <span class="string">"&amp;parentEntityName="</span> + parentEntityName + <span class="string">"&amp;parentEntityId="</span> + parentEntityId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> url = RekTec.crmData.getClientUrl() + <span class="string">"/WebResources/new_/datamanagement/Import.html?Data="</span> + <span class="built_in">encodeURIComponent</span>(paramList);</span><br><span class="line"></span><br><span class="line">    RekTec.common.showWindow(url, &#123;</span><br><span class="line">        width: <span class="number">680</span>,</span><br><span class="line">        height: <span class="number">620</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>销售</tag>
        <tag>excel导入</tag>
      </tags>
  </entry>
  <entry>
    <title>成品车出库自动同步送车记录</title>
    <url>/2020/12/06/%E6%88%90%E5%93%81%E8%BD%A6%E5%87%BA%E5%BA%93%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5%E9%80%81%E8%BD%A6%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="场景及说明"><a href="#场景及说明" class="headerlink" title="场景及说明"></a>场景及说明</h2><blockquote>
<p>送车记录维护目前是手工新建送车记录，为了更好的及时做到送车记录回传需要变更为根据成品车出库自动同步送车记录，后续根据实际送车需要再去维护相应的送车记录。自动同步送车记录的逻辑与随车物品发放记录自动同步类似。<br>成品车出库制单状态的单据点击确认按钮时同步更新送车记录维护<br>hiddenapi中入参为成品车出库id   workflow VinShipOutCommand Confirm方法<br>根据发货通知单号带出相关字段</p>
</blockquote>
<h2 id="实体信息"><a href="#实体信息" class="headerlink" title="实体信息"></a>实体信息</h2><h3 id="成品车出库"><a href="#成品车出库" class="headerlink" title="成品车出库"></a>成品车出库</h3><blockquote>
<p>new_vin_shipout</p>
</blockquote>
<ol>
<li>new_vin_shipoutid 主键</li>
</ol>
<h3 id="送车记录"><a href="#送车记录" class="headerlink" title="送车记录"></a>送车记录</h3><blockquote>
<p>new_vin_sendtruckmaintain</p>
</blockquote>
<ol>
<li>new_vin_sendtruckmaintainid 主键</li>
<li>new_sender 送车人</li>
<li>new_address 送车地点</li>
<li>new_shiptype 提货方式</li>
<li>new_producttypeid 产品组</li>
<li>new_shipnoticeid 提单号</li>
<li>new_productid 物料描述</li>
<li>new_vinmodelid 产品型号</li>
<li>new_productcode 物料编码</li>
<li>new_vinid 车辆vin码</li>
<li>new_contractid 合同号</li>
<li>new_new_saledepart 代表处</li>
<li>new_accountid 购车单位</li>
<li>new_senddate 送车日期</li>
</ol>
<h2 id="送车记录可用方法-VinSendTruckMainTainCommand"><a href="#送车记录可用方法-VinSendTruckMainTainCommand" class="headerlink" title="送车记录可用方法  VinSendTruckMainTainCommand"></a>送车记录可用方法  VinSendTruckMainTainCommand</h2><ol>
<li>VinSendTruckMainTainInfo GetInfoByVin(string vinid) 根据vin码获取信息</li>
<li>VinSendTruckMainTainInfo GetInfoByShipment(string shipmentid) 根据发货通知单号获取信息</li>
</ol>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">region</span> 同步创建送车记录维护</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//调用VinSendTruckMainTainCommand中GetInfoByVin获取送车记录维护字段信息</span></span><br><span class="line">VinSendTruckMainTainInfo vinSendTruckMainTainInfo = Command&lt;VinSendTruckMainTainCommand&gt;().GetInfoByVin(vinId);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建实体</span></span><br><span class="line"><span class="keyword">var</span> new_vin_sendtruckmaintain = <span class="keyword">new</span> Entity(<span class="string">"new_vin_sendtruckmaintain"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//送车人（发运人实体）</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_shipperid))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_sender"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"new_vin_shipper"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_shipperid));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//送车地点</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_shipplace))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_address"</span>] = vinSendTruckMainTainInfo.new_shipplace;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提货方式</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_shiptype))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_shiptype"</span>] = vinSendTruckMainTainInfo.new_shiptype;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//产品组</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_producttypeid))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_producttypeid"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"new_productgroup"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_producttypeid));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提单号(发货通知单)</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_shipnoticeid))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_shipnoticeid"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"new_ord_shipment"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_shipnoticeid));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//物料描述(产品物料)</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_productid))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_productid"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"product"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_productid));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//产品型号（成品车型号）</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_vinmodelid))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_vinmodelid"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"new_vin_productmodel"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_vinmodelid));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//物料编码</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_productcode))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_productcode"</span>] = vinSendTruckMainTainInfo.new_productcode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//车辆vin码（产品档案）</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_vinid))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_vinid"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"new_srv_userprofile"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_vinid));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//合同号(合同申请单)</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_contract))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_contractid"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"new_contract"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_contract));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//代表处(业务部门)</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_salebu))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_new_saledepart"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"businessunit"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_salebu));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//购车单位</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(vinSendTruckMainTainInfo.new_enduser))</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_accountid"</span>] = <span class="keyword">new</span> EntityReference(<span class="string">"account"</span>, <span class="keyword">new</span> Guid(vinSendTruckMainTainInfo.new_enduser));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//送车日期</span></span><br><span class="line"><span class="keyword">if</span> (vinSendTruckMainTainInfo.new_shipdate != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    new_vin_sendtruckmaintain[<span class="string">"new_senddate"</span>] = vinSendTruckMainTainInfo.new_shipdate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">OrganizationService.Create(new_vin_sendtruckmaintain);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endregion</span></span></span><br></pre></td></tr></table></figure>


<h3 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h3><blockquote>
<p>发货通知单查询增加校验 new_documentstatus 1 未确认 2 已确认 3 已作废</p>
</blockquote>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>成品资源</tag>
      </tags>
  </entry>
  <entry>
    <title>数据导出跟踪</title>
    <url>/2020/11/28/%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA%E8%B7%9F%E8%B8%AA/</url>
    <content><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><blockquote>
<p>导出实体时对导出操作进行记录跟踪<br>公用plugin</p>
</blockquote>
<h2 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h2><p><img src="1.jpg" alt=""><br><img src="2.jpg" alt=""></p>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>系统安全</tag>
      </tags>
  </entry>
  <entry>
    <title>瑞泰移动平台</title>
    <url>/2020/12/22/%E7%91%9E%E6%B3%B0%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%8F%B0/</url>
    <content><![CDATA[<h2 id="vue-xmobile"><a href="#vue-xmobile" class="headerlink" title="vue-xmobile"></a>vue-xmobile</h2><blockquote>
<p>瑞泰移动平台<br><a href="http://nrm.recloud.com.cn:8081/repository/npm-hosted/" target="_blank" rel="noopener">http://nrm.recloud.com.cn:8081/repository/npm-hosted/</a></p>
</blockquote>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>yarn install vue-xmobile </p>
<h2 id="常用组件"><a href="#常用组件" class="headerlink" title="常用组件"></a>常用组件</h2>]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>钉钉</tag>
        <tag>vue组件</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库JOIN</title>
    <url>/2020/10/21/%E6%95%B0%E6%8D%AE%E5%BA%93JOIN/</url>
    <content><![CDATA[<h1 id="JOIN关键字"><a href="#JOIN关键字" class="headerlink" title="JOIN关键字"></a>JOIN关键字</h1><pre><code class="sql"><span class="keyword">SELECT</span> <span class="keyword">column</span>
<span class="keyword">FROM</span> join_table
JOIN_TYPE join_table
<span class="keyword">ON</span> (join_condition)</code></pre>
<ol>
<li>join_table指参与连接操作的表名</li>
<li>column指查询的列</li>
<li>JOIN_TYPE 指连接类型 </li>
</ol>
<h1 id="INNER-JOIN，内连接（等同连接）"><a href="#INNER-JOIN，内连接（等同连接）" class="headerlink" title="INNER JOIN，内连接（等同连接）"></a>INNER JOIN，内连接（等同连接）</h1><blockquote>
<p><strong>返回结果集只返回满足ON字句中的搜索条件的数据，不满足则不显示。默认情况下，DBMS会将JOIN也认定为INNER JOIN</strong></p>
</blockquote>
<p><strong>表R</strong> </p>
<table>
<thead>
<tr>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a1</td>
<td align="left">b1</td>
<td align="left">c1</td>
</tr>
<tr>
<td align="left">a2</td>
<td align="left">b2</td>
<td align="left">c2</td>
</tr>
<tr>
<td align="left">a3</td>
<td align="left">b3</td>
<td align="left">c3</td>
</tr>
</tbody></table>
<p><strong>表S</strong> </p>
<table>
<thead>
<tr>
<th align="left">C</th>
<th align="left">D</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c1</td>
<td align="left">d1</td>
</tr>
<tr>
<td align="left">c2</td>
<td align="left">d2</td>
</tr>
<tr>
<td align="left">c4</td>
<td align="left">d3</td>
</tr>
</tbody></table>
<p><strong>执行R INNER JOIN S ON R.C = S.C</strong></p>
<table>
<thead>
<tr>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
<th align="left">C</th>
<th align="left">D</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a1</td>
<td align="left">b1</td>
<td align="left">c1</td>
<td align="left">c1</td>
<td align="left">d1</td>
</tr>
<tr>
<td align="left">a2</td>
<td align="left">b2</td>
<td align="left">c2</td>
<td align="left">c2</td>
<td align="left">d2</td>
</tr>
</tbody></table>
<p> <img src="1.jpg" alt="交集。"></p>
<h1 id="OUTER-JOIN，外连接"><a href="#OUTER-JOIN，外连接" class="headerlink" title="OUTER JOIN，外连接"></a>OUTER JOIN，外连接</h1><h2 id="LEFT-OUTER-JOIN-LEFT-JOIN-，左外连接"><a href="#LEFT-OUTER-JOIN-LEFT-JOIN-，左外连接" class="headerlink" title="LEFT OUTER JOIN(LEFT JOIN)，左外连接"></a>LEFT OUTER JOIN(LEFT JOIN)，左外连接</h2><blockquote>
<p><strong>结果集返回匹配行加上左表的不匹配行</strong> </p>
</blockquote>
<p><strong>表R</strong> </p>
<table>
<thead>
<tr>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a1</td>
<td align="left">b1</td>
<td align="left">c1</td>
</tr>
<tr>
<td align="left">a2</td>
<td align="left">b2</td>
<td align="left">c2</td>
</tr>
<tr>
<td align="left">a3</td>
<td align="left">b3</td>
<td align="left">c3</td>
</tr>
</tbody></table>
<p><strong>表S</strong> </p>
<table>
<thead>
<tr>
<th align="left">C</th>
<th align="left">D</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c1</td>
<td align="left">d1</td>
</tr>
<tr>
<td align="left">c2</td>
<td align="left">d2</td>
</tr>
<tr>
<td align="left">c4</td>
<td align="left">d3</td>
</tr>
</tbody></table>
<p><strong>执行R LEFT JOIN S ON R.C = S.C</strong></p>
<table>
<thead>
<tr>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
<th align="left">C</th>
<th align="left">D</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a1</td>
<td align="left">b1</td>
<td align="left">c1</td>
<td align="left">c1</td>
<td align="left">d1</td>
</tr>
<tr>
<td align="left">a2</td>
<td align="left">b2</td>
<td align="left">c2</td>
<td align="left">c2</td>
<td align="left">d2</td>
</tr>
<tr>
<td align="left">a3</td>
<td align="left">b3</td>
<td align="left">c3</td>
<td align="left">null</td>
<td align="left">null</td>
</tr>
</tbody></table>
<p><img src="4.jpg" alt="LEFT JOIN产生表1的完全集，而2表中匹配的则有值，没有匹配的则以null值取代。"></p>
<h2 id="RIGHT-OUTER-JOIN-RIGHT-JOIN-，右外连接"><a href="#RIGHT-OUTER-JOIN-RIGHT-JOIN-，右外连接" class="headerlink" title="RIGHT OUTER JOIN(RIGHT JOIN)，右外连接"></a>RIGHT OUTER JOIN(RIGHT JOIN)，右外连接</h2><blockquote>
<p><strong>结果集返回匹配行加上右表的不匹配行</strong></p>
</blockquote>
<p><strong>表R</strong> </p>
<table>
<thead>
<tr>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a1</td>
<td align="left">b1</td>
<td align="left">c1</td>
</tr>
<tr>
<td align="left">a2</td>
<td align="left">b2</td>
<td align="left">c2</td>
</tr>
<tr>
<td align="left">a3</td>
<td align="left">b3</td>
<td align="left">c3</td>
</tr>
</tbody></table>
<p><strong>表S</strong> </p>
<table>
<thead>
<tr>
<th align="left">C</th>
<th align="left">D</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c1</td>
<td align="left">d1</td>
</tr>
<tr>
<td align="left">c2</td>
<td align="left">d2</td>
</tr>
<tr>
<td align="left">c4</td>
<td align="left">d3</td>
</tr>
</tbody></table>
<p><strong>执行R RIGHT JOIN S ON R.C = S.C</strong></p>
<table>
<thead>
<tr>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
<th align="left">C</th>
<th align="left">D</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a1</td>
<td align="left">b1</td>
<td align="left">c1</td>
<td align="left">c1</td>
<td align="left">d1</td>
</tr>
<tr>
<td align="left">a2</td>
<td align="left">b2</td>
<td align="left">c2</td>
<td align="left">c2</td>
<td align="left">d2</td>
</tr>
<tr>
<td align="left">null</td>
<td align="left">null</td>
<td align="left">null</td>
<td align="left">c4</td>
<td align="left">d3</td>
</tr>
</tbody></table>
<p><img src="2.jpg" alt="RIGHT JOIN产生表2的完全集，而1表中匹配的则有值，没有匹配的则以null值取代。"></p>
<h2 id="FULL-OUTER-JOIN，全外连接"><a href="#FULL-OUTER-JOIN，全外连接" class="headerlink" title="FULL OUTER JOIN，全外连接"></a>FULL OUTER JOIN，全外连接</h2><blockquote>
<p><strong>结果集返回匹配行和左右表的不匹配行</strong> </p>
</blockquote>
<p><strong>表R</strong> </p>
<table>
<thead>
<tr>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a1</td>
<td align="left">b1</td>
<td align="left">c1</td>
</tr>
<tr>
<td align="left">a2</td>
<td align="left">b2</td>
<td align="left">c2</td>
</tr>
<tr>
<td align="left">a3</td>
<td align="left">b3</td>
<td align="left">c3</td>
</tr>
</tbody></table>
<p><strong>表S</strong> </p>
<table>
<thead>
<tr>
<th align="left">C</th>
<th align="left">D</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c1</td>
<td align="left">d1</td>
</tr>
<tr>
<td align="left">c2</td>
<td align="left">d2</td>
</tr>
<tr>
<td align="left">c4</td>
<td align="left">d3</td>
</tr>
</tbody></table>
<p><strong>执行R FULL JOIN S ON R.C = S.C</strong></p>
<table>
<thead>
<tr>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
<th align="left">C</th>
<th align="left">D</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a1</td>
<td align="left">b1</td>
<td align="left">c1</td>
<td align="left">c1</td>
<td align="left">d1</td>
</tr>
<tr>
<td align="left">a2</td>
<td align="left">b2</td>
<td align="left">c2</td>
<td align="left">c2</td>
<td align="left">d2</td>
</tr>
<tr>
<td align="left">a3</td>
<td align="left">b3</td>
<td align="left">c3</td>
<td align="left">null</td>
<td align="left">null</td>
</tr>
<tr>
<td align="left">null</td>
<td align="left">null</td>
<td align="left">null</td>
<td align="left">c4</td>
<td align="left">d3</td>
</tr>
</tbody></table>
<p><img src="3.jpg" alt="FULL OUTER JOIN产生1和2的并集。但是需要注意的是，对于没有匹配的记录，则会以null做为值。"></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>SQL语法</tag>
      </tags>
  </entry>
  <entry>
    <title>简单代码演示控制反转IOC和依赖注入DI</title>
    <url>/2020/04/26/%E7%AE%80%E5%8D%95%E7%9A%84%E7%94%A8%E4%BB%A3%E7%A0%81%E7%90%86%E8%A7%A3%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%ACIOC%E5%92%8C%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5DI/</url>
    <content><![CDATA[<h1 id="ioc（Inversion-of-Control）"><a href="#ioc（Inversion-of-Control）" class="headerlink" title="ioc（Inversion of Control）"></a>ioc（Inversion of Control）</h1><blockquote>
<p>控制反转，也可以称为依赖倒置，即当A要调用B时，A无需主动获取，会有人主动把B送过来供A使用，以减少在A的代码中存在B，导致模块间的高度耦合。</p>
</blockquote>
<h2 id="正常的代码控制流程"><a href="#正常的代码控制流程" class="headerlink" title="正常的代码控制流程"></a>正常的代码控制流程</h2><p>1.创建一个接口Car</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">go</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.定义两种车实现接口car</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Benz</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"benz go......"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMW</span> <span class="keyword">implements</span> <span class="title">Car</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"bmw go......"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.人要开车</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  Car car=<span class="keyword">new</span> Benz();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">DriveCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"begin drive"</span>);</span><br><span class="line">    car.go();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这种方式是我们常见的代码控制流程，人想要开车，需要自己实例化，且这个人只能开一种车。</li>
<li>如何让他可以想开什么车就开什么车呢？<blockquote>
<p>通过依赖注入</p>
</blockquote>
</li>
</ul>
<h2 id="依赖注入的方式DI（Dependency-Injection）"><a href="#依赖注入的方式DI（Dependency-Injection）" class="headerlink" title="依赖注入的方式DI（Dependency Injection）"></a>依赖注入的方式DI（Dependency Injection）</h2><ul>
<li>依赖注入是实现控制反转的方式之一。</li>
<li>看一下修改后的person类  </li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  Car car=<span class="keyword">null</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(Car car)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.car=car;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">driveCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"begin drive"</span>);</span><br><span class="line">    car.go();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>现在的Person类已经不自己实例化车的对象了，而是通过构造函数来获得车的对象，所以，这个类就可以开各种车了，只要这个车实现了Car接口就可以。看一下如何使用Person类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  Person person=<span class="keyword">new</span> Person(<span class="keyword">new</span> Benz());</span><br><span class="line">  person.driveCar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>现在的Person类可以开不止一种车，只要你通过构造函数传递进来。在这个例子中，Car对象就是Person类的依赖，当我们实例化Person类时，将一个Car的实例传递给Person类，就是依赖注入，我们的Person类从而实现了控制反转。<br>控制反转到底反转了什么？有种说法是这样的：所谓控制反转，反转的是获取对象依赖的过程。控制权反转后，获取依赖对象的过程由自身管理变为由IOC容器注入。</p>
</blockquote>
<h2 id="Spring实现依赖注入的方式"><a href="#Spring实现依赖注入的方式" class="headerlink" title="Spring实现依赖注入的方式"></a>Spring实现依赖注入的方式</h2><blockquote>
<p>在上面的这行代码中Person p=new Person(new Benz());，我们通过手动的方式new了一个Benz()的对象，然后将其注入到Person类中。而Spring不这么干，因为Spring觉得，你这行代码实例化了一个具体的Benz类，如果你以后想要在这里实例化一个BMW类的话，岂不是要修改代码？那我干脆写到配置文件里好了，即便你将来要该注意，至少不需要修改代码，于是就有了下面的配置</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"com.XXX.Benz"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.XXX.Person"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>从配置文件中获取Person类的对象时，car对象会被自动装配进来，而person对象不需要关心到底是哪个具体的类被传递进来了。所以，Spring作为一个IOC框架主要做了两步：创建对象和组装对象之间的关系。</p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>销售信息自定义页面</title>
    <url>/2020/11/09/%E9%94%80%E5%94%AE%E4%BF%A1%E6%81%AF%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="1-脉络整理"><a href="#1-脉络整理" class="headerlink" title="1. 脉络整理"></a>1. 脉络整理</h2><pre><code>- opportunity 销售信息
    - 取 new_account_id 字段
- new_delaymanagement 逾期催收管理
    - 取 new_account_id 字段
    - new_name 单号
    - new_overdate 逾期时间
    - new_delaytimes 逾期期数
    - new_overamount 逾期金额
    - new_overduetype 逾期分类
- new_srv_disputes 客户服务纠纷单
    - 取 new_account_id 字段
    - new_name 单号
    - new_requirements 用户要求
    - new_dealtype 处理类型
    - new_consensus 达成共识</code></pre><h2 id="2-hiddenApi"><a href="#2-hiddenApi" class="headerlink" title="2. hiddenApi"></a>2. hiddenApi</h2><pre><code>- 空工作流，plugin触发，plugin根据请求寻找对应controller
- broker ——&gt; Dapper</code></pre><h2 id="3-脚本"><a href="#3-脚本" class="headerlink" title="3. 脚本"></a>3. 脚本</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//徐庶 销售信息</span></span><br><span class="line">rtcrm(<span class="string">"#new_account_id"</span>).val()[<span class="number">0</span>].id.replace(<span class="string">"&#123;"</span>,<span class="string">""</span>).replace(<span class="string">"&#125;"</span>,<span class="string">""</span>);</span><br><span class="line"><span class="keyword">var</span> paramList = &#123;<span class="attr">accountId</span>:<span class="string">"F8B6B7CB-D3D6-EA11-8ABD-005056AF9937"</span>&#125;;</span><br><span class="line">rtcrm.invokeHiddenApi(<span class="string">"new_Sales"</span>, <span class="string">"Opportunity/GetDelaymanagementDetailList"</span>, paramList)</span><br><span class="line">rtcrm.invokeHiddenApi(<span class="string">"new_Sales"</span>, <span class="string">"Opportunity/GetDisputesDetailModelData"</span>, paramList)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//找到表单上一个对象</span></span><br><span class="line">Xrm.Page.ui.controls.get(<span class="string">"new_account_id"</span>);</span><br><span class="line"><span class="comment">//获取属性</span></span><br><span class="line">Xrm.Page.ui.controls.get(<span class="string">"new_account_id"</span>).getAttribute();</span><br><span class="line"><span class="comment">//获取值</span></span><br><span class="line">Xrm.Page.ui.controls.get(<span class="string">"new_account_id"</span>).getAttribute().getValue();</span><br><span class="line"><span class="comment">//直接获取字段</span></span><br><span class="line">Xrm.Page.getAttribute(<span class="string">"new_account_id"</span>).getValue()</span><br></pre></td></tr></table></figure>
<p><img src="1.jpg" alt=""><br><img src="2.jpg" alt=""></p>
<h2 id="4-sql语法"><a href="#4-sql语法" class="headerlink" title="4. sql语法"></a>4. sql语法</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Convert(decimal(18,2),new_overamount) new_overamount, <span class="comment">--保留小数位2位</span></span><br><span class="line"></span><br><span class="line">测试数据：</span><br><span class="line">销售信息 NOS202008050001 </span><br><span class="line">服务纠纷单 CSN202008130002</span><br><span class="line">逾期催收管理 BET202009290029</span><br><span class="line">new_account_id F8B6B7CB-D3D6-EA11-8ABD-005056AF9937</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>销售</tag>
      </tags>
  </entry>
  <entry>
    <title>督办单自定义页面</title>
    <url>/2020/12/12/%E7%9D%A3%E5%8A%9E%E5%8D%95%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><ol>
<li>取督办单下服务单号，根据服务单号查询对应的多条备件申请<blockquote>
<p>一条服务单对应多条督办单  一条服务单对应多条备件申请</p>
</blockquote>
</li>
<li>取督办单所关联的派工单号 new_dispatch_id（派工明细 new_srv_outsideline）下的其他督办单信息</li>
</ol>
<h2 id="备件申请单（new-srv-partsapply）"><a href="#备件申请单（new-srv-partsapply）" class="headerlink" title="备件申请单（new_srv_partsapply）"></a>备件申请单（new_srv_partsapply）</h2><ol start="0">
<li>主键 new_srv_partsapplyid</li>
<li>备件申请单 new_name</li>
<li>服务单 new_srv_workerorder_id</li>
<li>单据类型 new_ordertype</li>
<li>备件名称 new_product_id</li>
<li>备件编码 new_number</li>
<li>产品型号 new_productmodel</li>
<li>VIN码 new_srv_userprofile_id</li>
<li>申请数量 new_sum</li>
<li>发货仓库 new_stocksite_sendid</li>
<li>仓库编码 new_stockcode</li>
<li>旧件是否需返厂 new_isreturn</li>
<li>发运时间 new_shipmentdate</li>
<li>审核状态 new_approvalstatus</li>
<li>处理状态 new_despatch</li>
<li>创建时间 createdon</li>
</ol>
<h2 id="督办单（new-srv-supervise）"><a href="#督办单（new-srv-supervise）" class="headerlink" title="督办单（new_srv_supervise）"></a>督办单（new_srv_supervise）</h2><ol>
<li>主键 new_srv_superviseid</li>
<li>督办单号 new_name</li>
<li>服务单 new_workorder_id</li>
<li>派工时间 new_dispatchingtime</li>
<li>周期 new_period</li>
<li>整机vin码 new_srv_product_id</li>
<li>产品型号 new_productmodel_id</li>
<li>反馈内容 new_content</li>
<li>服务网点 new_site_id</li>
<li>服务人员 new_srv_worker_id</li>
<li>未完工原因 new_delayreason</li>
<li>督办是否属实 new_superviseyn</li>
<li>督办备注 new_note</li>
<li>督办类型 new_item</li>
</ol>
<h2 id="单号链接思路"><a href="#单号链接思路" class="headerlink" title="单号链接思路"></a>单号链接思路</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">v-on:click.stop.prevent</span>=<span class="string">"showDetailWindow(item.new_srv_superviseid)"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-cloak</span>=<span class="string">""</span>&gt;</span>&#123;&#123;item.new_name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">showDetailWindow: function (entityid) &#123;</span><br><span class="line">    var url &#x3D; rtcrm.getClientUrl() + &quot;&#x2F;main.aspx?etn&#x3D;&quot; + &#39;new_srv_supervise&#39; + &quot;&amp;id&#x3D;&quot; + entityid</span><br><span class="line">        + &quot;&amp;extraqs&#x3D;&amp;histKey&#x3D;&quot; + (Math.random() * 100000000).toFixed(0)</span><br><span class="line">        + &quot;&amp;newWindow&#x3D;true&amp;pagetype&#x3D;entityrecord&quot;;</span><br><span class="line">    rtcrm.showFullWindow(url);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="获取entityid"><a href="#获取entityid" class="headerlink" title="获取entityid"></a>获取entityid</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var new_srv_superviseid &#x3D; window.parent.Xrm.Page.data.entity.getId().replace(&quot;&#123;&quot;,&quot;&quot;).replace(&quot;&#125;&quot;,&quot;&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="请求hiddenApi"><a href="#请求hiddenApi" class="headerlink" title="请求hiddenApi"></a>请求hiddenApi</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">              <span class="keyword">var</span> paramList = &#123;</span><br><span class="line">                  new_dispatch_id: <span class="string">"E0238A5F-8B30-EB11-8AC1-005056AF287C"</span>,</span><br><span class="line">new_srv_superviseid:<span class="string">"4FE9371F-7A3F-EB11-8AC2-005056AF287C"</span></span><br><span class="line">              &#125;;</span><br><span class="line">             rtcrm.invokeHiddenApi(<span class="string">"new_service"</span>, <span class="string">"Supervise/GetNewSrvSuperviseData"</span>, paramList);</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>自定义页面</tag>
      </tags>
  </entry>
  <entry>
    <title>聚合函数</title>
    <url>/2020/10/29/%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h1 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h1><blockquote>
<p>聚合函数是对列中的一系列数据进行处理，返回单个统计值</p>
</blockquote>
<h2 id="SUM"><a href="#SUM" class="headerlink" title="SUM()"></a>SUM()</h2><blockquote>
<p>获取单个列的合计值</p>
</blockquote>
<h2 id="MAX"><a href="#MAX" class="headerlink" title="MAX()"></a>MAX()</h2><blockquote>
<p>计算列的最大值</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">Name</span>,</span><br><span class="line">new_age</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line"><span class="keyword">Account</span></span><br><span class="line"><span class="keyword">WHERE</span> new_age = (<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(new_age) <span class="keyword">FROM</span> <span class="keyword">Account</span>)</span><br></pre></td></tr></table></figure>
<h2 id="MIN"><a href="#MIN" class="headerlink" title="MIN()"></a>MIN()</h2><blockquote>
<p>计算列的最小值</p>
</blockquote>
<h2 id="AVG"><a href="#AVG" class="headerlink" title="AVG()"></a>AVG()</h2><blockquote>
<p>计算某个列的平均值,忽略NULL值</p>
</blockquote>
<h2 id="COUNT"><a href="#COUNT" class="headerlink" title="COUNT()"></a>COUNT()</h2><blockquote>
<p>统计行数量<br>COUNT(*)计算表中的总行数（包括null）<br>COUNT(column)计算column列的行数（不计算null行）</p>
</blockquote>
<h2 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h2><blockquote>
<p>根据字句后缀的列对数据进行分组(null值为一组)</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sex+<span class="string">'教师'</span> <span class="keyword">AS</span> teacher,<span class="keyword">AVG</span>(age) <span class="keyword">AS</span> avg_age</span><br><span class="line"><span class="keyword">FROM</span> t_teacher</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sex</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ROLLUP</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sex+<span class="string">'教师'</span> <span class="keyword">AS</span> teacher,<span class="keyword">AVG</span>(age) <span class="keyword">AS</span> avg_age</span><br><span class="line"><span class="keyword">FROM</span> t_teacher</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sex <span class="keyword">with</span> <span class="keyword">ROLLUP</span></span><br></pre></td></tr></table></figure>
<h2 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h2><blockquote>
<p>对group by分组后进行筛选</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sex+<span class="string">'教师'</span> <span class="keyword">AS</span> teacher,<span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_teacher</span><br><span class="line"><span class="keyword">FROM</span> t_teacher</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> teacher</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;=<span class="number">2</span></span><br><span class="line"><span class="comment">--显示男女教师分组中人数大于2的</span></span><br></pre></td></tr></table></figure>
<h2 id="重复值处理-DISTINCT"><a href="#重复值处理-DISTINCT" class="headerlink" title="重复值处理 DISTINCT"></a>重复值处理 DISTINCT</h2><blockquote>
<p>在聚合函数中，默认为ALL关键字，即不论是否有重复值，对所有数据进行处理<br>使用DISTINCT关键字后，则会进行非重值处理，即每个重复的值只取一次参与计算</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">Name</span>,</span><br><span class="line">new_age</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line"><span class="keyword">Account</span></span><br><span class="line"><span class="keyword">WHERE</span> new_age = (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(<span class="keyword">DISTINCT</span> new_age) <span class="keyword">FROM</span> <span class="keyword">Account</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>SQL语法</tag>
      </tags>
  </entry>
  <entry>
    <title>首次收到打赏</title>
    <url>/2020/09/30/%E9%A6%96%E6%AC%A1%E6%94%B6%E5%88%B0%E6%89%93%E8%B5%8F/</url>
    <content><![CDATA[<h1 id="收到了来自师傅的打赏"><a href="#收到了来自师傅的打赏" class="headerlink" title="收到了来自师傅的打赏"></a>收到了来自师傅的打赏</h1><h2 id="有师傅真是太好了！-●’◡’●"><a href="#有师傅真是太好了！-●’◡’●" class="headerlink" title="有师傅真是太好了！(●’◡’●)"></a>有师傅真是太好了！(●’◡’●)</h2><p><img src="1.jpg" alt=""><br><img src="2.jpg" alt=""></p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>心情</tag>
      </tags>
  </entry>
  <entry>
    <title>钉钉数据对接说明</title>
    <url>/2020/09/30/%E9%92%89%E9%92%89%E6%95%B0%E6%8D%AE%E5%AF%B9%E6%8E%A5%E8%AF%B4%E6%98%8E/</url>
    <content><![CDATA[<h1 id="API调用说明"><a href="#API调用说明" class="headerlink" title="API调用说明"></a>API调用说明</h1><blockquote>
<p>钉钉服务端api文档 <a href="https://ding-doc.dingtalk.com/doc#/serverapi2/gh60vz" target="_blank" rel="noopener">https://ding-doc.dingtalk.com/doc#/serverapi2/gh60vz</a><br>钉钉api调试工具 <a href="https://open-dev.dingtalk.com/apiExplorer#/?devType=org&amp;api=/get_jsapi_ticket" target="_blank" rel="noopener">https://open-dev.dingtalk.com/apiExplorer#/?devType=org&amp;api=/get_jsapi_ticket</a></p>
</blockquote>
<h2 id="部门"><a href="#部门" class="headerlink" title="部门"></a>部门</h2><h3 id="获取部门信息"><a href="#获取部门信息" class="headerlink" title="获取部门信息"></a>获取部门信息</h3><ol>
<li>获取部门ID列表<blockquote>
<p><a href="https://oapi.dingtalk.com/department/list?access_token=ACCESS_TOKEN" target="_blank" rel="noopener">https://oapi.dingtalk.com/department/list?access_token=ACCESS_TOKEN</a></p>
</blockquote>
</li>
<li>根据部门ID获取部门详情<blockquote>
<p><a href="https://oapi.dingtalk.com/department/get?access_token=ACCESS_TOKEN&amp;id=123" target="_blank" rel="noopener">https://oapi.dingtalk.com/department/get?access_token=ACCESS_TOKEN&amp;id=123</a></p>
</blockquote>
</li>
</ol>
<h4 id="关键字段说明"><a href="#关键字段说明" class="headerlink" title="关键字段说明"></a>关键字段说明</h4><ol>
<li>department_id <blockquote>
<p>部门id</p>
</blockquote>
</li>
<li>department_name <blockquote>
<p>部门名称</p>
</blockquote>
</li>
<li>department_parent_id <blockquote>
<p>父部门id，根部门为1</p>
</blockquote>
</li>
<li>department_status <blockquote>
<p>部门状态：(空值表示正常) 、CHANGED(改动过)、DELETED(部门取消)</p>
</blockquote>
</li>
</ol>
<h3 id="部门表"><a href="#部门表" class="headerlink" title="部门表"></a>部门表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ding_department (</span><br><span class="line">  department_id <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  department_name <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">  department_parent_id <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">  department_status <span class="built_in">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (department_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_department.department_id <span class="keyword">IS</span> <span class="string">'部门id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_department.department_name <span class="keyword">IS</span> <span class="string">'部门名称'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_department.department_parent_id <span class="keyword">IS</span> <span class="string">'上级部门id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_department.department_status <span class="keyword">IS</span> <span class="string">'可用状态'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="员工"><a href="#员工" class="headerlink" title="员工"></a>员工</h2><h3 id="员工信息"><a href="#员工信息" class="headerlink" title="员工信息"></a>员工信息</h3><ol>
<li>获取员工ID列表<blockquote>
<p><a href="https://oapi.dingtalk.com/topapi/smartwork/hrm/employee/queryonjob?access_token=ACCESS_TOKEN" target="_blank" rel="noopener">https://oapi.dingtalk.com/topapi/smartwork/hrm/employee/queryonjob?access_token=ACCESS_TOKEN</a><br>参数说明:<a href="https://ding-doc.dingtalk.com/doc#/serverapi2/rafx8t" target="_blank" rel="noopener">https://ding-doc.dingtalk.com/doc#/serverapi2/rafx8t</a></p>
</blockquote>
</li>
<li>根据ID获得员工信息<blockquote>
<p><a href="https://oapi.dingtalk.com/user/get?access_token=ACCESS_TOKEN&amp;userid=zhangsan" target="_blank" rel="noopener">https://oapi.dingtalk.com/user/get?access_token=ACCESS_TOKEN&amp;userid=zhangsan</a></p>
</blockquote>
</li>
</ol>
<h4 id="关键字段说明-1"><a href="#关键字段说明-1" class="headerlink" title="关键字段说明"></a>关键字段说明</h4><ol>
<li>employee_department_ids<blockquote>
<p>用户所在部门id列表，注意，是列表。</p>
</blockquote>
</li>
<li>employee_identity_card<blockquote>
<p>身份证号</p>
</blockquote>
</li>
<li>employee_status<blockquote>
<p>员工状态：可用，禁用</p>
</blockquote>
</li>
</ol>
<h3 id="员工表"><a href="#员工表" class="headerlink" title="员工表"></a>员工表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ding_employee (</span><br><span class="line">  employee_union_id <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">  employee_name <span class="built_in">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  employee_department_ids <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  employee_identity_card <span class="built_in">VARCHAR2</span>(<span class="number">64</span>),</span><br><span class="line">  employee_status <span class="built_in">VARCHAR2</span>(<span class="number">64</span>),</span><br><span class="line">  employee_user_id <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (employee_union_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_employee.employee_union_id <span class="keyword">IS</span> <span class="string">'员工unionid'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_employee.employee_name <span class="keyword">IS</span> <span class="string">'员工姓名'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_employee.employee_department_ids <span class="keyword">IS</span> <span class="string">'员工部门名称'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_employee.employee_identity_card <span class="keyword">IS</span> <span class="string">'员工身份证号码'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_employee.employee_status <span class="keyword">IS</span> <span class="string">'员工状态：可用，禁用'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_employee.employee_user_id <span class="keyword">IS</span> <span class="string">'员工id'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h2><h3 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h3><ol>
<li>获取流程模板process_code<blockquote>
<p>process_code流程模板唯一标识，可在OA管理后台编辑审批表单部分的url中获取<br><img src="1.jpg" alt=""><br><img src="2.jpg" alt=""><br><img src="3.jpg" alt=""></p>
</blockquote>
</li>
<li>根据process_code批量获取据当前时间120天之内的任意时间段审批实例ID列表<blockquote>
<p><a href="https://ding-doc.dingtalk.com/doc#/serverapi2/hh8lx5" target="_blank" rel="noopener">https://ding-doc.dingtalk.com/doc#/serverapi2/hh8lx5</a></p>
</blockquote>
</li>
<li>根据审批实例id获取审批实例详情<blockquote>
<p><a href="https://ding-doc.dingtalk.com/doc#/serverapi2/xgqkvx" target="_blank" rel="noopener">https://ding-doc.dingtalk.com/doc#/serverapi2/xgqkvx</a> </p>
</blockquote>
</li>
</ol>
<h3 id="关键字段说明-2"><a href="#关键字段说明-2" class="headerlink" title="关键字段说明"></a>关键字段说明</h3><ol>
<li>business_id<blockquote>
<p>审批实例业务编号 一条审批流虽然会因为更新或撤销等操作新建审批流实例，但business_id仍保留一致</p>
</blockquote>
</li>
<li>Attached_process_instance_ids<blockquote>
<p>审批附属实例列表，当已经通过的审批实例被修改或重置，会生成一个新的实例，作为继承审批实例的附属。如果想知道当前已经通过的审批实例的状态，可以依次遍历它的附属列表，查询里面每个实例的biz_action</p>
</blockquote>
</li>
<li>biz biz_action<blockquote>
<p>审批实例业务动作，MODIFY表示该审批实例是基于原来的实例修改而来的，REVOKE表示该审批实例对原来的实例进行撤销，NONE表示正常发起</p>
</blockquote>
</li>
<li>form_component_values<blockquote>
<p>表单详情列表,流程中表单数据的集合</p>
</blockquote>
</li>
<li>status<blockquote>
<p>审批状态，分为NEW（新创造）RUNNING（运行中）终止（被终止）完成（完成）</p>
</blockquote>
</li>
</ol>
<h3 id="重型员工请假流程表"><a href="#重型员工请假流程表" class="headerlink" title="重型员工请假流程表"></a>重型员工请假流程表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ding_leave_approval (</span><br><span class="line">  leave_id <span class="built_in">NUMBER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  leave_employee_user_id <span class="built_in">NUMBER</span>,</span><br><span class="line">  leave_start <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_end <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_duration <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_type <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_reason <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_title <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_result <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_status <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_business_id <span class="built_in">NUMBER</span>,</span><br><span class="line">  leave_attached_ids <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  leave_biz_action <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (leave_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_id <span class="keyword">IS</span> <span class="string">'请假id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_employee_user_id <span class="keyword">IS</span> <span class="string">'请假职员id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_start <span class="keyword">IS</span> <span class="string">'请假开始时间'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_end <span class="keyword">IS</span> <span class="string">'请假结束时间'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_duration <span class="keyword">IS</span> <span class="string">'请假时长'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_type <span class="keyword">IS</span> <span class="string">'请假类型'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_reason <span class="keyword">IS</span> <span class="string">'请假原因'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_title <span class="keyword">IS</span> <span class="string">'标题'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_result <span class="keyword">IS</span> <span class="string">'结果'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_status <span class="keyword">IS</span> <span class="string">'状态'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_business_id <span class="keyword">IS</span> <span class="string">'业务流程id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_attached_ids <span class="keyword">IS</span> <span class="string">'附属流程id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_leave_approval.leave_biz_action <span class="keyword">IS</span> <span class="string">'审批实例业务动作'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="考勤"><a href="#考勤" class="headerlink" title="考勤"></a>考勤</h2><ol>
<li>根据用户ID列表获取180天内的考勤结果，一次最多50条<blockquote>
<p><a href="https://oapi.dingtalk.com/attendance/list?access_token=ACCESS_TOKEN" target="_blank" rel="noopener">https://oapi.dingtalk.com/attendance/list?access_token=ACCESS_TOKEN</a></p>
</blockquote>
</li>
<li>参数说明:<blockquote>
<p><a href="https://ding-doc.dingtalk.com/doc#/serverapi2/ul33mm" target="_blank" rel="noopener">https://ding-doc.dingtalk.com/doc#/serverapi2/ul33mm</a></p>
</blockquote>
</li>
</ol>
<h3 id="关键字段说明-3"><a href="#关键字段说明-3" class="headerlink" title="关键字段说明"></a>关键字段说明</h3><ol>
<li>base_check_time<blockquote>
<p>打卡基准时间</p>
</blockquote>
</li>
<li>user_check_time<blockquote>
<p>员工实际打卡时间</p>
</blockquote>
</li>
<li>check_type<blockquote>
<p>打卡类型-上下班</p>
</blockquote>
</li>
<li>time_result<blockquote>
<p>打卡的时间结果</p>
</blockquote>
</li>
<li>locationResult<blockquote>
<p>位置结果(范围外/范围内)</p>
</blockquote>
</li>
</ol>
<h3 id="考勤表"><a href="#考勤表" class="headerlink" title="考勤表"></a>考勤表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ding_attendance (</span><br><span class="line">  attendance_id <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">  attendance_employee_user_id <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">  attendance_base_check_time <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">  attendance_user_check_time <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">  attendance_group_id <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  attendance_check_type <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  attendance_time_result <span class="built_in">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  attendance_location_result <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  attendance_work_date <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (attendance_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_id <span class="keyword">IS</span> <span class="string">'考勤id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_employee_user_id <span class="keyword">IS</span> <span class="string">'考勤员工id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_base_check_time <span class="keyword">IS</span> <span class="string">'打卡基准时间'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_user_check_time <span class="keyword">IS</span> <span class="string">'员工实际打卡时间'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_group_id <span class="keyword">IS</span> <span class="string">'考勤组id'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_check_type <span class="keyword">IS</span> <span class="string">'打卡类型-上下班'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_time_result <span class="keyword">IS</span> <span class="string">'时间结果'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_location_result <span class="keyword">IS</span> <span class="string">'打卡范围结果'</span>;</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> ding_attendance.attendance_work_date <span class="keyword">IS</span> <span class="string">'工作日'</span>;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>钉钉</tag>
      </tags>
  </entry>
  <entry>
    <title>销售内部联络单</title>
    <url>/2020/11/05/%E9%94%80%E5%94%AE%E5%86%85%E9%83%A8%E8%81%94%E7%BB%9C%E5%8D%95/</url>
    <content><![CDATA[<ol>
<li>内部联络单号 <ul>
<li>设置 &gt; 自动编号 &gt; new_sal_contactform</li>
</ul>
</li>
<li>根据销售信息单自动带出 √<ul>
<li>销售信息    new_opportunity_id（内联单)</li>
<li>客户名称    new_account_id（内联单)        new_account_id(销售信息)</li>
<li>主要联系人    new_pkcontact（内联单)          new_contactname(销售信息-联系人姓名)</li>
<li>联系电话     new_telephone（内联单)        new_contacttel（销售信息-联系人电话）</li>
<li>联系地址     new_address（内联单)            new_address（销售信息-详细地址）</li>
<li>提报单位     new_dept_id（内联单)         new_dept_id（销售信息-提报单位）</li>
<li>跟踪人     new_sales_id（内联单)        new_trackor（销售信息-跟踪人）</li>
<li>所属组织   new_organisation_id         new_organisation_id(销售信息)</li>
</ul>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">opportunityOnchange</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">///&lt;summary&gt;销售信息Onchange事件&lt;/summary&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//销售信息id</span></span><br><span class="line">    <span class="keyword">var</span> new_opportunity_id = rtcrm.getLookupId(<span class="string">"new_opportunity_id"</span>);</span><br><span class="line">    <span class="comment">//查询销售信息字段（客户名称、主要联系人、联系电话、联系地址、提报单位、跟踪人）</span></span><br><span class="line">    <span class="keyword">var</span> opportunity = rtcrm.getFieldValue(new_opportunity_id, <span class="string">"opportunities"</span>,</span><br><span class="line">        <span class="string">"_new_account_id_value,new_contactname,new_contacttel,new_address,_new_dept_id_value,_new_trackor_value"</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//客户名称赋值</span></span><br><span class="line">    <span class="keyword">if</span> (opportunity[<span class="string">"_new_account_id_value"</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> new_account_id = opportunity[<span class="string">"_new_account_id_value"</span>];</span><br><span class="line">        <span class="keyword">var</span> new_account_id_name = opportunity[<span class="string">"_new_account_id_value@OData.Community.Display.V1.FormattedValue"</span>];</span><br><span class="line">        <span class="keyword">var</span> lookupValue = rtcrm.buildLookup(new_account_id,</span><br><span class="line">            new_account_id_name, <span class="string">"account"</span>);</span><br><span class="line">        rtcrm(<span class="string">'#new_account_id'</span>).val(lookupValue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"客户名称为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//主要联系人赋值</span></span><br><span class="line">    <span class="keyword">if</span> (opportunity[<span class="string">"new_contactname"</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> new_contactname = opportunity[<span class="string">"new_contactname"</span>];</span><br><span class="line">        rtcrm(<span class="string">"#new_pkcontact"</span>).val(new_contactname);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"主要联系人为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//联系电话赋值</span></span><br><span class="line">    <span class="keyword">if</span> (opportunity[<span class="string">"new_contacttel"</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> new_contacttel = opportunity[<span class="string">"new_contacttel"</span>];</span><br><span class="line">        rtcrm(<span class="string">"#new_telephone"</span>).val(new_contacttel);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"联系电话为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//联系地址赋值</span></span><br><span class="line">    <span class="keyword">if</span> (opportunity[<span class="string">"new_address"</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> new_address = opportunity[<span class="string">"new_address"</span>];</span><br><span class="line">        rtcrm(<span class="string">"#new_address"</span>).val(new_address);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"联系地址为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//提报单位赋值</span></span><br><span class="line">    <span class="keyword">if</span> (opportunity[<span class="string">"_new_dept_id_value"</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> new_dept_id = opportunity[<span class="string">"_new_dept_id_value"</span>];</span><br><span class="line">        <span class="keyword">var</span> new_dept_id_name = opportunity[<span class="string">"_new_dept_id_value@OData.Community.Display.V1.FormattedValue"</span>];</span><br><span class="line">        <span class="keyword">var</span> lookupValue = rtcrm.buildLookup(new_dept_id,</span><br><span class="line">            new_dept_id_name, <span class="string">"businessunit"</span>);</span><br><span class="line">        rtcrm(<span class="string">'#new_dept_id'</span>).val(lookupValue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"提报单位为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//跟踪人赋值</span></span><br><span class="line">    <span class="keyword">if</span> (opportunity[<span class="string">"_new_trackor_value"</span>]) &#123;</span><br><span class="line">        <span class="keyword">var</span> new_trackor_id = opportunity[<span class="string">"_new_trackor_value"</span>];</span><br><span class="line">        <span class="keyword">var</span> new_trackor_id_name = opportunity[<span class="string">"_new_trackor_value@OData.Community.Display.V1.FormattedValue"</span>];</span><br><span class="line">        <span class="keyword">var</span> lookupValue = rtcrm.buildLookup(new_trackor_id,</span><br><span class="line">            new_trackor_id_name, <span class="string">"new_ord_sales"</span>);</span><br><span class="line">        rtcrm(<span class="string">'#new_sales_id'</span>).val(lookupValue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"跟踪人为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>处理状态 <ul>
<li>picklist字段；分为：制单、处理中、已处理、已完成；</li>
<li>1.处理状态初始值默认为’制单‘；</li>
<li>2.点击处理后，更新处理状态为’已处理‘；</li>
<li>new_dealstatus</li>
</ul>
</li>
<li>审核状态<ul>
<li>picklist字段：分为：制单、审核中、已审核、已驳回、已否决</li>
<li>1.审核状态初始值为制单；</li>
<li>2.点击提交后，更新审核状态为审核中；</li>
<li>3.审核后，更新审核状态为已审核或者已驳回；</li>
<li>new_approvalstatus</li>
</ul>
</li>
<li>处理按钮<ul>
<li>点击处理后，更新处理状态为’已处理‘</li>
<li>处理中已审核时,责任人和当前账户一致时显示</li>
<li>注册按钮<ul>
<li>显示隐藏控制 enable rules<ul>
<li>customRule</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="1.jpg" alt=""></p>
<ol start="6">
<li><p>完成按钮</p>
<ul>
<li>点击完成按钮，更新处理状态为‘已完成’</li>
<li>已处理已审核时，单据负责人和当前账户一致时显示</li>
</ul>
</li>
<li><p>场景动作</p>
<ul>
<li>1.点击提交 <ul>
<li>1.1 更新处理状态为‘处理中’</li>
<li>1.2 更新审核状态为‘审核中’</li>
<li>电商运营部负责人审核</li>
</ul>
</li>
<li>2.同意<ul>
<li>2.1更新审核状态为‘已审核’</li>
</ul>
</li>
<li>3.驳回<ul>
<li>3.1更新处理状态为‘制单’</li>
<li>3.2更新审核状态为‘已驳回’</li>
</ul>
</li>
</ul>
</li>
<li><p>签核流程自动化</p>
<ul>
<li>新建解决方案</li>
<li>添加现有实体</li>
<li>添加必须组件 &gt; 否</li>
<li>设置 &gt; 签核流程自动化</li>
<li>输入解决方案名称 &gt; 无审核驳回等字段点添加字段（标准签核流不建议自己建） &gt; 无提交撤回等按钮选择添加按钮</li>
</ul>
</li>
<li><p>销售内联单产品明细</p>
<ul>
<li>new_contactformproduct 销售内联单产品明细   </li>
<li>test 销售信息 4CBB33BE-B2A7-4873-8246-E855F762D60B</li>
<li>new_name 名称</li>
<li>new_productgroup_id 产品组</li>
<li>new_tonlevel_id 吨级</li>
<li>new_productmodel_id 产品型号</li>
<li>new_number 需求数量</li>
<li>new_plandealmoney 预计成交单价</li>
<li>new_actualdealmoney 实际成交单价</li>
<li>new_plandealtime 预计成交年月</li>
<li>new_actualamount 实际成交金额 </li>
<li>配置窗体时选择子网格属性即可将明细与主档根据字段关联</li>
</ul>
</li>
</ol>
<p><img src="2.jpg" alt=""></p>
<ol start="10">
<li>js打开视图表单</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">openEntityForm: <span class="function"><span class="keyword">function</span> (<span class="params">name, id, parameters, windowOptions</span>) </span>&#123;</span><br><span class="line">    <span class="comment">///	&lt;summary&gt;对openEntityForm函数的封装，打开CRM页面&lt;/summary&gt;</span></span><br><span class="line">    <span class="comment">///	&lt;param name="name" type="String"&gt;实体名称&lt;/param&gt;</span></span><br><span class="line">    <span class="comment">///	&lt;param name="id" type="String"&gt;实体ID，若为空，则打开新建页面&lt;/param&gt;</span></span><br><span class="line">    <span class="comment">///	&lt;param name="parameters" type="Object"&gt;将参数带入窗体中&lt;/param&gt;</span></span><br><span class="line">    <span class="comment">///	&lt;param name="windowOptions" type="Object"&gt;若 openInNewWindow 属性设置为 true，则将在新窗体中打开一个窗口。此参数在 Dynamics 365 移动客户端（电话和平板）中被忽略。&lt;/param&gt;</span></span><br><span class="line">    Xrm.Utility.openEntityForm(name, id, parameters, windowOptions);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OpenNewContact</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	 <span class="keyword">var</span> parameters = &#123;&#125;;</span><br><span class="line">	 <span class="comment">//Set the Parent Customer field value to "Contoso".</span></span><br><span class="line">	 parameters[<span class="string">"parentcustomerid"</span>] = <span class="string">"2878282E-94D6-E111-9B1D-00155D9D700B"</span>;</span><br><span class="line">	 parameters[<span class="string">"parentcustomeridname"</span>] = <span class="string">"Contoso"</span>;</span><br><span class="line">	 parameters[<span class="string">"parentcustomeridtype"</span>] = <span class="string">"account"</span>;</span><br><span class="line">	 <span class="comment">//Set the Address Type to "Primary".</span></span><br><span class="line">	 parameters[<span class="string">"address1_addresstypecode"</span>] = <span class="string">"3"</span>;</span><br><span class="line">	 <span class="comment">//Set text in the Description field.</span></span><br><span class="line">	 parameters[<span class="string">"description"</span>] = <span class="string">"Default values for this record were set programmatically."</span>;</span><br><span class="line">	 <span class="comment">//Set Do not allow E-mails to "Do Not Allow".</span></span><br><span class="line">	 parameters[<span class="string">"donotemail"</span>] = <span class="string">"1"</span>;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">// Open the window.</span></span><br><span class="line">	 Xrm.Utility.openEntityForm(<span class="string">"contact"</span>, <span class="literal">null</span>, parameters);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>小细节<ul>
<li>pickList赋值用OptionSetValue（int）</li>
<li>js文件无法上传至正式环境web资源时，先在测试环境上传，并新建解决方案，将web资源添加至解决方案后导出再导入正式环境</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>工作</category>
      </categories>
      <tags>
        <tag>CRM</tag>
        <tag>销售</tag>
      </tags>
  </entry>
</search>
